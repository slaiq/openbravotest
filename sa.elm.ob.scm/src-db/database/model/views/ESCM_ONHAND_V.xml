<?xml version="1.0"?>
  <database name="VIEW ESCM_ONHAND_V">
    <view name="ESCM_ONHAND_V"><![CDATA[SELECT m_storage_detail.m_storage_detail_id AS escm_onhand_v_id, m_storage_detail.ad_client_id, m_storage_detail.ad_org_id, m_storage_detail.isactive, m_storage_detail.created, m_storage_detail.createdby, m_storage_detail.updated, m_storage_detail.updatedby, m_product.m_product_category_id, m_product.characteristic_desc, m_product.value, m_product.name, m_product.c_uom_id, COALESCE(initalreceipt.rec_qty, 0) AS rec_qty, COALESCE(initalreceipt.ins_qty, 0) AS ins_qty, COALESCE(m_storage_detail.qtyonhand, 0) AS qtyonhand, COALESCE(m_req.req_qty, 0) AS req_qty, GREATEST(to_number(COALESCE(COALESCE(m_storage_detail.qtyonhand, 0) - COALESCE(m_req.req_qty, 0), 0)), 0) AS ava_req_qty, m_product.em_escm_stock_type, m_locator.m_warehouse_id, m_product.qtymin, m_product.qtymax, m_product.em_escm_reorder_point, m_product.description, m_storage_detail.m_attributesetinstance_id, m_storage_detail.m_locator_id, m_product.m_product_id FROM m_storage_detail JOIN m_product ON m_storage_detail.m_product_id = m_product.m_product_id JOIN m_locator ON m_locator.m_locator_id = m_storage_detail.m_locator_id JOIN m_warehouse ON m_warehouse.m_warehouse_id = m_locator.m_warehouse_id AND (m_warehouse.em_escm_warehouse_type = 'MAW' OR m_warehouse.em_escm_warehouse_type = 'RTW') LEFT JOIN (SELECT escm_initialreceipt.m_product_id, m_locator_1.ad_org_id, m_locator_1.m_locator_id, (SELECT m_warehouse_1.m_warehouse_id FROM m_warehouse m_warehouse_1 WHERE m_warehouse_1.em_escm_warehouse_type = 'MAW' AND m_warehouse_1.ad_org_id = m_locator_1.ad_org_id AND m_warehouse_1.isactive = 'Y' LIMIT 1) AS mainwh, COALESCE(sum(COALESCE(escm_initialreceipt.quantity, 0) - COALESCE(escm_initialreceipt.accepted_qty + escm_initialreceipt.rejected_qty + escm_initialreceipt.delivered_qty + escm_initialreceipt.return_qty + escm_initialreceipt.ir_return_qty, 0)), 0) AS rec_qty, COALESCE(sum(escm_initialreceipt.accepted_qty), 0) AS ins_qty FROM escm_initialreceipt JOIN m_inout ON m_inout.m_inout_id = escm_initialreceipt.m_inout_id JOIN m_locator m_locator_1 ON m_locator_1.m_warehouse_id = (((SELECT m_warehouse_1.m_warehouse_id FROM m_warehouse m_warehouse_1 WHERE m_warehouse_1.em_escm_warehouse_type = 'REW' AND m_warehouse_1.ad_org_id = m_inout.ad_org_id AND m_warehouse_1.isactive = 'Y' LIMIT 1))) AND m_locator_1.isdefault = 'Y' WHERE m_inout.docstatus = 'CO' AND (m_inout.em_escm_receivingtype = 'IR' OR m_inout.em_escm_receivingtype = 'SR') GROUP BY escm_initialreceipt.m_product_id, m_locator_1.m_locator_id) initalreceipt ON initalreceipt.m_product_id = m_storage_detail.m_product_id AND initalreceipt.mainwh = m_warehouse.m_warehouse_id AND m_storage_detail.m_attributesetinstance_id = '0' LEFT JOIN (SELECT sum(escm_material_reqln.requested_qty) AS req_qty, escm_material_reqln.m_product_id, m_locator_1.m_locator_id FROM escm_material_reqln JOIN escm_material_request ON escm_material_request.escm_material_request_id = escm_material_reqln.escm_material_request_id JOIN m_locator m_locator_1 ON m_locator_1.m_warehouse_id = (((SELECT m_warehouse_1.m_warehouse_id FROM m_warehouse m_warehouse_1 WHERE m_warehouse_1.em_escm_warehouse_type = 'MAW' AND m_warehouse_1.isactive = 'Y' AND m_warehouse_1.ad_org_id = escm_material_request.ad_org_id LIMIT 1))) AND m_locator_1.isdefault = 'Y' WHERE escm_material_request.status = 'ESCM_IP' GROUP BY escm_material_reqln.m_product_id, m_locator_1.m_locator_id) m_req ON m_req.m_product_id = m_storage_detail.m_product_id AND m_req.m_locator_id = m_storage_detail.m_locator_id AND m_storage_detail.m_attributesetinstance_id = '0' WHERE m_storage_detail.qtyonhand > 0]]></view>
  </database>
