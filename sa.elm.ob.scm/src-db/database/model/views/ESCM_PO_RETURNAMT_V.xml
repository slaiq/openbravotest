<?xml version="1.0"?>
  <database name="VIEW ESCM_PO_RETURNAMT_V">
    <view name="ESCM_PO_RETURNAMT_V"><![CDATA[SELECT get_uuid() AS escm_po_returnamt_v_id, l4.escm_initialreceipt_id, addrec.m_inout_id, l4.ad_client_id, l4.ad_org_id, l4.isactive, l4.created, l4.createdby, l4.updated, l4.updatedby, CASE WHEN COALESCE(l4.delivered_amt, 0) > 0 THEN COALESCE(l4.delivered_amt, 0) ELSE 0 END AS delivered_amt, COALESCE(newiniti.tot_line_amt, 0) AS newamount, 'D' AS status, l4.m_product_id, l4.description, l4.c_uom_id, l4.supplierbatch, COALESCE(newiniti.notes, '') AS notes, l4.issummary FROM escm_initialreceipt l4 JOIN m_inout hd ON hd.m_inout_id = l4.m_inout_id LEFT JOIN (SELECT DISTINCT addrec_1.receipt, addrec_1.m_inout_id FROM escm_addreceipt addrec_1) addrec ON l4.m_inout_id = addrec.receipt LEFT JOIN escm_initialreceipt newiniti ON newiniti.m_inout_id = addrec.m_inout_id AND newiniti.line = l4.line AND newiniti.description = l4.description AND newiniti.status = 'D' AND newiniti.source_ref = l4.escm_initialreceipt_id WHERE l4.delivered_amt > 0 AND hd.em_escm_receivingtype = 'PROJ' UNION ALL SELECT get_uuid() AS escm_po_returnamt_v_id, l4.escm_initialreceipt_id, addrec.m_inout_id, l4.ad_client_id, l4.ad_org_id, l4.isactive, l4.created, l4.createdby, l4.updated, l4.updatedby, CASE WHEN COALESCE(l4.delivered_amt, 0) > 0 THEN COALESCE(l4.delivered_amt, 0) ELSE 0 END AS delivered_amt, COALESCE(newiniti.tot_line_amt, 0) AS newamount, 'D' AS status, l4.m_product_id, l4.description, l4.c_uom_id, l4.supplierbatch, COALESCE(newiniti.notes, '') AS notes, l4.issummary FROM escm_initialreceipt l4 JOIN m_inout hd ON hd.m_inout_id = l4.m_inout_id LEFT JOIN (SELECT DISTINCT addrec_1.receipt, addrec_1.m_inout_id FROM escm_addreceipt addrec_1) addrec ON l4.m_inout_id = addrec.receipt LEFT JOIN escm_initialreceipt newiniti ON newiniti.m_inout_id = addrec.m_inout_id AND newiniti.m_product_id = l4.m_product_id AND newiniti.status = 'D' AND newiniti.source_ref = l4.escm_initialreceipt_id JOIN m_product pro ON pro.m_product_id = l4.m_product_id WHERE l4.delivered_amt > 0 AND hd.em_escm_receivingtype = 'SR' AND hd.em_escm_receivetype = 'AMT' AND (pro.producttype = 'I' AND pro.isstocked = 'Y' OR pro.m_product_id IS NULL)]]></view>
  </database>
