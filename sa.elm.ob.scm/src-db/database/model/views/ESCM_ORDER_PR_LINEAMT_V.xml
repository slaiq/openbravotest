<?xml version="1.0"?>
  <database name="VIEW ESCM_ORDER_PR_LINEAMT_V">
    <view name="ESCM_ORDER_PR_LINEAMT_V"><![CDATA[SELECT ordship.c_orderline_id AS escm_order_pr_lineamt_v_id, prd.value AS name, ordship.ad_client_id, ordship.ad_org_id, ordship.isactive, ordship.created, ordship.createdby, ordship.updated, ordship.updatedby, ordship.c_orderline_id, ordship.c_order_id, ordship.c_bpartner_id, bp.name AS suppliername, ordship.em_escm_prodescription, ordship.c_uom_id, ordship.m_product_id, vc.em_efin_uniquecode AS uniquecodename, ordship.em_efin_c_validcombination_id AS uniquecode, ordship.linenetamt AS agreementamt, ordship.em_escm_releaseamt AS releasedamount, CASE WHEN ord.em_escm_istax = 'N' THEN COALESCE(COALESCE((SELECT sum(ln.linenetamt - ln.em_escm_line_taxamt) AS sum FROM c_orderline ln JOIN c_order ordr ON ordr.c_order_id = ln.c_order_id JOIN efin_tax_method tx ON ordr.em_escm_tax_method_id = tx.efin_tax_method_id WHERE ln.em_escm_agreement_line = ordship.c_orderline_id AND ordr.em_escm_istax = 'Y' AND tx.istaxincluded = 'N' AND ordr.em_escm_appstatus = 'ESCM_IP'), 0) + COALESCE((SELECT sum(ln.linenetamt) AS sum FROM c_orderline ln JOIN c_order ordr ON ordr.c_order_id = ln.c_order_id JOIN efin_tax_method tx ON ordr.em_escm_tax_method_id = tx.efin_tax_method_id WHERE ln.em_escm_agreement_line = ordship.c_orderline_id AND ordr.em_escm_istax = 'Y' AND tx.istaxincluded = 'Y' AND ordr.em_escm_appstatus = 'ESCM_IP'), 0) + COALESCE((SELECT sum(ln.linenetamt) AS sum FROM c_orderline ln JOIN c_order ordr ON ordr.c_order_id = ln.c_order_id WHERE ln.em_escm_agreement_line = ordship.c_orderline_id AND ordr.em_escm_istax = 'N' AND ordr.em_escm_appstatus = 'ESCM_IP'), 0), 0) ELSE COALESCE((SELECT sum(ln.linenetamt) AS sum FROM c_orderline ln JOIN c_order ordr ON ordr.c_order_id = ln.c_order_id WHERE ln.em_escm_agreement_line = ordship.c_orderline_id AND ordr.em_escm_appstatus = 'ESCM_IP'), 0) END AS inprogress_amt, COALESCE(ordship.linenetamt, 0) - COALESCE(ordship.em_escm_releaseamt, 0) - CASE WHEN ord.em_escm_istax = 'N' THEN COALESCE(COALESCE((SELECT sum(ln.linenetamt - ln.em_escm_line_taxamt) AS sum FROM c_orderline ln JOIN c_order ordr ON ordr.c_order_id = ln.c_order_id JOIN efin_tax_method tx ON ordr.em_escm_tax_method_id = tx.efin_tax_method_id WHERE ln.em_escm_agreement_line = ordship.c_orderline_id AND ordr.em_escm_istax = 'Y' AND tx.istaxincluded = 'N' AND ordr.em_escm_appstatus = 'ESCM_IP'), 0) + COALESCE((SELECT sum(ln.linenetamt) AS sum FROM c_orderline ln JOIN c_order ordr ON ordr.c_order_id = ln.c_order_id JOIN efin_tax_method tx ON ordr.em_escm_tax_method_id = tx.efin_tax_method_id WHERE ln.em_escm_agreement_line = ordship.c_orderline_id AND ordr.em_escm_istax = 'Y' AND tx.istaxincluded = 'Y' AND ordr.em_escm_appstatus = 'ESCM_IP'), 0) + COALESCE((SELECT sum(ln.linenetamt) AS sum FROM c_orderline ln JOIN c_order ordr ON ordr.c_order_id = ln.c_order_id WHERE ln.em_escm_agreement_line = ordship.c_orderline_id AND ordr.em_escm_istax = 'N' AND ordr.em_escm_appstatus = 'ESCM_IP'), 0), 0) ELSE COALESCE((SELECT sum(ln.linenetamt) AS sum FROM c_orderline ln JOIN c_order ordr ON ordr.c_order_id = ln.c_order_id WHERE ln.em_escm_agreement_line = ordship.c_orderline_id AND ordr.em_escm_appstatus = 'ESCM_IP'), 0) END AS remainingamt, 0 AS releaseamt, ordship.em_escm_issummarylevel AS summary, ordship.line, ordship.em_escm_parentline_id AS parentid, ordship.em_escm_product_category_id, ordship.em_escm_prodescription AS olddescription FROM c_orderline ordship LEFT JOIN m_product prd ON prd.m_product_id = ordship.m_product_id LEFT JOIN c_order ord ON ord.c_order_id = ordship.c_order_id LEFT JOIN c_bpartner bp ON bp.c_bpartner_id = ordship.c_bpartner_id LEFT JOIN c_validcombination vc ON vc.c_validcombination_id = ordship.em_efin_c_validcombination_id WHERE (COALESCE(ordship.linenetamt, 0) - COALESCE(ordship.em_escm_releaseamt, 0)) > 0]]></view>
  </database>
