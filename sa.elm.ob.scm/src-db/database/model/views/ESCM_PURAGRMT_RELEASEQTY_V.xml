<?xml version="1.0"?>
  <database name="VIEW ESCM_PURAGRMT_RELEASEQTY_V">
    <view name="ESCM_PURAGRMT_RELEASEQTY_V"><![CDATA[SELECT ordln.c_orderline_id AS escm_puragrmt_releaseqty_v_id, ordln.c_order_id, ordln.c_orderline_id, ordln.ad_client_id, ordln.ad_org_id, ordln.isactive, ordln.created, ordln.createdby, ordln.updated, ordln.updatedby, ordln.line, ordln.c_bpartner_id, bp.name AS supplier_name, ordln.m_product_id, pdt.name AS item, ordln.em_escm_prodescription AS description, ordln.em_efin_c_validcombination_id, vc.em_efin_uniquecode AS unique_code, ordln.priceactual AS unit_price, ordln.qtyordered AS agreement_qty, ordln.em_escm_releaseqty AS released_qty, COALESCE((SELECT sum(a.sum) AS sum FROM (SELECT CASE WHEN sum(ln.qtyordered - COALESCE(oldord.qtyordered, 0)) < 0 THEN 0 ELSE sum(ln.qtyordered - COALESCE(oldord.qtyordered, 0)) END AS sum FROM c_orderline ln LEFT JOIN (SELECT COALESCE(ln_1.qtyordered, 0) AS qtyordered, ln_1.c_orderline_id FROM c_orderline ln_1 WHERE (ln_1.c_orderline_id IN (SELECT c_orderline.em_escm_old_orderline FROM c_orderline JOIN c_order ord_1 ON ord_1.c_order_id = c_orderline.c_order_id WHERE c_orderline.em_escm_old_orderline IS NOT NULL))) oldord ON oldord.c_orderline_id = ln.em_escm_old_orderline JOIN c_order ord ON ord.c_order_id = ln.c_order_id WHERE ln.em_escm_agreement_line = ordln.c_orderline_id AND ord.em_escm_appstatus = 'ESCM_IP' GROUP BY oldord.qtyordered) a), 0) AS inprogress_qty, CASE WHEN ordln.em_escm_issummarylevel = 'Y' THEN 0 ELSE COALESCE(ordln.qtyordered, 0) - COALESCE(ordln.em_escm_releaseqty, 0) - COALESCE((SELECT sum(a.sum) AS sum FROM (SELECT CASE WHEN sum(ln.qtyordered - COALESCE(oldord.qtyordered, 0)) < 0 THEN 0 ELSE sum(ln.qtyordered - COALESCE(oldord.qtyordered, 0)) END AS sum FROM c_orderline ln LEFT JOIN (SELECT COALESCE(ln_1.qtyordered, 0) AS qtyordered, ln_1.c_orderline_id FROM c_orderline ln_1 WHERE (ln_1.c_orderline_id IN (SELECT c_orderline.em_escm_old_orderline FROM c_orderline JOIN c_order ord_1 ON ord_1.c_order_id = c_orderline.c_order_id WHERE c_orderline.em_escm_old_orderline IS NOT NULL))) oldord ON oldord.c_orderline_id = ln.em_escm_old_orderline JOIN c_order ord ON ord.c_order_id = ln.c_order_id WHERE ln.em_escm_agreement_line = ordln.c_orderline_id AND ord.em_escm_appstatus = 'ESCM_IP' GROUP BY oldord.qtyordered) a), 0) END AS remaining_qty, 0 AS release_qty, ordln.em_escm_issummarylevel AS summary, ordln.em_escm_parentline_id AS parentid, ordln.em_escm_product_category_id, ordln.c_uom_id, ordln.em_escm_prodescription AS olddescription FROM c_orderline ordln LEFT JOIN c_bpartner bp ON ordln.c_bpartner_id = bp.c_bpartner_id LEFT JOIN c_validcombination vc ON vc.c_validcombination_id = ordln.em_efin_c_validcombination_id LEFT JOIN m_product pdt ON pdt.m_product_id = ordln.m_product_id WHERE (ordln.em_escm_issummarylevel = 'Y' OR ordln.em_escm_issummarylevel = 'N') AND (COALESCE(ordln.qtyordered, 0) - COALESCE(ordln.em_escm_releaseqty, 0)) > 0]]></view>
  </database>
