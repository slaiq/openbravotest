<?xml version="1.0"?>
  <database name="VIEW ESCM_DMS_V">
    <view name="ESCM_DMS_V"><![CDATA[SELECT COALESCE(dms.bidno, dms.orderno) AS escm_dms_v_id, dms.bid_type, dms.bidno AS bid_no, dms.bidname AS bid_name, dms.bidfinyear AS bid_financial_year, to_date(dms.bidcreationdate, 'DD-MM-YYYY') AS bid_creation_date, dms.bid_category, dms.orderno AS po_number, COALESCE(dms.po_net_total, 0) AS po_net_total, dms.po_category, dms.po_supplier FROM (SELECT bid.escm_bidmgmt_id AS escm_dms_v_id, reflist.name AS bid_type, bid.bidno, bid.bidname, yr.description AS bidfinyear, eut_convert_to_hijri(to_char(bid.bidcreationdate, 'YYYY-MM-DD')) AS bidcreationdate, cat.name AS bid_category, ord.documentno AS orderno, COALESCE(ord.grandtotal, 0) AS po_net_total, cat2.name AS po_category, (bp.em_efin_documentno || '-') || bp.name AS po_supplier FROM escm_bidmgmt bid LEFT JOIN ad_ref_list reflist ON reflist.value = bid.bidtype AND reflist.ad_reference_id = '5AFBE22F061141B6A4F83A10E51F432C' LEFT JOIN c_year yr ON yr.c_year_id = bid.finanyear LEFT JOIN escm_deflookups_typeln cat ON cat.escm_deflookups_typeln_id = bid.contract_type LEFT JOIN c_order ord ON ord.em_escm_bidmgmt_id = bid.escm_bidmgmt_id LEFT JOIN escm_deflookups_typeln cat2 ON cat2.escm_deflookups_typeln_id = ord.em_escm_contact_type LEFT JOIN c_bpartner bp ON bp.c_bpartner_id = ord.c_bpartner_id UNION SELECT ord.c_order_id AS escm_dms_v_id, reflist.name AS bid_type, bid.bidno, bid.bidname, yr.description AS bidfinyear, eut_convert_to_hijri(to_char(bid.bidcreationdate, 'YYYY-MM-DD')) AS bidcreationdate, cat.name AS bid_category, ord.documentno AS orderno, COALESCE(ord.grandtotal, 0) AS po_net_total, cat2.name AS po_category, (bp.em_efin_documentno || '-') || bp.name AS po_supplier FROM c_order ord LEFT JOIN escm_bidmgmt bid ON ord.em_escm_bidmgmt_id = bid.escm_bidmgmt_id LEFT JOIN ad_ref_list reflist ON reflist.value = bid.bidtype AND reflist.ad_reference_id = '5AFBE22F061141B6A4F83A10E51F432C' LEFT JOIN c_year yr ON yr.c_year_id = bid.finanyear LEFT JOIN escm_deflookups_typeln cat ON cat.escm_deflookups_typeln_id = bid.contract_type LEFT JOIN escm_deflookups_typeln cat2 ON cat2.escm_deflookups_typeln_id = ord.em_escm_contact_type LEFT JOIN c_bpartner bp ON bp.c_bpartner_id = ord.c_bpartner_id) dms ORDER BY dms.bidno]]></view>
  </database>
