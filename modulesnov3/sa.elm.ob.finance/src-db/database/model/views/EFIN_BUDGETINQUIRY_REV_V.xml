<?xml version="1.0"?>
  <database name="VIEW EFIN_BUDGETINQUIRY_REV_V">
    <view name="EFIN_BUDGETINQUIRY_REV_V"><![CDATA[SELECT budline.efin_budgetinquiry_id AS efin_budgetinquiry_rev_v_id, budline.ad_client_id, budline.ad_org_id, budline.isactive, budline.created, budline.createdby, budline.updated, budline.updatedby, 0 AS incamount, 0 AS decamount, COALESCE(budline.current_budget, 0) AS currentbudget, COALESCE((SELECT COALESCE(be.current_budget, 0) - COALESCE(be.disdec_amt, 0) + COALESCE(be.disinc_amt, 0) FROM efin_budgetinquiry be JOIN c_validcombination vc_1 ON be.c_validcombination_id = vc_1.c_validcombination_id WHERE (vc_1.c_salesregion_id IN (SELECT b.hq_budgetcontrolunit FROM efin_budget_ctrl_param b WHERE b.ad_client_id = be.ad_client_id)) AND be.efin_budgetinquiry_id = budline.efin_budgetinquiry_id), 0) AS fundsavailable, COALESCE(budline.current_budget, 0) AS costcurrentbudget, budline.c_validcombination_id, budline.uniquecodename, budline.efin_budgetinquiry_id, bud.efin_budgetint_id, budline.c_campaign_id, budline.c_project_id, budline.c_elementvalue_id, budline.efin_budgetlines_id, budline.c_salesregion_id, budline.isbudget, budline.description, vc.c_bpartner_id, vc.c_activity_id, vc.em_efin_accountparent, '' AS parent_campaign_id FROM efin_budgetinquiry budline JOIN efin_budgetint bud ON bud.efin_budgetint_id = budline.efin_budgetint_id LEFT JOIN efin_budget_ctrl_param bcp ON bcp.ad_client_id = bud.ad_client_id JOIN c_validcombination vc ON vc.c_validcombination_id = budline.c_validcombination_id WHERE budline.c_salesregion_id = bcp.hq_budgetcontrolunit AND bcp.isready = 'Y' AND vc.isactive = 'Y' UNION SELECT com.c_validcombination_id AS efin_budgetinquiry_rev_v_id, com.ad_client_id, com.ad_org_id, com.isactive, com.created, com.createdby, com.updated, com.updatedby, 0 AS incamount, 0 AS decamount, 0 AS currentbudget, 0 AS fundsavailable, 0 AS costcurrentbudget, com.c_validcombination_id, com.em_efin_uniquecodename AS uniquecodename, '' AS efin_budgetinquiry_id, '' AS efin_budgetint_id, com.c_campaign_id, com.c_project_id, acc.c_elementvalue_id, '' AS efin_budgetlines_id, com.c_salesregion_id, 'N' AS isbudget, com.description, com.c_bpartner_id, com.c_activity_id, com.em_efin_accountparent, '' AS parent_campaign_id FROM c_validcombination com JOIN c_elementvalue acc ON acc.c_elementvalue_id = com.account_id JOIN efin_budget_ctrl_param param ON param.ad_client_id = com.ad_client_id WHERE com.c_salesregion_id = param.hq_budgetcontrolunit AND com.ad_org_id = param.agency_hq_org AND com.em_efin_uniquecode <> '' AND com.em_efin_uniquecode IS NOT NULL AND acc.accounttype = 'E' AND com.em_efin_dimensiontype = 'E' AND com.isactive = 'Y' AND com.em_efin_uniquecode IS NOT NULL AND com.ad_org_id IS NOT NULL AND com.c_salesregion_id IS NOT NULL AND com.c_campaign_id IS NOT NULL AND com.account_id IS NOT NULL AND com.c_project_id IS NOT NULL AND com.c_bpartner_id IS NOT NULL AND com.c_activity_id IS NOT NULL AND com.user1_id IS NOT NULL AND com.user2_id IS NOT NULL]]></view>
  </database>
