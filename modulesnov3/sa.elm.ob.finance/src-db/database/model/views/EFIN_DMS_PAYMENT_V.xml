<?xml version="1.0"?>
  <database name="VIEW EFIN_DMS_PAYMENT_V">
    <view name="EFIN_DMS_PAYMENT_V"><![CDATA[SELECT pay.documentno, eut_convert_to_hijri(to_char(pay.paymentdate, 'YYYY-MM-DD')) AS paymentdate, (SELECT yr.year FROM c_period JOIN c_year yr ON yr.c_year_id = c_period.c_year_id WHERE pay.paymentdate >= c_period.startdate AND pay.paymentdate <= c_period.enddate LIMIT 1) AS financial_year, pay.em_efin_paymentsequence AS payment_seq_no, pay.em_efin_mofchequeno AS chequeno, CASE WHEN pay.em_efin_beneficiary2_id IS NOT NULL THEN bp2.name WHEN pay.em_efin_bpartner_id IS NOT NULL THEN bp1.name ELSE bp.name END AS businesspartner_name, pay.amount, inv.documentno AS invoice_no, eut_convert_to_hijri(to_char(inv.dateinvoiced, 'YYYY-MM-DD')) AS invoice_date, acct.em_efin_acctseq AS accountingsequence, eut_convert_to_hijri(to_char(acct.dateacct, 'YYYY-MM-DD')) AS accountingseqdate, inv.description AS invoice_description, CASE WHEN inv.em_efin_invoicetype_txt = 'POM' THEN 'صرف عقد' WHEN inv.em_efin_invoicetype_txt = 'PPI' THEN 'عهدة' WHEN inv.em_efin_invoicetype_txt = 'API' THEN 'أمر الصرف' WHEN inv.em_efin_invoicetype_txt = 'RDV' THEN 'امر صرف المستخلص/الدفعة المقدمة للعقد' ELSE 'تسديد العهدة' END AS transaction_document, org.name AS invoice_organization, org.value AS organization_id, cos.name AS invoice_costcenter, CASE WHEN cos.value = '201900' THEN '0204500' WHEN cos.value = '0201200' THEN '0201200' WHEN cos.value = '0201220' THEN '0201220' WHEN cos.value = '0201210' THEN '0201210' WHEN cos.value = '5' THEN '0206540' WHEN cos.value = '0202920' THEN '0202920' WHEN cos.value = '0207200' THEN '0207200' WHEN cos.value = '9' THEN '0201660' WHEN cos.value = '0201300' THEN '0201300' WHEN cos.value = '11' THEN '0200140' WHEN cos.value = '0201230' THEN '0201230' WHEN cos.value = '0202910' THEN '0202910' WHEN cos.value = '14' THEN '0204420' WHEN cos.value = '0202620' THEN '0202620' WHEN cos.value = '0201720' THEN '0201720' WHEN cos.value = '0202300' THEN '0202300' WHEN cos.value = '0200111' THEN '0200111' WHEN cos.value = '19' THEN '0202800' WHEN cos.value = '0201280' THEN '0201280' WHEN cos.value = '0201900' THEN '0204500' WHEN cos.value = '0204700' THEN '0204700' WHEN cos.value = '0204600' THEN '0204600' WHEN cos.value = '0202400' THEN '0202400' WHEN cos.value = '0202500' THEN '0202500' WHEN cos.value = '0202700' THEN '0202700' WHEN cos.value = '0202800' THEN '0202800' WHEN cos.value = '28' THEN '0204300' WHEN cos.value = '29' THEN '0208500' WHEN cos.value = '30' THEN '0208500' WHEN cos.value = '0204800' THEN '0204800' WHEN cos.value = '0203300' THEN '0203300' WHEN cos.value = '0203400' THEN '0203400' WHEN cos.value = '0203500' THEN '0203500' WHEN cos.value = '0203600' THEN '0203600' WHEN cos.value = '36' THEN '0201400' WHEN cos.value = '37' THEN '0202010' WHEN cos.value = '0203010' THEN '0203010' WHEN cos.value = '39' THEN '0201240' WHEN cos.value = '40' THEN '-' WHEN cos.value = '41' THEN '0201610' WHEN cos.value = '0203120' THEN '0203120' WHEN cos.value = '43' THEN '0201800' WHEN cos.value = '0200165' THEN '0200165' WHEN cos.value = '0202030' THEN '0202030' WHEN cos.value = '46' THEN '0200130' WHEN cos.value = '47' THEN '0200170' WHEN cos.value = '0203800' THEN '0203800' WHEN cos.value = '50' THEN '0201010' WHEN cos.value = '0202600' THEN '0202600' WHEN cos.value = '100' THEN '0200100' WHEN cos.value = '990' THEN '-' WHEN cos.value = '999' THEN '-' WHEN cos.value = '1010' THEN '0201310' WHEN cos.value = '0201310' THEN '0201310' WHEN cos.value = '0201340' THEN '0201340' WHEN cos.value = '0201330' THEN '0201330' WHEN cos.value = '0207000' THEN '0207000' WHEN cos.value = '0204300' THEN '0204300' WHEN cos.value = '1017' THEN '0201200' WHEN cos.value = '1018' THEN '0204900' WHEN cos.value = '0204430' THEN '0204430' WHEN cos.value = '1020' THEN '0204700' WHEN cos.value = '0201660' THEN '0201660' WHEN cos.value = '0209200' THEN '0209200' WHEN cos.value = '0202230' THEN '0202230' WHEN cos.value = '1024' THEN '0202220' WHEN cos.value = '1025' THEN '0202040' WHEN cos.value = '1026' THEN '0202300' WHEN cos.value = '1027' THEN '0205300' WHEN cos.value = '1028' THEN '0205100' WHEN cos.value = '0205210' THEN '0205210' WHEN cos.value = '1030' THEN '0204600' WHEN cos.value = '1031' THEN '0202230' WHEN cos.value = '0202700' THEN '0202700' WHEN cos.value = '1033' THEN '0208000' WHEN cos.value = '0200150' THEN '0200150' WHEN cos.value = '1035' THEN '0200191' WHEN cos.value = '0201600' THEN '0201600' WHEN cos.value = '1037' THEN '0207000' WHEN cos.value = '0206001' THEN '0206001' WHEN cos.value = '0206002' THEN '0206002' WHEN cos.value = '0206003' THEN '0206003' WHEN cos.value = '0206004' THEN '0206004' WHEN cos.value = '0206005' THEN '0206005' WHEN cos.value = '0206006' THEN '0206006' WHEN cos.value = '0206007' THEN '0206007' WHEN cos.value = '0206008' THEN '0206008' WHEN cos.value = '0206009' THEN '0206009' WHEN cos.value = '0206010' THEN '0206010' WHEN cos.value = '0206011' THEN '0206011' WHEN cos.value = '0206012' THEN '0206012' WHEN cos.value = '0206013' THEN '0206013' WHEN cos.value = '0206401' THEN '0206005' ELSE (org.value || '-') || cos.value END AS costcenter_id, CASE WHEN cos.value = '201900' THEN org.value || '-0204500' WHEN cos.value = '0201200' THEN org.value || '-0201200' WHEN cos.value = '0201220' THEN org.value || '-0201220' WHEN cos.value = '0201210' THEN org.value || '-0201210' WHEN cos.value = '5' THEN org.value || '-0206540' WHEN cos.value = '0202920' THEN org.value || '-0202920' WHEN cos.value = '0207200' THEN org.value || '-0207200' WHEN cos.value = '9' THEN org.value || '-0201660' WHEN cos.value = '0201300' THEN org.value || '-0201300' WHEN cos.value = '11' THEN org.value || '-0200140' WHEN cos.value = '0201230' THEN org.value || '-0201230' WHEN cos.value = '0202910' THEN org.value || '-0202910' WHEN cos.value = '14' THEN org.value || '-0204420' WHEN cos.value = '0202620' THEN org.value || '-0202620' WHEN cos.value = '0201720' THEN org.value || '-0201720' WHEN cos.value = '0202300' THEN org.value || '-0202300' WHEN cos.value = '0200111' THEN org.value || '-0200111' WHEN cos.value = '19' THEN org.value || '-0202800' WHEN cos.value = '0201280' THEN org.value || '-0201280' WHEN cos.value = '0201900' THEN org.value || '-0204500' WHEN cos.value = '0204700' THEN org.value || '-0204700' WHEN cos.value = '0204600' THEN org.value || '-0204600' WHEN cos.value = '0202400' THEN org.value || '-0202400' WHEN cos.value = '0202500' THEN org.value || '-0202500' WHEN cos.value = '0202700' THEN org.value || '-0202700' WHEN cos.value = '0202800' THEN org.value || '-0202800' WHEN cos.value = '28' THEN org.value || '-0204300' WHEN cos.value = '29' THEN org.value || '-0208500' WHEN cos.value = '30' THEN org.value || '-0208500' WHEN cos.value = '0204800' THEN org.value || '-0204800' WHEN cos.value = '0203300' THEN org.value || '-0203300' WHEN cos.value = '0203400' THEN org.value || '-0203400' WHEN cos.value = '0203500' THEN org.value || '-0203500' WHEN cos.value = '0203600' THEN org.value || '-0203600' WHEN cos.value = '36' THEN org.value || '-0201400' WHEN cos.value = '37' THEN org.value || '-0202010' WHEN cos.value = '0203010' THEN org.value || '-0203010' WHEN cos.value = '39' THEN org.value || '-0201240' WHEN cos.value = '40' THEN org.value || '-' WHEN cos.value = '41' THEN org.value || '-0201610' WHEN cos.value = '0203120' THEN org.value || '-0203120' WHEN cos.value = '43' THEN org.value || '-0201800' WHEN cos.value = '0200165' THEN org.value || '-0200165' WHEN cos.value = '0202030' THEN org.value || '-0202030' WHEN cos.value = '46' THEN org.value || '-0200130' WHEN cos.value = '47' THEN org.value || '-0200170' WHEN cos.value = '0203800' THEN org.value || '-0203800' WHEN cos.value = '50' THEN org.value || '-0201010' WHEN cos.value = '0202600' THEN org.value || '-0202600' WHEN cos.value = '100' THEN org.value || '-0200100' WHEN cos.value = '990' THEN org.value || '-' WHEN cos.value = '999' THEN org.value || '-' WHEN cos.value = '1010' THEN org.value || '-0201310' WHEN cos.value = '0201310' THEN org.value || '-0201310' WHEN cos.value = '0201340' THEN org.value || '-0201340' WHEN cos.value = '0201330' THEN org.value || '-0201330' WHEN cos.value = '0207000' THEN org.value || '-0207000' WHEN cos.value = '0204300' THEN org.value || '-0204300' WHEN cos.value = '1017' THEN org.value || '-0201200' WHEN cos.value = '1018' THEN org.value || '-0204900' WHEN cos.value = '0204430' THEN org.value || '-0204430' WHEN cos.value = '1020' THEN org.value || '-0204700' WHEN cos.value = '0201660' THEN org.value || '-0201660' WHEN cos.value = '0209200' THEN org.value || '-0209200' WHEN cos.value = '0202230' THEN org.value || '-0202230' WHEN cos.value = '1024' THEN org.value || '-0202220' WHEN cos.value = '1025' THEN org.value || '-0202040' WHEN cos.value = '1026' THEN org.value || '-0202300' WHEN cos.value = '1027' THEN org.value || '-0205300' WHEN cos.value = '1028' THEN org.value || '-0205100' WHEN cos.value = '0205210' THEN org.value || '-0205210' WHEN cos.value = '1030' THEN org.value || '-0204600' WHEN cos.value = '1031' THEN org.value || '-0202230' WHEN cos.value = '0202700' THEN org.value || '-0202700' WHEN cos.value = '1033' THEN org.value || '-0208000' WHEN cos.value = '0200150' THEN org.value || '-0200150' WHEN cos.value = '1035' THEN org.value || '-0200191' WHEN cos.value = '0201600' THEN org.value || '-0201600' WHEN cos.value = '1037' THEN org.value || '-0207000' WHEN cos.value = '0206001' THEN org.value || '-0206001' WHEN cos.value = '0206002' THEN org.value || '-0206002' WHEN cos.value = '0206003' THEN org.value || '-0206003' WHEN cos.value = '0206004' THEN org.value || '-0206004' WHEN cos.value = '0206005' THEN org.value || '-0206005' WHEN cos.value = '0206006' THEN org.value || '-0206006' WHEN cos.value = '0206007' THEN org.value || '-0206007' WHEN cos.value = '0206008' THEN org.value || '-0206008' WHEN cos.value = '0206009' THEN org.value || '-0206009' WHEN cos.value = '0206010' THEN org.value || '-0206010' WHEN cos.value = '0206011' THEN org.value || '-0206011' WHEN cos.value = '0206012' THEN org.value || '-0206012' WHEN cos.value = '0206013' THEN org.value || '-0206013' WHEN cos.value = '0206401' THEN org.value || '-0206005' ELSE (org.value || '-') || cos.value END AS org_dept FROM fin_payment pay JOIN c_invoice inv ON inv.c_invoice_id = pay.em_efin_invoice_id LEFT JOIN c_bpartner bp2 ON bp2.c_bpartner_id = pay.em_efin_beneficiary2_id LEFT JOIN c_bpartner bp1 ON bp1.c_bpartner_id = pay.em_efin_bpartner_id LEFT JOIN c_bpartner bp ON bp.c_bpartner_id = pay.c_bpartner_id LEFT JOIN ad_org org ON org.ad_org_id = inv.ad_org_id LEFT JOIN c_salesregion cos ON cos.c_salesregion_id = inv.em_efin_c_salesregion_id LEFT JOIN (SELECT fact_acct.em_efin_acctseq, fact_acct.dateacct, fact_acct.em_efin_documentno FROM fact_acct WHERE (fact_acct.ad_table_id IN ('4D8C3B3C31D1410DA046140C9F024D17', '318')) AND fact_acct.em_efin_acctseq IS NOT NULL GROUP BY fact_acct.em_efin_acctseq, fact_acct.dateacct, fact_acct.em_efin_documentno) acct ON acct.em_efin_documentno = inv.documentno WHERE pay.isreceipt = 'N' AND (pay.status IN ('PWNC', 'RPPC', 'PPM'))]]></view>
  </database>
