<?xml version="1.0"?>
  <database name="VIEW EFIN_ENCUM_DETAILS_V">
    <view name="EFIN_ENCUM_DETAILS_V"><![CDATA[SELECT encmln.efin_budget_manencumlines_id AS efin_encum_details_v_id, encmln.efin_budget_manencumlines_id, encm.efin_budget_manencum_id, encm.efin_budgetint_id, encm.ad_client_id, encm.ad_org_id, encm.isactive, encm.created, encm.createdby, encm.updated, encm.updatedby, encm.dateacct, encm.documentno, encm.encum_type, encm.encum_stage, encm.encum_method, CASE WHEN encm.encum_method = 'M' AND maninv.ispaid = 'Y' THEN encmln.revamount - maninv.used_amount ELSE encmln.revamount END AS revamt, encmln.remaining_amount AS remamt, encmln.app_amt AS appamt, encmln.used_amount AS usedamt, encm.docstatus, encm.description, encmln.c_validcombination_id, encmln.uniquecodename FROM efin_budget_manencumlines encmln JOIN efin_budget_manencum encm ON encmln.efin_budget_manencum_id = encm.efin_budget_manencum_id LEFT JOIN (SELECT DISTINCT invoice.ispaid, sum(invoice.invamount) AS used_amount, invoice.efin_budget_manencumlines_id FROM efin_manualencuminvoice invoice WHERE invoice.ispaid = 'Y' GROUP BY invoice.efin_budget_manencumlines_id, invoice.ispaid) maninv ON maninv.efin_budget_manencumlines_id = encmln.efin_budget_manencumlines_id WHERE (encm.encum_method = 'A' OR encm.encum_method = 'M' AND encm.isreservedfund = 'Y') AND (encm.docstatus IN ('CO', 'WFA')) AND encmln.revamount > 0 AND ((encmln.efin_budget_manencumlines_id IN (SELECT efin_manualencuminvoice.efin_budget_manencumlines_id FROM efin_manualencuminvoice WHERE efin_manualencuminvoice.ispaid = 'N')) OR encmln.remaining_amount > 0 OR NOT (encmln.efin_budget_manencumlines_id IN (SELECT efin_manualencuminvoice.efin_budget_manencumlines_id FROM efin_manualencuminvoice))) UNION ALL SELECT efin_encum_closed_history.efin_budget_manencumlines_id AS efin_encum_details_v_id, efin_encum_closed_history.efin_budget_manencumlines_id, efin_encum_closed_history.efin_budget_manencum_id, efin_encum_closed_history.efin_budgetint_id, efin_encum_closed_history.ad_client_id, efin_encum_closed_history.ad_org_id, efin_encum_closed_history.isactive, efin_encum_closed_history.created, efin_encum_closed_history.createdby, efin_encum_closed_history.updated, efin_encum_closed_history.updatedby, efin_encum_closed_history.dateacct, efin_encum_closed_history.documentno, efin_encum_closed_history.encum_type, efin_encum_closed_history.encum_stage, efin_encum_closed_history.encum_method, efin_encum_closed_history.revamt, efin_encum_closed_history.remamt, efin_encum_closed_history.appamt, efin_encum_closed_history.usedamt, efin_encum_closed_history.docstatus, efin_encum_closed_history.description, efin_encum_closed_history.c_validcombination_id, efin_encum_closed_history.uniquecodename FROM efin_encum_closed_history]]></view>
  </database>
