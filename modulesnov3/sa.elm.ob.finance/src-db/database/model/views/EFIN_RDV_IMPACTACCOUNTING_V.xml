<?xml version="1.0"?>
  <database name="VIEW EFIN_RDV_IMPACTACCOUNTING_V">
    <view name="EFIN_RDV_IMPACTACCOUNTING_V"><![CDATA[SELECT acc.efin_rdv_impactaccounting_v_id, txn.ad_client_id, txn.ad_org_id, txn.isactive, txn.created, txn.createdby, txn.updated, txn.updatedby, acc.uniquecode, CASE WHEN acc.amt < 0 THEN acc.amt * (-1) ELSE acc.amt END AS amt, CASE WHEN acc.amt > 0 THEN 'DR' ELSE 'CR' END AS accsign, acc.efin_rdvtxnline_id, acc.efin_rdvtxn_id, acc.type, acc.txn_version, acc.trxapp_no, acc.em_efin_accounttype, acc.em_efin_uniquecodename FROM (SELECT get_uuid() AS efin_rdv_impactaccounting_v_id, ln.c_validcombination_id AS uniquecode, sum(ln.match_amt) AS amt, ln.efin_rdvtxnline_id, ln.efin_rdvtxn_id, 'PR' AS type, txn_1.txn_version, ln.trxapp_no, val.em_efin_accounttype, val.em_efin_uniquecodename FROM efin_rdvtxnline ln JOIN efin_rdvtxn txn_1 ON txn_1.efin_rdvtxn_id = ln.efin_rdvtxn_id JOIN c_validcombination val ON val.c_validcombination_id = ln.c_validcombination_id WHERE ln.isadvance = 'N' AND ln.match_amt <> 0 GROUP BY ln.c_validcombination_id, ln.efin_rdvtxnline_id, ln.efin_rdvtxn_id, txn_1.txn_version, ln.trxapp_no, val.em_efin_accounttype, val.em_efin_uniquecodename UNION SELECT get_uuid() AS efin_rdv_impactaccounting_v_id, b.uniquecode, sum(b.amt) AS amt, b.efin_rdvtxnline_id, b.efin_rdvtxn_id, 'AD' AS type, b.txn_version, b.trxapp_no, b.em_efin_accounttype, b.em_efin_uniquecodename FROM (SELECT a.uniquecode, sum(a.amt) AS amt, a.efin_rdvtxnline_id, a.efin_rdvtxn_id, a.txn_version, a.trxapp_no, a.em_efin_accounttype, a.em_efin_uniquecodename FROM (SELECT ln.c_validcombination_id AS uniquecode, sum(ln.adv_deduct) * (-1) AS amt, ln.efin_rdvtxnline_id, ln.efin_rdvtxn_id, txn_1.txn_version, ln.trxapp_no, val.em_efin_accounttype, val.em_efin_uniquecodename FROM efin_rdvtxnline ln JOIN efin_rdvtxn txn_1 ON txn_1.efin_rdvtxn_id = ln.efin_rdvtxn_id JOIN c_validcombination val ON val.c_validcombination_id = ln.c_validcombination_id WHERE ln.isadvance = 'N' AND ln.adv_deduct <> 0 GROUP BY ln.c_validcombination_id, ln.efin_rdvtxnline_id, ln.efin_rdvtxn_id, txn_1.txn_version, ln.trxapp_no, val.em_efin_accounttype, val.em_efin_uniquecodename UNION SELECT ln.em_efin_c_validcombination_id AS uniquecode, sum(ln.linenetamt) * (hd.em_escm_advpaymnt_percntge / 100) AS amt, rdvln.efin_rdvtxnline_id, rdvln.efin_rdvtxn_id, txn_1.txn_version, rdvln.trxapp_no, val.em_efin_accounttype, val.em_efin_uniquecodename FROM c_orderline ln JOIN c_order hd ON hd.c_order_id = ln.c_order_id JOIN efin_rdv rdv ON rdv.c_order_id = hd.c_order_id JOIN efin_rdvtxnline rdvln ON rdvln.efin_rdv_id = rdv.efin_rdv_id JOIN efin_rdvtxn txn_1 ON txn_1.efin_rdvtxn_id = rdvln.efin_rdvtxn_id JOIN c_validcombination val ON val.c_validcombination_id = ln.em_efin_c_validcombination_id WHERE rdvln.isadvance = 'Y' AND ln.em_escm_issummarylevel = 'N' GROUP BY ln.em_efin_c_validcombination_id, hd.em_escm_advpaymnt_percntge, rdvln.efin_rdvtxnline_id, rdvln.efin_rdvtxn_id, txn_1.txn_version, rdvln.trxapp_no, val.em_efin_accounttype, val.em_efin_uniquecodename) a GROUP BY a.uniquecode, a.efin_rdvtxnline_id, a.efin_rdvtxn_id, a.txn_version, a.trxapp_no, a.em_efin_accounttype, a.em_efin_uniquecodename) b WHERE b.amt <> 0 GROUP BY b.uniquecode, b.efin_rdvtxnline_id, b.efin_rdvtxn_id, b.txn_version, b.trxapp_no, b.em_efin_accounttype, b.em_efin_uniquecodename UNION SELECT get_uuid() AS efin_rdv_impactaccounting_v_id, a.uniquecode, sum(a.per) AS amt, a.efin_rdvtxnline_id, a.efin_rdvtxn_id, 'PE' AS type, a.txn_version, a.trxapp_no, a.em_efin_accounttype, a.em_efin_uniquecodename FROM (SELECT pn.penalty_uniquecode AS uniquecode, sum(pn.penalty_amount) * (-1) AS per, ln.efin_rdvtxnline_id, ln.efin_rdvtxn_id, txn_1.txn_version, ln.trxapp_no, val.em_efin_accounttype, val.em_efin_uniquecodename FROM efin_rdvtxnline ln JOIN efin_penalty_action pn ON pn.efin_rdvtxnline_id = ln.efin_rdvtxnline_id JOIN efin_rdvtxn txn_1 ON txn_1.efin_rdvtxn_id = ln.efin_rdvtxn_id JOIN c_validcombination val ON val.c_validcombination_id = pn.penalty_uniquecode WHERE ln.isadvance = 'N' AND pn.penalty_amount <> 0 GROUP BY pn.penalty_uniquecode, ln.efin_rdvtxnline_id, ln.efin_rdvtxn_id, txn_1.txn_version, ln.trxapp_no, val.em_efin_accounttype, val.em_efin_uniquecodename) a WHERE a.per <> 0 GROUP BY a.uniquecode, a.efin_rdvtxnline_id, a.efin_rdvtxn_id, a.txn_version, a.trxapp_no, a.em_efin_accounttype, a.em_efin_uniquecodename) acc JOIN efin_rdvtxn txn ON txn.efin_rdvtxn_id = acc.efin_rdvtxn_id]]></view>
  </database>
