<?xml version="1.0"?>
  <database name="VIEW EFIN_TANFEETH_CONTRACT_INV_V">
    <view name="EFIN_TANFEETH_CONTRACT_INV_V"><![CDATA[SELECT a.documentno AS contract_number, a.em_escm_revision AS contract_version, a.grandtotal AS contract_total, leg.po_contract_no AS legacy_contract_no, a.em_escm_legacy_contract_no AS computer_no, a.em_escm_notes AS contract_description, reg.name AS city, bp.name AS contractor, inv.documentno AS invoice_number, inv.grandtotal AS invoice_amount, pay.amount AS invoice_paid_amount, a.em_efin_legacypaid_amt AS contract_legacy_paid_amount, a.em_efin_paid_amt AS contract_total_paid_amount, inv.docstatus AS invoice_status, inv.dateinvoiced, invbp.name AS invoiced_supplier, inv.description AS invoice_description, lookup.name AS contract_type FROM c_order a JOIN c_bpartner bp ON bp.c_bpartner_id = a.c_bpartner_id LEFT JOIN c_city reg ON reg.c_city_id = a.em_escm_c_city_id LEFT JOIN escm_deflookups_typeln lookup ON a.em_escm_contact_type = lookup.escm_deflookups_typeln_id LEFT JOIN c_invoice inv ON a.c_order_id = inv.em_efin_c_order_id OR a.c_order_id = inv.c_order_id LEFT JOIN (SELECT sum(fin_payment.amount) AS amount, fin_payment.em_efin_invoice_id FROM fin_payment GROUP BY fin_payment.em_efin_invoice_id) pay ON pay.em_efin_invoice_id = inv.c_invoice_id LEFT JOIN c_bpartner invbp ON invbp.c_bpartner_id = inv.c_bpartner_id LEFT JOIN escm_legacy_contract leg ON leg.escm_legacy_contract_id = a.em_escm_legacycontract WHERE a.em_escm_contact_type = '7A690E46B6E043C7A8B34B2D92E17D87' ORDER BY a.documentno DESC]]></view>
  </database>
