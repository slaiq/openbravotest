<?xml version="1.0"?>
  <database name="VIEW EFIN_BUDGETHISTORY_V">
    <view name="EFIN_BUDGETHISTORY_V"><![CDATA[SELECT get_uuid() AS efin_budgethistory_v_id, main.ad_client_id, main.ad_org_id, main.isactive, main.created, main.createdby, main.updated, main.updatedby, main.c_validcombination_id, main.increase, main.decrease, main.acct_date AS acctdate, main.transaction_type AS documenttype, main.status, main.description, main.docno AS documentno, main.c_campaign_id, main.transactiondate, main.c_year_id, NULL AS transfer_source FROM (SELECT t1.efin_budgetadjline_id AS lineid, t1.ad_client_id, t1.ad_org_id, t1.isactive, t1.created, t1.createdby, t1.updated, t1.updatedby, t1.c_validcombination_id, 0 AS original_budget, t1.increase, t1.decrease, 0 AS current_budget, t1.efin_budgetadjline_id, t1.efin_budgetadj_id, '' AS efin_budget_id, '' AS efin_budgetlines_id, t3.efin_budgetinquiry_id, t2.accounting_date AS acct_date, 'BA' AS transaction_type, t2.docstatus AS status, t2.description, t2.docno, t2.c_campaign_id, t2.trx_date AS transactiondate, t2.c_year_id FROM efin_budgetadjline t1 JOIN efin_budgetadj t2 ON t1.efin_budgetadj_id = t2.efin_budgetadj_id JOIN efin_budgetinquiry t3 ON t1.c_validcombination_id = t3.c_validcombination_id AND t2.efin_budgetint_id = t3.efin_budgetint_id UNION SELECT t1.efin_budgetlines_id AS lineid, t1.ad_client_id, t1.ad_org_id, t1.isactive, t1.created, t1.createdby, t1.updated, t1.updatedby, t1.c_validcombination_id, t1.amount, t1.amount AS increase_amt, t1.decrease_amt, t1.current_budget, '' AS efin_budgetadjline_id, '' AS efin_budgetadj_id, t1.efin_budget_id, t1.efin_budgetlines_id, t3.efin_budgetinquiry_id, t2.transaction_date AS acct_date, 'OB' AS transaction_type, t2.status, t2.budgetname AS description, t2.document_no AS docno, t2.c_campaign_id, t2.transaction_date AS transactiondate, t2.c_year_id FROM efin_budgetlines t1 JOIN efin_budget t2 ON t1.efin_budget_id = t2.efin_budget_id JOIN efin_budgetinquiry t3 ON t1.c_validcombination_id = t3.c_validcombination_id AND t2.efin_budgetint_id = t3.efin_budgetint_id) main UNION SELECT get_uuid() AS efin_budgethistory_v_id, rev.ad_client_id, rev.ad_org_id, rev.isactive, rev.created, rev.createdby, rev.updated, rev.updatedby, revln.c_validcombination_id, revln.increase, revln.decrease, rev.accounting_date AS acctdate, rev.doctype AS documenttype, rev.docstatus AS status, rev.description, rev.documentno, rev.c_campaign_id, rev.trxdate AS transactiondate, rev.c_year_id, rev.transfer_source FROM efin_budget_transfertrxline revln JOIN efin_budget_transfertrx rev ON revln.efin_budget_transfertrx_id = rev.efin_budget_transfertrx_id JOIN efin_budgetinquiry budgetinq ON rev.efin_budgetint_id = budgetinq.efin_budgetint_id AND revln.c_validcombination_id = budgetinq.c_validcombination_id WHERE (rev.docstatus IN ('CO', 'WFA')) AND revln.c_validcombination_id IS NOT NULL UNION SELECT fr.efin_budgethistory_v_id, fr.ad_client_id, fr.ad_org_id, fr.isactive, fr.created, fr.createdby, fr.updated, fr.updatedby, fr.fromaccount AS c_validcombination_id, fr.increase, fr.decrease, fr.dateacct AS acctdate, fr.trxtype AS documenttype, fr.docstatus AS status, fr.description, fr.documentno, fr.c_campaign_id, fr.trxdate AS transactiondate, fr.c_year_id, NULL AS transfer_source FROM (SELECT get_uuid() AS efin_budgethistory_v_id, t1.ad_client_id, t1.ad_org_id, t1.isactive, t1.created, t1.createdby, t1.updated, t1.updatedby, t1.efin_fundsreqline_id, t1.increase, t1.decrease, t2.efin_fundsreq_id, t3.efin_budgetinquiry_id, t2.documentno, t2.trxdate, t2.dateacct, t2.transaction_org, t2.trxtype, t4.name AS req_type, COALESCE(t1.fromaccount, t1.toaccount) AS fromaccount, t2.docstatus, t2.description, CASE WHEN t2.orgreq_funds_type = 'DD' THEN t1.increase ELSE 0 END AS dept_increase, CASE WHEN t2.orgreq_funds_type = 'DD' THEN t1.decrease ELSE 0 END AS dept_decrease, t2.c_campaign_id, t2.c_year_id FROM efin_fundsreqline t1 JOIN efin_fundsreq t2 ON t1.efin_fundsreq_id = t2.efin_fundsreq_id JOIN efin_budgetinquiry t3 ON (t3.c_validcombination_id = t1.fromaccount OR t3.c_validcombination_id = t1.toaccount) AND t3.efin_budgetint_id = t2.efin_budgetint_id JOIN ad_ref_list t4 ON t4.value = t1.req_type AND t4.ad_reference_id = 'CFDC8846AAA54AC9AFDFA48BB4E0711A' WHERE t1.dist_type = 'DIST' AND (t2.docstatus = 'CO' OR t1.decrease > 0 AND t2.isreserve = 'Y') UNION SELECT get_uuid() AS efin_budgethistory_v_id, t1.ad_client_id, t1.ad_org_id, t1.isactive, t1.created, t1.createdby, t1.updated, t1.updatedby, t1.efin_fundsreqline_id, 0 AS increase, t1.decrease, t2.efin_fundsreq_id, t3.efin_budgetinquiry_id, t2.documentno, t2.trxdate, t2.dateacct, t2.transaction_org, t2.trxtype, t4.name AS req_type, t1.fromaccount, t2.docstatus, t2.description, CASE WHEN t2.orgreq_funds_type = 'DD' THEN 0 ELSE 0 END AS dept_increase, CASE WHEN t2.orgreq_funds_type = 'DD' THEN t1.decrease ELSE 0 END AS dept_decrease, t2.c_campaign_id, t2.c_year_id FROM efin_fundsreqline t1 JOIN efin_fundsreq t2 ON t1.efin_fundsreq_id = t2.efin_fundsreq_id JOIN efin_budgetinquiry t3 ON t3.c_validcombination_id = t1.fromaccount AND t3.efin_budgetint_id = t2.efin_budgetint_id JOIN ad_ref_list t4 ON t4.value = t1.req_type AND t4.ad_reference_id = 'CFDC8846AAA54AC9AFDFA48BB4E0711A' WHERE t1.dist_type = 'MAN' AND (t2.docstatus = 'CO' OR t2.isreserve = 'Y') UNION SELECT get_uuid() AS efin_budgethistory_v_id, t1.ad_client_id, t1.ad_org_id, t1.isactive, t1.created, t1.createdby, t1.updated, t1.updatedby, t1.efin_fundsreqline_id, t1.increase, 0 AS decrease, t2.efin_fundsreq_id, t3.efin_budgetinquiry_id, t2.documentno, t2.trxdate, t2.dateacct, t2.transaction_org, t2.trxtype, t4.name AS req_type, t1.toaccount AS fromaccount, t2.docstatus, t2.description, CASE WHEN t2.orgreq_funds_type = 'DD' THEN t1.increase ELSE 0 END AS dept_increase, CASE WHEN t2.orgreq_funds_type = 'DD' THEN 0 ELSE 0 END AS dept_decrease, t2.c_campaign_id, t2.c_year_id FROM efin_fundsreqline t1 JOIN efin_fundsreq t2 ON t1.efin_fundsreq_id = t2.efin_fundsreq_id JOIN efin_budgetinquiry t3 ON t3.c_validcombination_id = t1.toaccount AND t3.efin_budgetint_id = t2.efin_budgetint_id JOIN ad_ref_list t4 ON t4.value = t1.req_type AND t4.ad_reference_id = 'CFDC8846AAA54AC9AFDFA48BB4E0711A' WHERE t1.dist_type = 'MAN' AND t2.docstatus = 'CO') fr]]></view>
  </database>
