<?xml version="1.0"?>
  <database name="VIEW EHCM_CUS_ASSET_V">
    <view name="EHCM_CUS_ASSET_V"><![CDATA[SELECT a.ehcm_emp_asset_id AS ehcm_cus_asset_v_id, a.ad_client_id, a.ad_org_id, a.isactive, a.created, a.createdby, a.updated, a.updatedby, a.ehcm_emp_perinfo_id, a.name, a.start_date, a.end_date, a.description, a.letter_date, a.decision_no, a.letter_no, a.balance, 'Y'::character AS flag, a.documentno FROM ehcm_emp_asset a UNION SELECT get_uuid() AS ehcm_cus_asset_v_id, a.client AS ad_client_id, '0' AS ad_org_id, 'Y'::character AS isactive, now() AS created, '100' AS createdby, now() AS updated, '100' AS updatedby, a.employee AS ehcm_emp_perinfo_id, a.productname AS name, b.transaction_date AS start_date, b.returndate AS end_date, a.description, NULL AS letter_date, '' AS decision_no, '' AS letter_no, a.qty AS balance, 'N'::character AS flag, a.documentno FROM (SELECT sum(c.qty) AS qty, p.value AS productvalue, p.ad_client_id AS client, COALESCE(p.name, p.description) AS description, p.name AS productname, p.m_product_id, bp.em_ehcm_emp_perinfo_id AS employee, c.documentno, c.beneficiary_name AS benefname FROM escm_mrequest_custody c LEFT JOIN c_bpartner bp ON c.beneficiary_name = bp.c_bpartner_id JOIN m_product p ON p.m_product_id = c.m_product_id WHERE c.status = 'IU' GROUP BY c.qty, c.beneficiary_name, p.m_product_id, bp.em_ehcm_emp_perinfo_id, p.name, p.value, c.documentno) a JOIN (SELECT max(c.transaction_date) AS transaction_date, r.beneficiary_name, c.returndate, r.m_product_id FROM escm_custody_transaction c JOIN escm_mrequest_custody r ON r.escm_mrequest_custody_id = c.escm_mrequest_custody_id WHERE r.status = 'IU' AND c.isprocessed = 'Y' AND c.returndate IS NULL AND (c.transactiontype = 'IE' OR c.transactiontype = 'IRT' OR c.transactiontype = 'TR') GROUP BY c.returndate, r.beneficiary_name, r.m_product_id) b ON a.benefname = b.beneficiary_name AND a.m_product_id = b.m_product_id]]></view>
  </database>
