<?xml version="1.0"?>
  <database name="VIEW ESCM_INVOICE_RDV_LETTERNO_VIEW">
    <view name="ESCM_INVOICE_RDV_LETTERNO_VIEW"><![CDATA[SELECT DISTINCT ord.documentno, COALESCE(invoiceview.annual_invoice, 0) AS annual_invoice, COALESCE(invoiceview.annual_rdv_amount, 0) AS annual_rdv_amount FROM c_order ord LEFT JOIN escm_legacy_contract legacy ON ord.em_escm_legacycontract = legacy.escm_legacy_contract_id LEFT JOIN (SELECT sum(ln.linenetamt) AS annual_invoice, sum(ln.linenetamt) AS annual_rdv_amount, a.documentno FROM c_invoiceline ln JOIN c_invoice inv ON inv.c_invoice_id = ln.c_invoice_id JOIN c_order a ON a.c_order_id = inv.em_efin_c_order_id OR a.c_order_id = inv.c_order_id AND (a.em_escm_contact_type IN ('7A690E46B6E043C7A8B34B2D92E17D87', '96F23587553D46FB8AA6BD5605A1C65D')) WHERE inv.docstatus <> 'DR' AND inv.docstatus <> 'EFIN_CA' GROUP BY a.documentno UNION SELECT sum(ln.linenetamt) AS annual_invoice, sum(ln.linenetamt) AS annual_rdv_amount, l.letter_no AS documentno FROM c_invoiceline ln JOIN c_invoice inv ON inv.c_invoice_id = ln.c_invoice_id JOIN c_order a ON a.c_order_id = inv.em_efin_c_order_id OR a.c_order_id = inv.c_order_id AND (a.em_escm_contact_type IN ('7A690E46B6E043C7A8B34B2D92E17D87', '96F23587553D46FB8AA6BD5605A1C65D')) JOIN escm_legacy_contract l ON l.escm_legacy_contract_id = a.em_escm_legacycontract WHERE l.letter_no IS NOT NULL GROUP BY l.letter_no UNION SELECT sum(ln.linenetamt) AS annual_invoice, sum(ln.linenetamt) AS annual_rdv_amount, l.award_no AS documentno FROM c_invoiceline ln JOIN c_invoice inv ON inv.c_invoice_id = ln.c_invoice_id JOIN c_order a ON a.c_order_id = inv.em_efin_c_order_id OR a.c_order_id = inv.c_order_id AND (a.em_escm_contact_type IN ('7A690E46B6E043C7A8B34B2D92E17D87', '96F23587553D46FB8AA6BD5605A1C65D')) JOIN escm_legacy_contract l ON l.escm_legacy_contract_id = a.em_escm_legacycontract WHERE l.award_no IS NOT NULL AND l.letter_no IS NULL GROUP BY l.award_no) invoiceview ON legacy.award_no IS NOT NULL AND legacy.letter_no IS NULL AND legacy.award_no = invoiceview.documentno OR legacy.letter_no IS NOT NULL AND legacy.letter_no = invoiceview.documentno OR legacy.letter_no IS NULL AND legacy.award_no IS NULL AND invoiceview.documentno = ord.documentno WHERE ord.em_escm_contact_type IN ('7A690E46B6E043C7A8B34B2D92E17D87', '96F23587553D46FB8AA6BD5605A1C65D')]]></view>
  </database>
