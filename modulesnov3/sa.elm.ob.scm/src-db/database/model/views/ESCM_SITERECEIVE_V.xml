<?xml version="1.0"?>
  <database name="VIEW ESCM_SITERECEIVE_V">
    <view name="ESCM_SITERECEIVE_V"><![CDATA[SELECT ln.escm_initialreceipt_id AS escm_sitereceive_v_id, ln.ad_client_id, ln.ad_org_id, ln.isactive, ln.created, ln.updated, ln.createdby, ln.updatedby, row_number() OVER (PARTITION BY hd.createdby ORDER BY hd.documentno, prd.name) AS rownum, prd.m_product_id, (SELECT eut_convert_to_hijri(to_char(hd.movementdate, 'yyyy-MM-dd')) AS eut_convert_to_hijri) AS movementdate, hd.documentno, prd.value, prd.name AS description, ln.quantity - COALESCE(ln.return_qty, 0) AS quantity, ln.m_inout_id, 0 AS reqqty, uom.c_uom_id, COALESCE(inprg.inprgqty, 0) AS inprgqty, hd.createdby AS ad_user_id, COALESCE(ln.sitereqissuedqty, 0) AS issuedqty FROM escm_initialreceipt ln LEFT JOIN m_inout hd ON ln.m_inout_id = hd.m_inout_id LEFT JOIN (SELECT sum(reqln.requested_qty) AS inprgqty, reqln.escm_initialreceipt_id FROM escm_material_request req LEFT JOIN escm_material_reqln reqln ON reqln.escm_material_request_id = req.escm_material_request_id WHERE req.status = 'ESCM_IP' AND req.issiteissuereq = 'Y' GROUP BY reqln.escm_initialreceipt_id) inprg ON inprg.escm_initialreceipt_id = ln.escm_initialreceipt_id LEFT JOIN m_product prd ON ln.m_product_id = prd.m_product_id LEFT JOIN c_uom uom ON uom.c_uom_id = ln.c_uom_id WHERE hd.em_escm_receivingtype = 'SR' AND hd.em_escm_docstatus = 'CO']]></view>
  </database>
