<?xml version="1.0"?>
  <database name="VIEW ESCM_INSPECTION_V">
    <view name="ESCM_INSPECTION_V"><![CDATA[SELECT main.escm_inspection_v_id, main.documentno, main.irqty, main.name, main.status, main.qty, main.irlineid AS escm_initialreceipt_id, main.inoutid AS m_inout_id, main.ad_client_id, main.ad_org_id, main.isactive, main.created, main.createdby, main.updated, main.updatedby, COALESCE(main.description, '') AS description, main.inspected_qty, COALESCE(main.quality_code, '') AS qualitycode, main.c_uom_id, COALESCE(main.notes, '') AS notes, main.summary, main.custody_item FROM (SELECT get_uuid() AS escm_inspection_v_id, ir.documentno, irline.quantity - irline.ir_return_qty - irline.return_qty AS irqty, prd.value AS name, 'A' AS status, COALESCE(exstline.quantity, 0) AS qty, irline.escm_initialreceipt_id AS irlineid, ar.m_inout_id AS inoutid, ar.ad_client_id, ar.ad_org_id, ar.isactive, ar.created, ar.createdby, ar.updated, ar.updatedby, COALESCE(exstline.description, irline.description) AS description, irline.accepted_qty + irline.rejected_qty + irline.delivered_qty AS inspected_qty, irline.c_uom_id, exstline.quality_code, COALESCE(exstline.notes, '') AS notes, irline.issummary AS summary, irline.custody_item FROM escm_addreceipt ar JOIN m_inout ir ON ir.m_inout_id = ar.receipt JOIN escm_initialreceipt irline ON irline.m_inout_id = ir.m_inout_id LEFT JOIN (SELECT cinout.m_inout_id, cline.quality_code, cline.notes, sline.escm_initialreceipt_id, cline.quantity, cline.description FROM escm_initialreceipt cline JOIN escm_initialreceipt sline ON sline.escm_initialreceipt_id = cline.source_ref JOIN m_inout cinout ON cinout.m_inout_id = cline.m_inout_id WHERE cline.status = 'A') exstline ON exstline.escm_initialreceipt_id = irline.escm_initialreceipt_id AND ar.m_inout_id = exstline.m_inout_id LEFT JOIN m_product prd ON prd.m_product_id = irline.m_product_id WHERE ir.em_escm_receivingtype = 'IR' UNION SELECT get_uuid() AS escm_inspection_v_id, ir.documentno, irline.quantity - irline.ir_return_qty - irline.return_qty AS irqty, prd.value AS name, 'R' AS status, COALESCE(exstline.quantity, 0) AS qty, irline.escm_initialreceipt_id AS irlineid, ar.m_inout_id AS inoutid, ar.ad_client_id, ar.ad_org_id, ar.isactive, ar.created, ar.createdby, ar.updated, ar.updatedby, COALESCE(exstline.description, irline.description) AS description, irline.accepted_qty + irline.rejected_qty + irline.delivered_qty AS inspected_qty, irline.c_uom_id, exstline.quality_code, COALESCE(exstline.notes, '') AS notes, irline.issummary AS summary, irline.custody_item FROM escm_addreceipt ar JOIN m_inout ir ON ir.m_inout_id = ar.receipt JOIN escm_initialreceipt irline ON irline.m_inout_id = ir.m_inout_id LEFT JOIN (SELECT cinout.m_inout_id, sline.escm_initialreceipt_id, cline.notes, cline.quality_code, cline.quantity, cline.description FROM escm_initialreceipt cline JOIN escm_initialreceipt sline ON sline.escm_initialreceipt_id = cline.source_ref JOIN m_inout cinout ON cinout.m_inout_id = cline.m_inout_id WHERE cline.status = 'R') exstline ON exstline.escm_initialreceipt_id = irline.escm_initialreceipt_id AND ar.m_inout_id = exstline.m_inout_id LEFT JOIN m_product prd ON prd.m_product_id = irline.m_product_id WHERE ir.em_escm_receivingtype = 'IR') main WHERE main.irqty > main.inspected_qty ORDER BY main.documentno, main.irlineid, main.status]]></view>
  </database>
