<?xml version="1.0"?>
  <database name="VIEW ESCM_ENCUMBRANCE_HISTORY_V">
    <view name="ESCM_ENCUMBRANCE_HISTORY_V"><![CDATA[SELECT get_uuid() AS escm_encumbrance_history_v_id, t1.ad_client_id, t1.ad_org_id, t1.isactive, t1.created, t1.createdby, t1.updated, t1.updatedby, prl.linenetamt AS amount, CASE WHEN pr.em_escm_doc_status = 'ESCM_CA' THEN 'CA' WHEN pr.em_escm_doc_status = 'ESCM_RA' THEN 'REA' WHEN pr.em_escm_doc_status = 'ESCM_IP' THEN 'INP' WHEN pr.em_escm_doc_status = 'ESCM_AP' THEN 'APP' WHEN pr.em_escm_doc_status = 'ESCM_REJ' THEN 'REJ' ELSE pr.em_escm_doc_status END AS status, pr.documentno, t1.efin_budget_manencumlines_id, COALESCE(prl.m_requisitionline_id, '') AS m_requisitionline_id, '' AS escm_bidmgmt_line_id, '' AS c_orderline_id, '' AS escm_proposalmgmt_line_id FROM efin_budget_manencumlines t1 JOIN efin_budget_manencum enc ON t1.efin_budget_manencum_id = enc.efin_budget_manencum_id LEFT JOIN m_requisitionline prl ON prl.em_efin_bud_encumlines_id = t1.efin_budget_manencumlines_id LEFT JOIN m_requisition pr ON pr.m_requisition_id = prl.m_requisition_id WHERE enc.encum_type = 'PRE' UNION SELECT get_uuid() AS escm_encumbrance_history_v_id, t1.ad_client_id, t1.ad_org_id, t1.isactive, t1.created, t1.createdby, t1.updated, t1.updatedby, prl.linenetamt AS amount, CASE WHEN pr.em_escm_doc_status = 'ESCM_CA' THEN 'CA' WHEN pr.em_escm_doc_status = 'ESCM_RA' THEN 'REA' WHEN pr.em_escm_doc_status = 'ESCM_IP' THEN 'INP' WHEN pr.em_escm_doc_status = 'ESCM_AP' THEN 'APP' WHEN pr.em_escm_doc_status = 'ESCM_REJ' THEN 'REJ' ELSE pr.em_escm_doc_status END AS status, pr.documentno, t1.efin_budget_manencumlines_id, '' AS m_requisitionline_id, COALESCE(bdl.escm_bidmgmt_line_id, '') AS escm_bidmgmt_line_id, '' AS c_orderline_id, '' AS escm_proposalmgmt_line_id FROM efin_budget_manencumlines t1 JOIN efin_budget_manencum enc ON t1.efin_budget_manencum_id = enc.efin_budget_manencum_id JOIN escm_bidmgmt_line bdl ON bdl.em_efin_budgmanencumline_id = t1.efin_budget_manencumlines_id JOIN escm_bidsourceref bsf ON bsf.escm_bidmgmt_line_id = bdl.escm_bidmgmt_line_id JOIN escm_bidmgmt bd ON bdl.escm_bidmgmt_id = bd.escm_bidmgmt_id JOIN m_requisitionline prl ON prl.m_requisitionline_id = bsf.m_requisitionline_id JOIN m_requisition pr ON pr.m_requisition_id = prl.m_requisition_id WHERE enc.encum_type = 'PRE' UNION SELECT get_uuid() AS escm_encumbrance_history_v_id, t1.ad_client_id, t1.ad_org_id, t1.isactive, t1.created, t1.createdby, t1.updated, t1.updatedby, ppl.line_total AS amount, pm.proposalappstatus AS status, pm.proposalno AS documentno, t1.efin_budget_manencumlines_id, '' AS m_requisitionline_id, '' AS escm_bidmgmt_line_id, '' AS c_orderline_id, COALESCE(ppl.escm_proposalmgmt_line_id, '') AS escm_proposalmgmt_line_id FROM efin_budget_manencumlines t1 JOIN efin_budget_manencum enc ON t1.efin_budget_manencum_id = enc.efin_budget_manencum_id JOIN escm_proposalmgmt_line ppl ON ppl.em_efin_budgmanencumline_id = t1.efin_budget_manencumlines_id JOIN escm_proposalmgmt pm ON ppl.escm_proposalmgmt_id = pm.escm_proposalmgmt_id AND pm.em_efin_isbudgetcntlapp = 'Y' WHERE enc.encum_type = 'PRE' UNION SELECT get_uuid() AS escm_encumbrance_history_v_id, t1.ad_client_id, t1.ad_org_id, t1.isactive, t1.created, t1.createdby, t1.updated, t1.updatedby, oln.linenetamt AS amount, CASE WHEN ord.em_escm_appstatus = 'ESCM_CA' THEN 'CA' WHEN ord.em_escm_appstatus = 'ESCM_RA' THEN 'REA' WHEN ord.em_escm_appstatus = 'ESCM_IP' THEN 'INP' WHEN ord.em_escm_appstatus = 'ESCM_AP' THEN 'APP' WHEN ord.em_escm_appstatus = 'ESCM_REJ' THEN 'REJ' ELSE ord.em_escm_appstatus END AS status, ord.documentno, t1.efin_budget_manencumlines_id, '' AS m_requisitionline_id, '' AS escm_bidmgmt_line_id, COALESCE(oln.c_orderline_id, '') AS c_orderline_id, '' AS escm_proposalmgmt_line_id FROM efin_budget_manencumlines t1 JOIN efin_budget_manencum enc ON t1.efin_budget_manencum_id = enc.efin_budget_manencum_id JOIN c_orderline oln ON oln.em_efin_bud_encumlines_id = t1.efin_budget_manencumlines_id JOIN c_order ord ON oln.c_order_id = ord.c_order_id AND ord.em_efin_encumbered = 'Y' WHERE enc.encum_type = 'PRE' UNION SELECT get_uuid() AS escm_encumbrance_history_v_id, t1.ad_client_id, t1.ad_org_id, t1.isactive, t1.created, t1.createdby, t1.updated, t1.updatedby, (SELECT CASE WHEN COALESCE(sum(reln.qty), 0) > 0 THEN sum(round(COALESCE(reln.priceactual, 0) * COALESCE(ref.quantity, 0), 2)) ELSE 0 END AS "case" FROM escm_bidsourceref ref JOIN escm_bidmgmt_line ln ON ln.escm_bidmgmt_line_id = ref.escm_bidmgmt_line_id JOIN m_requisitionline reln ON reln.m_requisitionline_id = ref.m_requisitionline_id WHERE ln.em_efin_budgmanencumline_id = t1.efin_budget_manencumlines_id GROUP BY t1.efin_budget_manencumlines_id) AS amount, CASE WHEN bd.bidappstatus = 'ESCM_CA' THEN 'CA' WHEN bd.bidappstatus = 'ESCM_RA' THEN 'REA' WHEN bd.bidappstatus = 'ESCM_IP' THEN 'INP' WHEN bd.bidappstatus = 'ESCM_AP' THEN 'APP' WHEN bd.bidappstatus = 'ESCM_REJ' THEN 'REJ' ELSE bd.bidappstatus END AS status, bd.bidno AS documentno, t1.efin_budget_manencumlines_id, '' AS m_requisitionline_id, COALESCE(bdl.escm_bidmgmt_line_id, '') AS escm_bidmgmt_line_id, '' AS c_orderline_id, '' AS escm_proposalmgmt_line_id FROM efin_budget_manencumlines t1 JOIN efin_budget_manencum enc ON t1.efin_budget_manencum_id = enc.efin_budget_manencum_id JOIN escm_bidmgmt_line bdl ON bdl.em_efin_budgmanencumline_id = t1.efin_budget_manencumlines_id JOIN escm_bidmgmt bd ON bdl.escm_bidmgmt_id = bd.escm_bidmgmt_id WHERE enc.encum_type = 'BE' UNION SELECT get_uuid() AS escm_encumbrance_history_v_id, t1.ad_client_id, t1.ad_org_id, t1.isactive, t1.created, t1.createdby, t1.updated, t1.updatedby, (SELECT CASE WHEN COALESCE(sum(reln.qty), 0) > 0 THEN sum(round(COALESCE(reln.priceactual, 0) * COALESCE(ref.quantity, 0), 2)) ELSE 0 END AS "case" FROM escm_bidsourceref ref JOIN escm_bidmgmt_line ln ON ln.escm_bidmgmt_line_id = ref.escm_bidmgmt_line_id JOIN m_requisitionline reln ON reln.m_requisitionline_id = ref.m_requisitionline_id WHERE ln.em_efin_budgmanencumline_id = t1.efin_budget_manencumlines_id GROUP BY t1.efin_budget_manencumlines_id) AS amount, pm.proposalappstatus AS status, pm.proposalno AS documentno, t1.efin_budget_manencumlines_id, '' AS m_requisitionline_id, '' AS escm_bidmgmt_line_id, '' AS c_orderline_id, CASE WHEN pm.em_efin_isbudgetcntlapp = 'Y' THEN COALESCE(ppl.escm_proposalmgmt_line_id, '') ELSE '' END AS escm_proposalmgmt_line_id FROM efin_budget_manencumlines t1 JOIN efin_budget_manencum enc ON t1.efin_budget_manencum_id = enc.efin_budget_manencum_id JOIN escm_proposalmgmt_line ppl ON ppl.em_efin_budgmanencumline_id = t1.efin_budget_manencumlines_id JOIN escm_proposalmgmt pm ON ppl.escm_proposalmgmt_id = pm.escm_proposalmgmt_id AND pm.em_efin_isbudgetcntlapp = 'Y' WHERE enc.encum_type = 'BE' UNION SELECT get_uuid() AS escm_encumbrance_history_v_id, t1.ad_client_id, t1.ad_org_id, t1.isactive, t1.created, t1.createdby, t1.updated, t1.updatedby, oln.linenetamt AS amount, CASE WHEN ord.em_escm_appstatus = 'ESCM_CA' THEN 'CA' WHEN ord.em_escm_appstatus = 'ESCM_RA' THEN 'REA' WHEN ord.em_escm_appstatus = 'ESCM_IP' THEN 'INP' WHEN ord.em_escm_appstatus = 'ESCM_AP' THEN 'APP' WHEN ord.em_escm_appstatus = 'ESCM_REJ' THEN 'REJ' ELSE ord.em_escm_appstatus END AS status, ord.documentno, t1.efin_budget_manencumlines_id, '' AS m_requisitionline_id, '' AS escm_bidmgmt_line_id, COALESCE(oln.c_orderline_id, '') AS c_orderline_id, '' AS escm_proposalmgmt_line_id FROM efin_budget_manencumlines t1 JOIN efin_budget_manencum enc ON t1.efin_budget_manencum_id = enc.efin_budget_manencum_id JOIN c_orderline oln ON oln.em_efin_bud_encumlines_id = t1.efin_budget_manencumlines_id JOIN c_order ord ON oln.c_order_id = ord.c_order_id WHERE enc.encum_type = 'BE' UNION SELECT get_uuid() AS escm_encumbrance_history_v_id, t1.ad_client_id, t1.ad_org_id, t1.isactive, t1.created, t1.createdby, t1.updated, t1.updatedby, oln.linenetamt AS amount, CASE WHEN ord.em_escm_appstatus = 'ESCM_CA' THEN 'CA' WHEN ord.em_escm_appstatus = 'ESCM_RA' THEN 'REA' WHEN ord.em_escm_appstatus = 'ESCM_IP' THEN 'INP' WHEN ord.em_escm_appstatus = 'ESCM_AP' THEN 'APP' WHEN ord.em_escm_appstatus = 'ESCM_REJ' THEN 'REJ' ELSE ord.em_escm_appstatus END AS status, ord.documentno, t1.efin_budget_manencumlines_id, '' AS m_requisitionline_id, '' AS escm_bidmgmt_line_id, COALESCE(oln.c_orderline_id, '') AS c_orderline_id, '' AS escm_proposalmgmt_line_id FROM efin_budget_manencumlines t1 JOIN efin_budget_manencum enc ON t1.efin_budget_manencum_id = enc.efin_budget_manencum_id JOIN c_orderline oln ON oln.em_efin_bud_encumlines_id = t1.efin_budget_manencumlines_id JOIN c_order ord ON oln.c_order_id = ord.c_order_id WHERE enc.encum_type = 'POE' AND ord.documentno IS NOT NULL UNION SELECT get_uuid() AS escm_encumbrance_history_v_id, t1.ad_client_id, t1.ad_org_id, t1.isactive, t1.created, t1.createdby, t1.updated, t1.updatedby, CASE WHEN pm.proposalstatus = 'PAWD' THEN ppl.awardedamount ELSE ppl.line_total END AS amount, CASE WHEN pm.proposalstatus = 'CL' THEN 'CA' WHEN pm.proposalstatus = 'WD' THEN 'CA' WHEN pm.proposalstatus = 'DIS' THEN 'CA' ELSE pm.proposalstatus END AS status, pm.proposalno AS documentno, t1.efin_budget_manencumlines_id, '' AS m_requisitionline_id, '' AS escm_bidmgmt_line_id, '' AS c_orderline_id, COALESCE(ppl.escm_proposalmgmt_line_id, '') AS escm_proposalmgmt_line_id FROM efin_budget_manencumlines t1 JOIN efin_budget_manencum enc ON t1.efin_budget_manencum_id = enc.efin_budget_manencum_id JOIN escm_proposalmgmt_line ppl ON ppl.em_efin_budgmanencumline_id = t1.efin_budget_manencumlines_id JOIN escm_proposalmgmt pm ON ppl.escm_proposalmgmt_id = pm.escm_proposalmgmt_id WHERE enc.encum_type = 'PAE' UNION SELECT get_uuid() AS escm_encumbrance_history_v_id, t1.ad_client_id, t1.ad_org_id, t1.isactive, t1.created, t1.createdby, t1.updated, t1.updatedby, oln.linenetamt AS amount, CASE WHEN ord.em_escm_appstatus = 'ESCM_CA' THEN 'CA' WHEN ord.em_escm_appstatus = 'ESCM_RA' THEN 'REA' WHEN ord.em_escm_appstatus = 'ESCM_IP' THEN 'INP' WHEN ord.em_escm_appstatus = 'ESCM_AP' THEN 'APP' WHEN ord.em_escm_appstatus = 'ESCM_REJ' THEN 'REJ' ELSE ord.em_escm_appstatus END AS status, ord.documentno, t1.efin_budget_manencumlines_id, '' AS m_requisitionline_id, '' AS escm_bidmgmt_line_id, COALESCE(oln.c_orderline_id, '') AS c_orderline_id, '' AS escm_proposalmgmt_line_id FROM efin_budget_manencumlines t1 JOIN efin_budget_manencum enc ON t1.efin_budget_manencum_id = enc.efin_budget_manencum_id JOIN c_orderline oln ON oln.em_efin_bud_encumlines_id = t1.efin_budget_manencumlines_id JOIN c_order ord ON oln.c_order_id = ord.c_order_id WHERE enc.encum_type = 'PAE']]></view>
  </database>
