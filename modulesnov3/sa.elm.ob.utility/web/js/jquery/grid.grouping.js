(function(b){b.jgrid.extend({groupingSetup:function(){return this.each(function(){var h=this,l=h.p.groupingView;if(l!==null&&((typeof l==="object")||b.isFunction(l))){if(!l.groupField.length){h.p.grouping=false;}else{for(var j=0;j<l.groupField.length;j++){if(!l.groupOrder[j]){l.groupOrder[j]="asc";}if(!l.groupText[j]){l.groupText[j]="{0}";
}if(typeof(l.groupColumnShow[j])!="boolean"){l.groupColumnShow[j]=true;}if(typeof(l.groupSummary[j])!="boolean"){l.groupSummary[j]=false;}if(l.groupColumnShow[j]===true){b(h).jqGrid("showCol",l.groupField[j]);}else{b(h).jqGrid("hideCol",l.groupField[j]);}l.sortitems[j]=[];l.sortnames[j]=[];l.summaryval[j]=[];
if(l.groupSummary[j]){l.summary[j]=[];var a=h.p.colModel;for(var k=0,i=a.length;k<i;k++){if(a[k].summaryType){l.summary[j].push({nm:a[k].name,st:a[k].summaryType,v:""});}}}}h.p.scroll=false;h.p.rownumbers=false;h.p.subGrid=false;h.p.treeGrid=false;h.p.gridview=true;}}else{h.p.grouping=false;}});},groupingPrepare:function(g,h,f,a){this.each(function(){h[0]+="";
var c=h[0].toString().split(" ").join("");var e=this.p.groupingView,d=this;if(f.hasOwnProperty(c)){f[c].push(g);}else{f[c]=[];f[c].push(g);e.sortitems[0].push(c);e.sortnames[0].push(b.trim(h[0].toString()));e.summaryval[0][c]=b.extend(true,[],e.summary[0]);}if(e.groupSummary[0]){b.each(e.summaryval[0][c],function(l,i){if(b.isFunction(this.st)){this.v=this.st.call(d,this.v,this.nm,a);
}else{this.v=b(d).jqGrid("groupingCalculations."+this.st,this.v,this.nm,a);}});}});return f;},groupingToggle:function(a){this.each(function(){var j=this,p=j.p.groupingView,l=a.lastIndexOf("_"),n=a.substring(0,l+1),o=parseInt(a.substring(l+1),10)+1,m=p.minusicon,k=p.plusicon;if(b("#"+a+" span").hasClass(m)){if(p.showSummaryOnHide&&p.groupSummary[0]){b("#"+a).nextUntil(".jqfoot").hide();
}else{b("#"+a).nextUntil("#"+n+String(o)).hide();}b("#"+a+" span").removeClass(m).addClass(k);}else{b("#"+a).nextUntil("#"+n+String(o)).show();b("#"+a+" span").removeClass(k).addClass(m);}});return false;},groupingRender:function(a,d){return this.each(function(){var s=this,m=s.p.groupingView,q="",o="",n,r="",t,p,c;
if(!m.groupDataSorted){m.sortitems[0].sort();m.sortnames[0].sort();if(m.groupOrder[0].toLowerCase()=="desc"){m.sortitems[0].reverse();m.sortnames[0].reverse();}}if(m.groupCollapse){r=m.plusicon;}else{r=m.minusicon;}r+=" tree-wrap-"+s.p.direction;c=0;while(c<d){if(s.p.colModel[c].name==m.groupField[0]){p=c;
break;}c++;}b.each(m.sortitems[0],function(e,g){n=s.p.id+"ghead_"+e;o="<span style='cursor:pointer;' class='ui-icon "+r+"' onclick=\"jQuery('#"+s.p.id+"').jqGrid('groupingToggle','"+n+"');return false;\"></span>";try{t=s.formatter(n,m.sortnames[0][e],p,m.sortitems[0]);}catch(j){t=m.sortnames[0][e];}q+='<tr id="'+n+'" role="row" class= "ui-widget-content jqgroup ui-row-'+s.p.direction+'"><td colspan="'+d+'">'+o+b.jgrid.format(m.groupText[0],t,a[g].length)+"</td></tr>";
for(var h=0;h<a[g].length;h++){q+=a[g][h].join("");}if(m.groupSummary[0]){var B="";if(m.groupCollapse&&!m.showSummaryOnHide){B=' style="display:none;"';}q+="<tr"+B+' role="row" class="ui-widget-content jqfoot ui-row-'+s.p.direction+'">';var C=m.summaryval[0][g],z=s.p.colModel,A,l=a[g].length;for(var f=0;
f<d;f++){var i="<td "+s.formatCol(f,1,"")+">&#160;</td>",k="{0}";b.each(C,function(){if(this.nm==z[f].name){if(z[f].summaryTpl){k=z[f].summaryTpl;}if(this.st=="avg"){if(this.v&&l>0){this.v=(this.v/l);}}try{A=s.formatter("",this.v,f,this);}catch(u){A=this.v;}i="<td "+s.formatCol(f,1,"")+">"+b.jgrid.format(k,A)+"</td>";
return false;}});q+=i;}q+="</tr>";}});b("#"+s.p.id+" tbody:first").append(q);q=null;});},groupingGroupBy:function(f,a,e){return this.each(function(){var c=this;if(typeof(f)=="string"){f=[f];}var h=c.p.groupingView;c.p.grouping=true;for(var d=0;d<h.groupField.length;d++){if(!h.groupColumnShow[d]){b(c).jqGrid("showCol",h.groupField[d]);
}}c.p.groupingView=b.extend(c.p.groupingView,a||{});h.groupField=f;b(c).trigger("reloadGrid");});},groupingRemove:function(a){return this.each(function(){var d=this;if(typeof(a)=="undefined"){a=true;}d.p.grouping=false;if(a===true){b("tr.jqgroup, tr.jqfoot","#"+d.p.id+" tbody:first").remove();b("tr.jqgrow:hidden","#"+d.p.id+" tbody:first").show();
}else{b(d).trigger("reloadGrid");}});},groupingCalculations:{"sum":function(a,e,f){return parseFloat(a||0)+parseFloat((f[e]||0));},"min":function(a,e,f){if(a===""){return parseFloat(f[e]||0);}return Math.min(parseFloat(a),parseFloat(f[e]||0));},"max":function(a,e,f){if(a===""){return parseFloat(f[e]||0);
}return Math.max(parseFloat(a),parseFloat(f[e]||0));},"count":function(a,e,f){if(a===""){a=0;}if(f.hasOwnProperty(e)){return a+1;}else{return 0;}},"avg":function(a,e,f){return parseFloat(a||0)+parseFloat((f[e]||0));}}});})(jQuery);