(function(b){b.widget("ui.multiselect",{_init:function(){this.element.hide();this.id=this.element.attr("id");this.container=b('<div class="ui-multiselect ui-helper-clearfix ui-widget"></div>').insertAfter(this.element);this.count=0;this.selectedContainer=b('<div class="selected"></div>').appendTo(this.container);
this.availableContainer=b('<div class="available"></div>').appendTo(this.container);this.selectedActions=b('<div class="actions ui-widget-header ui-helper-clearfix"><span class="count">0 '+b.ui.multiselect.locale.itemsCount+'</span><a href="#" class="remove-all">'+b.ui.multiselect.locale.removeAll+"</a></div>").appendTo(this.selectedContainer);
this.availableActions=b('<div class="actions ui-widget-header ui-helper-clearfix"><input type="text" class="search empty ui-widget-content ui-corner-all"/><a href="#" class="add-all">'+b.ui.multiselect.locale.addAll+"</a></div>").appendTo(this.availableContainer);this.selectedList=b('<ul class="selected connected-list"><li class="ui-helper-hidden-accessible"></li></ul>').bind("selectstart",function(){return false;
}).appendTo(this.selectedContainer);this.availableList=b('<ul class="available connected-list"><li class="ui-helper-hidden-accessible"></li></ul>').bind("selectstart",function(){return false;}).appendTo(this.availableContainer);var a=this;this.container.width(this.element.width()+1);this.selectedContainer.width(Math.floor(this.element.width()*this.options.dividerLocation));
this.availableContainer.width(Math.floor(this.element.width()*(1-this.options.dividerLocation)));this.selectedList.height(Math.max(this.element.height()-this.selectedActions.height(),1));this.availableList.height(Math.max(this.element.height()-this.availableActions.height(),1));if(!this.options.animated){this.options.show="show";
this.options.hide="hide";}this._populateLists(this.element.find("option"));if(this.options.sortable){b("ul.selected").sortable({placeholder:"ui-state-highlight",axis:"y",update:function(f,e){a.selectedList.find("li").each(function(){if(b(this).data("optionLink")){b(this).data("optionLink").remove().appendTo(a.element);
}});},receive:function(f,e){e.item.data("optionLink").attr("selected",true);a.count+=1;a._updateCount();a.selectedList.children(".ui-draggable").each(function(){b(this).removeClass("ui-draggable");b(this).data("optionLink",e.item.data("optionLink"));b(this).data("idx",e.item.data("idx"));a._applyItemState(b(this),true);
});setTimeout(function(){e.item.remove();},1);}});}if(this.options.searchable){this._registerSearchEvents(this.availableContainer.find("input.search"));}else{b(".search").hide();}b(".remove-all").click(function(){a._populateLists(a.element.find("option").removeAttr("selected"));return false;});b(".add-all").click(function(){a._populateLists(a.element.find("option").attr("selected","selected"));
return false;});},destroy:function(){this.element.show();this.container.remove();b.widget.prototype.destroy.apply(this,arguments);},_populateLists:function(f){this.selectedList.children(".ui-element").remove();this.availableList.children(".ui-element").remove();this.count=0;var e=this;var a=b(f.map(function(d){var c=e._getOptionNode(this).appendTo(this.selected?e.selectedList:e.availableList).show();
if(this.selected){e.count+=1;}e._applyItemState(c,this.selected);c.data("idx",d);return c[0];}));this._updateCount();},_updateCount:function(){this.selectedContainer.find("span.count").text(this.count+" "+b.ui.multiselect.locale.itemsCount);},_getOptionNode:function(a){a=b(a);var d=b('<li class="ui-state-default ui-element" title="'+a.text()+'"><span class="ui-icon"/>'+a.text()+'<a href="#" class="action"><span class="ui-corner-all ui-icon"/></a></li>').hide();
d.data("optionLink",a);return d;},_cloneWithData:function(d){var a=d.clone();a.data("optionLink",d.data("optionLink"));a.data("idx",d.data("idx"));return a;},_setSelected:function(a,o){a.data("optionLink").attr("selected",o);if(o){var p=this._cloneWithData(a);a[this.options.hide](this.options.animated,function(){b(this).remove();
});p.appendTo(this.selectedList).hide()[this.options.show](this.options.animated);this._applyItemState(p,true);return p;}else{var m=this.availableList.find("li"),r=this.options.nodeComparator;var l=null,n=a.data("idx"),i=r(a,b(m[n]));if(i){while(n>=0&&n<m.length){i>0?n++:n--;if(i!=r(a,b(m[n]))){l=m[i>0?n:n+1];
break;}}}else{l=m[n];}var q=this._cloneWithData(a);l?q.insertBefore(b(l)):q.appendTo(this.availableList);a[this.options.hide](this.options.animated,function(){b(this).remove();});q.hide()[this.options.show](this.options.animated);this._applyItemState(q,false);return q;}},_applyItemState:function(d,a){if(a){if(this.options.sortable){d.children("span").addClass("ui-icon-arrowthick-2-n-s").removeClass("ui-helper-hidden").addClass("ui-icon");
}else{d.children("span").removeClass("ui-icon-arrowthick-2-n-s").addClass("ui-helper-hidden").removeClass("ui-icon");}d.find("a.action span").addClass("ui-icon-minus").removeClass("ui-icon-plus");this._registerRemoveEvents(d.find("a.action"));}else{d.children("span").removeClass("ui-icon-arrowthick-2-n-s").addClass("ui-helper-hidden").removeClass("ui-icon");
d.find("a.action span").addClass("ui-icon-plus").removeClass("ui-icon-minus");this._registerAddEvents(d.find("a.action"));}this._registerHoverEvents(d);},_filter:function(i){var l=b(this);var j=i.children("li"),a=j.map(function(){return b(this).text().toLowerCase();});var k=b.trim(l.val().toLowerCase()),h=[];
if(!k){j.show();}else{j.hide();a.each(function(c){if(this.indexOf(k)>-1){h.push(c);}});b.each(h,function(){b(j[this]).show();});}},_registerHoverEvents:function(a){a.removeClass("ui-state-hover");a.mouseover(function(){b(this).addClass("ui-state-hover");});a.mouseout(function(){b(this).removeClass("ui-state-hover");
});},_registerAddEvents:function(d){var a=this;d.click(function(){var c=a._setSelected(b(this).parent(),true);a.count+=1;a._updateCount();return false;}).each(function(){b(this).parent().draggable({connectToSortable:"ul.selected",helper:function(){var c=a._cloneWithData(b(this)).width(b(this).width()-50);
c.width(b(this).width());return c;},appendTo:".ui-multiselect",containment:".ui-multiselect",revert:"invalid"});});},_registerRemoveEvents:function(d){var a=this;d.click(function(){a._setSelected(b(this).parent(),false);a.count-=1;a._updateCount();return false;});},_registerSearchEvents:function(a){var d=this;
a.focus(function(){b(this).addClass("ui-state-active");}).blur(function(){b(this).removeClass("ui-state-active");}).keypress(function(c){if(c.keyCode==13){return false;}}).keyup(function(){d._filter.apply(this,[d.availableList]);});}});b.extend(b.ui.multiselect,{defaults:{sortable:true,searchable:true,animated:"fast",show:"slideDown",hide:"slideUp",dividerLocation:0.6,nodeComparator:function(h,a){var f=h.text(),g=a.text();
return f==g?0:(f<g?-1:1);}},locale:{addAll:"Add all",removeAll:"Remove all",itemsCount:"items selected"}});})(jQuery);