(function(b){b.jgrid.extend({editRow:function(q,k,l,a,r,o,p,n,m){return this.each(function(){var g=this,t,f,i,h=0,c=null,d={},j,e;if(!g.grid){return;}j=b(g).jqGrid("getInd",q,true);if(j===false){return;}i=b(j).attr("editable")||"0";if(i=="0"&&!b(j).hasClass("not-editable-row")){e=g.p.colModel;b("td",j).each(function(y){t=e[y].name;
var z=g.p.treeGrid===true&&t==g.p.ExpandColumn;if(z){f=b("span:first",this).html();}else{try{f=b.unformat(this,{rowId:q,colModel:e[y]},y);}catch(B){f=b(this).html();}}if(t!="cb"&&t!="subgrid"&&t!="rn"){if(g.p.autoencode){f=b.jgrid.htmlDecode(f);}d[t]=f;if(e[y].editable===true){if(c===null){c=y;}if(z){b("span:first",this).html("");
}else{b(this).html("");}var A=b.extend({},e[y].editoptions||{},{id:q+"_"+t,name:t});if(!e[y].edittype){e[y].edittype="text";}var s=b.jgrid.createEl(e[y].edittype,A,f,true,b.extend({},b.jgrid.ajaxOptions,g.p.ajaxSelectOptions||{}));b(s).addClass("editable");if(z){b("span:first",this).append(s);}else{b(this).append(s);
}if(e[y].edittype=="select"&&e[y].editoptions.multiple===true&&b.browser.msie){b(s).width(b(s).width());}h++;}}});if(h>0){d.id=q;g.p.savedRow.push(d);b(j).attr("editable","1");b("td:eq("+c+") input",j).focus();if(k===true){b(j).bind("keydown",function(s){if(s.keyCode===27){b(g).jqGrid("restoreRow",q,m);
}if(s.keyCode===13){var v=s.target;if(v.tagName=="TEXTAREA"){return true;}b(g).jqGrid("saveRow",q,a,r,o,p,n,m);return false;}s.stopPropagation();});}if(b.isFunction(l)){l.call(g,q);}}}});},saveRow:function(i,j,l,k,m,n,a){return this.each(function(){var c=this,C,I={},h={},A,G,H,B;if(!c.grid){return;}B=b(c).jqGrid("getInd",i,true);
if(B===false){return;}A=b(B).attr("editable");l=l?l:c.p.editurl;if(A==="1"){var D;b("td",B).each(function(r){D=c.p.colModel[r];C=D.name;if(C!="cb"&&C!="subgrid"&&D.editable===true&&C!="rn"){switch(D.edittype){case"checkbox":var p=["Yes","No"];if(D.editoptions){p=D.editoptions.value.split(":");}I[C]=b("input",this).attr("checked")?p[0]:p[1];
break;case"text":case"password":case"textarea":case"button":I[C]=b("input, textarea",this).val();break;case"select":if(!D.editoptions.multiple){I[C]=b("select>option:selected",this).val();h[C]=b("select>option:selected",this).text();}else{var o=b("select",this),q=[];I[C]=b(o).val();if(I[C]){I[C]=I[C].join(",");
}else{I[C]="";}b("select > option:selected",this).each(function(u,t){q[u]=b(t).text();});h[C]=q.join(",");}if(D.formatter&&D.formatter=="select"){h={};}break;case"custom":try{if(D.editoptions&&b.isFunction(D.editoptions.custom_value)){I[C]=D.editoptions.custom_value.call(c,b(".customelement",this),"get");
if(I[C]===undefined){throw"e2";}}else{throw"e1";}}catch(s){if(s=="e1"){b.jgrid.info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+b.jgrid.edit.msg.nodefined,jQuery.jgrid.edit.bClose);}if(s=="e2"){b.jgrid.info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+b.jgrid.edit.msg.novalue,jQuery.jgrid.edit.bClose);
}else{b.jgrid.info_dialog(jQuery.jgrid.errors.errcap,s.message,jQuery.jgrid.edit.bClose);}}break;}H=b.jgrid.checkValues(I[C],r,c);if(H[0]===false){H[1]=I[C]+" "+H[1];return false;}if(c.p.autoencode){I[C]=b.jgrid.htmlEncode(I[C]);}}});if(H[0]===false){try{var d=b.jgrid.findPos(b("#"+b.jgrid.jqID(i),c.grid.bDiv)[0]);
b.jgrid.info_dialog(b.jgrid.errors.errcap,H[1],b.jgrid.edit.bClose,{left:d[0],top:d[1]});}catch(E){alert(H[1]);}return;}if(I){var F,e,z;e=c.p.prmNames;z=e.oper;F=e.id;I[z]=e.editoper;I[F]=i;if(typeof(c.p.inlineData)=="undefined"){c.p.inlineData={};}if(typeof(k)=="undefined"){k={};}I=b.extend({},I,c.p.inlineData,k);
}if(l=="clientArray"){I=b.extend({},I,h);if(c.p.autoencode){b.each(I,function(p,o){I[p]=b.jgrid.htmlDecode(o);});}var f=b(c).jqGrid("setRowData",i,I);b(B).attr("editable","0");for(var g=0;g<c.p.savedRow.length;g++){if(c.p.savedRow[g].id==i){G=g;break;}}if(G>=0){c.p.savedRow.splice(G,1);}if(b.isFunction(m)){m.call(c,i,f);
}}else{b("#lui_"+c.p.id).show();b.ajax(b.extend({url:l,data:b.isFunction(c.p.serializeRowData)?c.p.serializeRowData.call(c,I):I,type:"POST",complete:function(r,q){b("#lui_"+c.p.id).hide();if(q==="success"){var o;if(b.isFunction(j)){o=j.call(c,r);}else{o=true;}if(o===true){if(c.p.autoencode){b.each(I,function(t,s){I[t]=b.jgrid.htmlDecode(s);
});}I=b.extend({},I,h);b(c).jqGrid("setRowData",i,I);b(B).attr("editable","0");for(var p=0;p<c.p.savedRow.length;p++){if(c.p.savedRow[p].id==i){G=p;break;}}if(G>=0){c.p.savedRow.splice(G,1);}if(b.isFunction(m)){m.call(c,i,r);}}else{if(b.isFunction(n)){n.call(c,i,r,q);}b(c).jqGrid("restoreRow",i,a);}}},error:function(o,p){b("#lui_"+c.p.id).hide();
if(b.isFunction(n)){n.call(c,i,o,p);}else{alert("Error Row: "+i+" Result: "+o.status+":"+o.statusText+" Status: "+p);}b(c).jqGrid("restoreRow",i,a);}},b.jgrid.ajaxOptions,c.p.ajaxRowOptions||{}));}b(B).unbind("keydown");}});},restoreRow:function(d,a){return this.each(function(){var c=this,n,l,e={};if(!c.grid){return;
}l=b(c).jqGrid("getInd",d,true);if(l===false){return;}for(var m=0;m<c.p.savedRow.length;m++){if(c.p.savedRow[m].id==d){n=m;break;}}if(n>=0){if(b.isFunction(b.fn.datepicker)){try{b("input.hasDatepicker","#"+b.jgrid.jqID(l.id)).datepicker("hide");}catch(k){}}b.each(c.p.colModel,function(g,f){if(this.editable===true&&this.name in c.p.savedRow[n]){e[this.name]=c.p.savedRow[n][this.name];
}});b(c).jqGrid("setRowData",d,e);b(l).attr("editable","0").unbind("keydown");c.p.savedRow.splice(n,1);}if(b.isFunction(a)){a.call(c,d);}});}});})(jQuery);