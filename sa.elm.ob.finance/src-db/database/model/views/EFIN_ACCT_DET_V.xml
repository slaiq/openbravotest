<?xml version="1.0"?>
  <database name="VIEW EFIN_ACCT_DET_V">
    <view name="EFIN_ACCT_DET_V"><![CDATA[SELECT org.value AS organization, elm.value AS account, elm.name AS account_name, dept.value AS dept, camp.value AS budget_type, init.name AS fin_year, date_part('year', per.startdate) AS gregorian_year, inq.current_budget, ord.documentno AS po_no FROM efin_budgetinquiry inq JOIN efin_acct_chapter_report_v chp ON chp.efin_acct_chapter_report_v_id = inq.c_elementvalue_id AND chp.accounttype = 'E' AND (chp.chapter = '3' OR chp.chapter = '4') LEFT JOIN efin_budgetint init ON init.efin_budgetint_id = inq.efin_budgetint_id LEFT JOIN efin_budget_ctrl_param bctrl ON bctrl.ad_client_id = inq.ad_client_id LEFT JOIN c_period per ON per.c_period_id = init.toperiod LEFT JOIN c_elementvalue elm ON elm.c_elementvalue_id = inq.c_elementvalue_id LEFT JOIN c_campaign camp ON camp.c_campaign_id = inq.c_campaign_id LEFT JOIN c_salesregion dept ON dept.c_salesregion_id = inq.c_salesregion_id LEFT JOIN ad_org org ON org.ad_org_id = inq.ad_org_id LEFT JOIN (SELECT vc.account_id, vc.ad_org_id, ord_1.em_efin_budgetint_id, vc.c_campaign_id, ord_1.documentno, ord_1.em_escm_letter_no, ord_1.em_escm_maintenance_cntrct_no, ord_1.em_escm_notes FROM c_orderline ordln JOIN c_order ord_1 ON ord_1.c_order_id = ordln.c_order_id JOIN escm_ordermaxrevisionyear_v maxversion ON maxversion.documentno = ord_1.documentno AND maxversion.em_efin_budgetint_id = ord_1.em_efin_budgetint_id AND ord_1.em_escm_revision = maxversion.max JOIN c_validcombination vc ON vc.c_validcombination_id = ordln.em_efin_c_validcombination_id WHERE ord_1.em_escm_appstatus = 'ESCM_AP' GROUP BY vc.account_id, vc.ad_org_id, ord_1.em_efin_budgetint_id, vc.c_campaign_id, ord_1.documentno, ord_1.em_escm_letter_no, ord_1.em_escm_maintenance_cntrct_no, ord_1.em_escm_notes) ord ON ord.account_id = inq.c_elementvalue_id AND ord.ad_org_id = inq.ad_org_id AND ord.em_efin_budgetint_id = inq.efin_budgetint_id AND ord.c_campaign_id = inq.c_campaign_id AND inq.c_salesregion_id = bctrl.budgetcontrol_costcenter WHERE inq.current_budget > 0 ORDER BY elm.value, camp.value]]></view>
  </database>
