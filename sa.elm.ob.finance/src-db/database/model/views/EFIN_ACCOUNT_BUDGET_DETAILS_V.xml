<?xml version="1.0"?>
  <database name="VIEW EFIN_ACCOUNT_BUDGET_DETAILS_V">
    <view name="EFIN_ACCOUNT_BUDGET_DETAILS_V"><![CDATA[SELECT ele.value AS account_code, ele.name AS account_name, COALESCE(enq.current_budget, 0) AS total_cost, COALESCE(fund.current_budget, 0) AS total_funds_budget, COALESCE(enq.encumbrance, 0) AS encumbrance_amount, COALESCE(enq.funds_available, 0) AS funds_availble, COALESCE((SELECT round(sum(line.linenetamt), 2) AS round FROM c_order ord JOIN (SELECT max(ord_1.em_escm_revision) AS revison_no, ord_1.documentno FROM c_order ord_1 JOIN c_orderline line_1 ON line_1.c_order_id = ord_1.c_order_id GROUP BY ord_1.documentno) abc ON abc.revison_no = ord.em_escm_revision AND abc.documentno = ord.documentno JOIN c_orderline line ON line.c_order_id = ord.c_order_id WHERE line.em_efin_c_validcombination_id = com.c_validcombination_id AND ord.em_escm_appstatus = 'ESCM_AP' AND line.em_efin_bud_encumlines_id IS NOT NULL GROUP BY line.em_efin_c_validcombination_id), 0) AS total_contract FROM c_elementvalue ele JOIN c_validcombination com ON ele.c_elementvalue_id = com.account_id AND com.c_campaign_id = '8CFC8D85BC484DC7AFB75E3DA60FE30F' AND com.c_salesregion_id = '1057C4B86E2B4B119D05BEDBCC8D07CF' AND ele.em_efin_project_id = com.c_project_id LEFT JOIN efin_budgetinquiry enq ON enq.c_elementvalue_id = com.account_id AND enq.c_salesregion_id = '38E2AC97B70641F2AF72CBB634935FC4' AND enq.c_campaign_id = '8CFC8D85BC484DC7AFB75E3DA60FE30F' LEFT JOIN efin_budgetinquiry fund ON fund.c_elementvalue_id = com.account_id AND fund.c_salesregion_id = '38E2AC97B70641F2AF72CBB634935FC4' AND fund.c_campaign_id = '11F9670AC2DC499885BAE97494C595AD' GROUP BY com.c_validcombination_id, enq.funds_available, ele.value, ele.name, enq.current_budget, fund.current_budget, enq.encumbrance ORDER BY ele.value]]></view>
  </database>
