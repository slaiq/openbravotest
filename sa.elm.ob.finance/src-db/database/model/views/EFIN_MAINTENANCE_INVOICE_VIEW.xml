<?xml version="1.0"?>
  <database name="VIEW EFIN_MAINTENANCE_INVOICE_VIEW">
    <view name="EFIN_MAINTENANCE_INVOICE_VIEW"><![CDATA[SELECT DISTINCT a.documentno AS po_number, (SELECT etac.city FROM c_orderline ol JOIN c_validcombination cvc ON ol.em_efin_c_validcombination_id = cvc.c_validcombination_id AND ol.em_efin_c_validcombination_id IS NOT NULL JOIN c_elementvalue cev ON cvc.account_id = cev.c_elementvalue_id JOIN escm_temp_account_city etac ON cev.value = etac.account WHERE a.c_order_id = ol.c_order_id GROUP BY ol.em_efin_c_validcombination_id, etac.city) AS city_from_unique_name, bp.value AS supplier_id, bp.name AS supplier_name, a.dateordered AS po_date, reftrl.name AS contract_status, a.grandtotal AS net_total_amount, c_budget_data.current_budget AS current_budget_for_unique_code, c_budget_data.account_code, c_budget_data.account_name, rdvtxn.certificate_no, rdvtxn.certificate_date, rdvtxn.match_amt AS po_reciept_total_amount, (SELECT dtln.name FROM ad_reference dt JOIN ad_ref_list dtln ON dt.ad_reference_id = dtln.ad_reference_id WHERE dtln.value = inv.docstatus AND dt.name = 'Document Status - Invoice') AS invoice_status, (SELECT max(efin_purchasein_app_hist.created) AS created FROM efin_purchasein_app_hist WHERE efin_purchasein_app_hist.c_invoice_id = inv.c_invoice_id AND inv.docstatus = 'CO') AS invoice_date, inv.grandtotal AS rdv_payment_total_gross_amount, CASE WHEN a.em_escm_int_system_name IS NOT NULL AND a.em_escm_int_system_desc IS NOT NULL THEN (a.em_escm_int_system_name || ' - ') || a.em_escm_int_system_desc ELSE NULL END AS ingration_system_name FROM c_order a JOIN (SELECT max(ord_1.em_escm_revision) AS revison_no, ord_1.documentno FROM c_order ord_1 GROUP BY ord_1.documentno) lv ON lv.documentno = a.documentno AND a.em_escm_revision = lv.revison_no JOIN c_bpartner bp ON bp.c_bpartner_id = a.c_bpartner_id JOIN efin_rdv rdv ON rdv.c_order_id = a.c_order_id JOIN efin_rdvtxn rdvtxn ON rdvtxn.efin_rdv_id = rdv.efin_rdv_id LEFT JOIN c_invoice inv ON inv.c_invoice_id = rdvtxn.c_invoice_id LEFT JOIN ad_ref_list reflist ON reflist.value = a.em_escm_appstatus LEFT JOIN ad_ref_list_trl reftrl ON reftrl.ad_ref_list_id = reflist.ad_ref_list_id LEFT JOIN (SELECT DISTINCT rdvt.efin_rdv_id, cev.value AS account_code, sum(ebi.current_budget) AS current_budget, cev.name AS account_name FROM efin_rdvtxnline rdvt JOIN c_validcombination cvc ON rdvt.c_validcombination_id = cvc.c_validcombination_id JOIN c_elementvalue cev ON cvc.account_id = cev.c_elementvalue_id JOIN efin_budgetinquiry ebi ON cev.c_elementvalue_id = ebi.c_elementvalue_id AND ebi.c_campaign_id = cvc.c_campaign_id WHERE ebi.c_salesregion_id = '38E2AC97B70641F2AF72CBB634935FC4' GROUP BY cev.value, cev.name, rdvt.efin_rdv_id) c_budget_data ON rdv.efin_rdv_id = c_budget_data.efin_rdv_id WHERE a.em_escm_contact_type = '1A36983FF3FC4FC695FF700A38BDB12D' ORDER BY a.documentno]]></view>
  </database>
