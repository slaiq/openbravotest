<?xml version="1.0"?>
  <database name="VIEW EFIN_BUDGETINQENCUM_V">
    <view name="EFIN_BUDGETINQENCUM_V"><![CDATA[SELECT a.efin_budgetinqencum_v_id, a.efin_budget_manencumlines_id, a.efin_budget_manencum_id, a.efin_budgetint_id, a.ad_client_id, a.ad_org_id, a.isactive, a.created, a.createdby, a.updated, a.updatedby, a.dateacct, a.documentno, a.encum_type, a.encum_stage, a.encum_method, a.amount, a.docstatus, a.description, a.c_validcombination_id, a.uniquecodename, a.type, a.transactionno FROM (SELECT encmln.efin_budget_manencumlines_id AS efin_budgetinqencum_v_id, encmln.efin_budget_manencumlines_id, encm.efin_budget_manencum_id, encm.efin_budgetint_id, encm.ad_client_id, encm.ad_org_id, encm.isactive, encm.created, encm.createdby, encm.updated, encm.updatedby, encm.dateacct, encm.documentno, encm.encum_type, encm.encum_stage, encm.encum_method, encmln.remaining_amount AS amount, encm.docstatus, encmln.description, encmln.c_validcombination_id, encmln.uniquecodename, 'OE' AS type, '' AS transactionno FROM efin_budget_manencumlines encmln LEFT JOIN efin_budget_manencum encm ON encmln.efin_budget_manencum_id = encm.efin_budget_manencum_id WHERE encm.docstatus = 'CO' AND CASE WHEN encm.encum_type = 'TE' THEN encm.revamount <> 0 ELSE 1 = 1 END UNION ALL SELECT mi.efin_manualencuminvoice_id AS efin_budgetinqencum_v_id, mi.efin_budget_manencumlines_id, el.efin_budget_manencum_id, i.em_efin_budgetint_id AS efin_budgetint_id, mi.ad_client_id, mi.ad_org_id, mi.isactive, mi.created, mi.createdby, mi.updated, mi.updatedby, i.dateacct, e.documentno, e.encum_type, e.encum_stage, e.encum_method, mi.invamount AS amount, i.docstatus, i.description, el.c_validcombination_id, el.uniquecodename, 'OE' AS type, i.documentno AS transactionno FROM efin_manualencuminvoice mi JOIN efin_budget_manencumlines el ON el.efin_budget_manencumlines_id = mi.efin_budget_manencumlines_id JOIN efin_budget_manencum e ON e.efin_budget_manencum_id = el.efin_budget_manencum_id JOIN c_invoice i ON i.c_invoice_id = mi.c_invoice_id JOIN c_campaign bt ON bt.c_campaign_id = e.c_campaign_id WHERE mi.ispaid = 'N' UNION ALL SELECT li.efin_budget_manencumlines_id AS efin_budgetinqencum_v_id, li.efin_budget_manencumlines_id, en.efin_budget_manencum_id, en.efin_budgetint_id, en.ad_client_id, en.ad_org_id, en.isactive, en.created, en.createdby, en.updated, en.updatedby, en.dateacct, en.documentno, en.encum_type, en.encum_stage, en.encum_method, li.app_amt AS amount, en.docstatus, li.description, li.c_validcombination_id, li.uniquecodename, 'OE' AS type, '' AS transactionno FROM efin_budget_manencumlines li LEFT JOIN efin_budget_manencum en ON en.efin_budget_manencum_id = li.efin_budget_manencum_id WHERE en.encum_method = 'A' AND li.app_amt > 0 AND li.remaining_amount = 0 AND li.used_amount = 0 AND NOT (li.efin_budget_manencumlines_id IN (SELECT inv.efin_budget_manencumlines_id FROM efin_manualencuminvoice inv WHERE inv.efin_budget_manencumlines_id = li.efin_budget_manencumlines_id)) AND (en.encum_type NOT IN ('PAE', 'PRE', 'POE', 'BE')) UNION ALL SELECT li.efin_budget_manencumlines_id AS efin_budgetinqencum_v_id, li.efin_budget_manencumlines_id, en.efin_budget_manencum_id, en.efin_budgetint_id, en.ad_client_id, en.ad_org_id, en.isactive, en.created, en.createdby, en.updated, en.updatedby, en.dateacct, en.documentno, en.encum_type, en.encum_stage, en.encum_method, li.amount, en.docstatus, li.description, li.c_validcombination_id, li.uniquecodename, 'OE' AS type, '' AS transactionno FROM efin_budget_manencumlines li LEFT JOIN efin_budget_manencum en ON en.efin_budget_manencum_id = li.efin_budget_manencum_id WHERE en.isreservedfund = 'Y' AND en.action = 'AP') a WHERE CASE WHEN a.type = 'SM' OR a.type = 'REV' THEN 1 = 1 AND a.docstatus <> 'EFIN_CA' ELSE a.amount > 0 AND a.docstatus <> 'EFIN_CA' AND a.docstatus <> 'CA' END UNION ALL SELECT get_uuid() AS efin_budgetinqencum_v_id, li.efin_budget_manencumlines_id, line.efin_budget_manencum_id, en.efin_budgetint_id, li.ad_client_id, li.ad_org_id, li.isactive, li.created, li.createdby, li.updated, li.updatedby, en.dateacct, en.documentno, en.encum_type, en.encum_stage, en.encum_method, li.amount, en.docstatus, '' AS description, line.c_validcombination_id, line.uniquecodename, 'OE' AS type, li.documentno AS transactionno FROM escm_encumbrance_history_v li JOIN efin_budget_manencumlines line ON line.efin_budget_manencumlines_id = li.efin_budget_manencumlines_id JOIN efin_budget_manencum en ON en.efin_budget_manencum_id = line.efin_budget_manencum_id WHERE li.status <> 'CA']]></view>
  </database>
