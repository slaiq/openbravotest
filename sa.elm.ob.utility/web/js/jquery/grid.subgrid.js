(function(b){b.jgrid.extend({setSubGrid:function(){return this.each(function(){var e=this,a;e.p.colNames.unshift("");e.p.colModel.unshift({name:"subgrid",width:b.browser.safari?e.p.subGridWidth+e.p.cellLayout:e.p.subGridWidth,sortable:false,resizable:false,hidedlg:true,search:false,fixed:true});a=e.p.subGridModel;
if(a[0]){a[0].align=b.extend([],a[0].align||[]);for(var f=0;f<a[0].name.length;f++){a[0].align[f]=a[0].align[f]||"left";}}});},addSubGridCell:function(g,i){var j="",h,a;this.each(function(){j=this.formatCol(g,i);h=this.p.gridview;a=this.p.id;});if(h===false){return'<td role="grid" aria-describedby="'+a+'_subgrid" class="ui-sgcollapsed sgcollapsed" '+j+"><a href='javascript:void(0);'><span class='ui-icon ui-icon-plus'></span></a></td>";
}else{return'<td role="grid" aria-describedby="'+a+'_subgrid" '+j+"></td>";}},addSubGrid:function(a,d){return this.each(function(){var s=this;if(!s.grid){return;}var y=function(g,h,e){var f=b("<td align='"+s.p.subGridModel[0].align[e]+"'></td>").html(h);b(g).append(f);};var z=function(k,e){var f,h,i,g=b("<table cellspacing='0' cellpadding='0' border='0'><tbody></tbody></table>"),l=b("<tr></tr>");
for(h=0;h<s.p.subGridModel[0].name.length;h++){f=b("<th class='ui-state-default ui-th-subgrid ui-th-column ui-th-"+s.p.direction+"'></th>");b(f).html(s.p.subGridModel[0].name[h]);b(f).width(s.p.subGridModel[0].width[h]);b(l).append(f);}b(g).append(l);if(k){i=s.p.xmlReader.subgrid;b(i.root+" "+i.row,k).each(function(){l=b("<tr class='ui-widget-content ui-subtblcell'></tr>");
if(i.repeatitems===true){b(i.cell,this).each(function(n){y(l,b(this).text()||"&#160;",n);});}else{var m=s.p.subGridModel[0].mapping||s.p.subGridModel[0].name;if(m){for(h=0;h<m.length;h++){y(l,b(m[h],this).text()||"&#160;",h);}}}b(g).append(l);});}var j=b("table:first",s.grid.bDiv).attr("id")+"_";b("#"+j+e).append(g);
s.grid.hDiv.loading=false;b("#load_"+s.p.id).hide();return false;};var x=function(l,o){var j,h,n,k,g,B,e=b("<table cellspacing='0' cellpadding='0' border='0'><tbody></tbody></table>"),f=b("<tr></tr>");for(n=0;n<s.p.subGridModel[0].name.length;n++){j=b("<th class='ui-state-default ui-th-subgrid ui-th-column ui-th-"+s.p.direction+"'></th>");
b(j).html(s.p.subGridModel[0].name[n]);b(j).width(s.p.subGridModel[0].width[n]);b(f).append(j);}b(e).append(f);if(l){g=s.p.jsonReader.subgrid;h=l[g.root];if(typeof h!=="undefined"){for(n=0;n<h.length;n++){k=h[n];f=b("<tr class='ui-widget-content ui-subtblcell'></tr>");if(g.repeatitems===true){if(g.cell){k=k[g.cell];
}for(B=0;B<k.length;B++){y(f,k[B]||"&#160;",B);}}else{var m=s.p.subGridModel[0].mapping||s.p.subGridModel[0].name;if(m.length){for(B=0;B<m.length;B++){y(f,k[m[B]]||"&#160;",B);}}}b(e).append(f);}}}var i=b("table:first",s.grid.bDiv).attr("id")+"_";b("#"+i+o).append(e);s.grid.hDiv.loading=false;b("#load_"+s.p.id).hide();
return false;};var q=function(f){var i,e,g,h;i=b(f).attr("id");e={nd_:(new Date().getTime())};e[s.p.prmNames.subgridid]=i;if(!s.p.subGridModel[0]){return false;}if(s.p.subGridModel[0].params){for(h=0;h<s.p.subGridModel[0].params.length;h++){for(g=0;g<s.p.colModel.length;g++){if(s.p.colModel[g].name==s.p.subGridModel[0].params[h]){e[s.p.colModel[g].name]=b("td:eq("+g+")",f).text().replace(/\&#160\;/ig,"");
}}}}if(!s.grid.hDiv.loading){s.grid.hDiv.loading=true;b("#load_"+s.p.id).show();if(!s.p.subgridtype){s.p.subgridtype=s.p.datatype;}if(b.isFunction(s.p.subgridtype)){s.p.subgridtype.call(s,e);}else{s.p.subgridtype=s.p.subgridtype.toLowerCase();}switch(s.p.subgridtype){case"xml":case"json":b.ajax(b.extend({type:s.p.mtype,url:s.p.subGridUrl,dataType:s.p.subgridtype,data:b.isFunction(s.p.serializeSubGridData)?s.p.serializeSubGridData.call(s,e):e,complete:function(j){if(s.p.subgridtype=="xml"){z(j.responseXML,i);
}else{x(b.jgrid.parse(j.responseText),i);}j=null;}},b.jgrid.ajaxOptions,s.p.ajaxSubgridOptions||{}));break;}}return false;};var r,p,c,u,t,v,w;b("td:eq("+d+")",a).click(function(e){if(b(this).hasClass("sgcollapsed")){c=s.p.id;r=b(this).parent();u=d>=1?"<td colspan='"+d+"'>&#160;</td>":"";p=b(r).attr("id");
w=true;if(b.isFunction(s.p.subGridBeforeExpand)){w=s.p.subGridBeforeExpand.call(s,c+"_"+p,p);}if(w===false){return false;}t=0;b.each(s.p.colModel,function(f,g){if(this.hidden===true||this.name=="rn"||this.name=="cb"){t++;}});v="<tr role='row' class='ui-subgrid'>"+u+"<td class='ui-widget-content subgrid-cell'><span class='ui-icon ui-icon-carat-1-sw'/></td><td colspan='"+parseInt(s.p.colNames.length-1-t,10)+"' class='ui-widget-content subgrid-data'><div id="+c+"_"+p+" class='tablediv'>";
b(this).parent().after(v+"</div></td></tr>");if(b.isFunction(s.p.subGridRowExpanded)){s.p.subGridRowExpanded.call(s,c+"_"+p,p);}else{q(r);}b(this).html("<a href='javascript:void(0);'><span class='ui-icon ui-icon-minus'></span></a>").removeClass("sgcollapsed").addClass("sgexpanded");}else{if(b(this).hasClass("sgexpanded")){w=true;
if(b.isFunction(s.p.subGridRowColapsed)){r=b(this).parent();p=b(r).attr("id");w=s.p.subGridRowColapsed.call(s,c+"_"+p,p);}if(w===false){return false;}b(this).parent().next().remove(".ui-subgrid");b(this).html("<a href='javascript:void(0);'><span class='ui-icon ui-icon-plus'></span></a>").removeClass("sgexpanded").addClass("sgcollapsed");
}}return false;});s.subGridXml=function(e,f){z(e,f);};s.subGridJson=function(e,f){x(e,f);};});},expandSubGridRow:function(a){return this.each(function(){var f=this;if(!f.grid&&!a){return;}if(f.p.subGrid===true){var h=b(this).jqGrid("getInd",a,true);if(h){var g=b("td.sgcollapsed",h)[0];if(g){b(g).trigger("click");
}}}});},collapseSubGridRow:function(a){return this.each(function(){var f=this;if(!f.grid&&!a){return;}if(f.p.subGrid===true){var h=b(this).jqGrid("getInd",a,true);if(h){var g=b("td.sgexpanded",h)[0];if(g){b(g).trigger("click");}}}});},toggleSubGridRow:function(a){return this.each(function(){var f=this;
if(!f.grid&&!a){return;}if(f.p.subGrid===true){var h=b(this).jqGrid("getInd",a,true);if(h){var g=b("td.sgcollapsed",h)[0];if(g){b(g).trigger("click");}else{g=b("td.sgexpanded",h)[0];if(g){b(g).trigger("click");}}}}});}});})(jQuery);