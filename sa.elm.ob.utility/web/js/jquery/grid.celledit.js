(function(b){b.jgrid.extend({editCell:function(e,f,a){return this.each(function(){var c=this,r,o,d;if(!c.grid||c.p.cellEdit!==true){return;}f=parseInt(f,10);c.p.selrow=c.rows[e].id;if(!c.p.knv){b(c).jqGrid("GridNav");}if(c.p.savedRow.length>0){if(a===true){if(e==c.p.iRow&&f==c.p.iCol){return;}}b(c).jqGrid("saveCell",c.p.savedRow[0].id,c.p.savedRow[0].ic);
}else{window.setTimeout(function(){b("#"+c.p.knv).attr("tabindex","-1").focus();},0);}r=c.p.colModel[f].name;if(r=="subgrid"||r=="cb"||r=="rn"){return;}d=b("td:eq("+f+")",c.rows[e]);if(c.p.colModel[f].editable===true&&a===true&&!d.hasClass("not-editable-cell")){if(parseInt(c.p.iCol,10)>=0&&parseInt(c.p.iRow,10)>=0){b("td:eq("+c.p.iCol+")",c.rows[c.p.iRow]).removeClass("edit-cell ui-state-highlight");
b(c.rows[c.p.iRow]).removeClass("selected-row ui-state-hover");}b(d).addClass("edit-cell ui-state-highlight");b(c.rows[e]).addClass("selected-row ui-state-hover");try{o=b.unformat(d,{rowId:c.rows[e].id,colModel:c.p.colModel[f]},f);}catch(q){o=b(d).html();}if(c.p.autoencode){o=b.jgrid.htmlDecode(o);}if(!c.p.colModel[f].edittype){c.p.colModel[f].edittype="text";
}c.p.savedRow.push({id:e,ic:f,name:r,v:o});if(b.isFunction(c.p.formatCell)){var n=c.p.formatCell.call(c,c.rows[e].id,r,o,e,f);if(n!==undefined){o=n;}}var p=b.extend({},c.p.colModel[f].editoptions||{},{id:e+"_"+r,name:r});var m=b.jgrid.createEl(c.p.colModel[f].edittype,p,o,true,b.extend({},b.jgrid.ajaxOptions,c.p.ajaxSelectOptions||{}));
if(b.isFunction(c.p.beforeEditCell)){c.p.beforeEditCell.call(c,c.rows[e].id,r,o,e,f);}b(d).html("").append(m).attr("tabindex","0");window.setTimeout(function(){b(m).focus();},0);b("input, select, textarea",d).bind("keydown",function(g){if(g.keyCode===27){if(b("input.hasDatepicker",d).length>0){if(b(".ui-datepicker").is(":hidden")){b(c).jqGrid("restoreCell",e,f);
}else{b("input.hasDatepicker",d).datepicker("hide");}}else{b(c).jqGrid("restoreCell",e,f);}}if(g.keyCode===13){b(c).jqGrid("saveCell",e,f);}if(g.keyCode==9){if(!c.grid.hDiv.loading){if(g.shiftKey){b(c).jqGrid("prevCell",e,f);}else{b(c).jqGrid("nextCell",e,f);}}else{return false;}}g.stopPropagation();
});if(b.isFunction(c.p.afterEditCell)){c.p.afterEditCell.call(c,c.rows[e].id,r,o,e,f);}}else{if(parseInt(c.p.iCol,10)>=0&&parseInt(c.p.iRow,10)>=0){b("td:eq("+c.p.iCol+")",c.rows[c.p.iRow]).removeClass("edit-cell ui-state-highlight");b(c.rows[c.p.iRow]).removeClass("selected-row ui-state-hover");}d.addClass("edit-cell ui-state-highlight");
b(c.rows[e]).addClass("selected-row ui-state-hover");if(b.isFunction(c.p.onSelectCell)){o=d.html().replace(/\&#160\;/ig,"");c.p.onSelectCell.call(c,c.rows[e].id,r,o,e,f);}}c.p.iCol=f;c.p.iRow=e;});},saveCell:function(d,a){return this.each(function(){var v=this,K;if(!v.grid||v.p.cellEdit!==true){return;
}if(v.p.savedRow.length>=1){K=0;}else{K=null;}if(K!==null){var C=b("td:eq("+a+")",v.rows[d]),E,N,I=v.p.colModel[a],M=I.name,J=b.jgrid.jqID(M);switch(I.edittype){case"select":if(!I.editoptions.multiple){E=b("#"+d+"_"+J+">option:selected",v.rows[d]).val();N=b("#"+d+"_"+J+">option:selected",v.rows[d]).text();
}else{var y=b("#"+d+"_"+J,v.rows[d]),z=[];E=b(y).val();if(E){E.join(",");}else{E="";}b("option:selected",y).each(function(g,f){z[g]=b(f).text();});N=z.join(",");}if(I.formatter){N=E;}break;case"checkbox":var B=["Yes","No"];if(I.editoptions){B=I.editoptions.value.split(":");}E=b("#"+d+"_"+J,v.rows[d]).attr("checked")?B[0]:B[1];
N=E;break;case"password":case"text":case"textarea":case"button":E=b("#"+d+"_"+J,v.rows[d]).val();N=E;break;case"custom":try{if(I.editoptions&&b.isFunction(I.editoptions.custom_value)){E=I.editoptions.custom_value.call(v,b(".customelement",C),"get");if(E===undefined){throw"e2";}else{N=E;}}else{throw"e1";
}}catch(e){if(e=="e1"){b.jgrid.info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+b.jgrid.edit.msg.nodefined,jQuery.jgrid.edit.bClose);}if(e=="e2"){b.jgrid.info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+b.jgrid.edit.msg.novalue,jQuery.jgrid.edit.bClose);}else{b.jgrid.info_dialog(jQuery.jgrid.errors.errcap,e.message,jQuery.jgrid.edit.bClose);
}}break;}if(N!=v.p.savedRow[K].v){if(b.isFunction(v.p.beforeSaveCell)){var A=v.p.beforeSaveCell.call(v,v.rows[d].id,M,E,d,a);if(A){E=A;N=A;}}var L=b.jgrid.checkValues(E,a,v);if(L[0]===true){var G={};if(b.isFunction(v.p.beforeSubmitCell)){G=v.p.beforeSubmitCell.call(v,v.rows[d].id,M,E,d,a);if(!G){G={};
}}if(b("input.hasDatepicker",C).length>0){b("input.hasDatepicker",C).datepicker("hide");}if(v.p.cellsubmit=="remote"){if(v.p.cellurl){var c={};if(v.p.autoencode){E=b.jgrid.htmlEncode(E);}c[M]=E;var D,F,H;H=v.p.prmNames;D=H.id;F=H.oper;c[D]=v.rows[d].id;c[F]=H.editoper;c=b.extend(G,c);b("#lui_"+v.p.id).show();
v.grid.hDiv.loading=true;b.ajax(b.extend({url:v.p.cellurl,data:b.isFunction(v.p.serializeCellData)?v.p.serializeCellData.call(v,c):c,type:"POST",complete:function(g,h){b("#lui_"+v.p.id).hide();v.grid.hDiv.loading=false;if(h=="success"){if(b.isFunction(v.p.afterSubmitCell)){var f=v.p.afterSubmitCell.call(v,g,c.id,M,E,d,a);
if(f[0]===true){b(C).empty();b(v).jqGrid("setCell",v.rows[d].id,a,N,false,false,true);b(C).addClass("dirty-cell");b(v.rows[d]).addClass("edited");if(b.isFunction(v.p.afterSaveCell)){v.p.afterSaveCell.call(v,v.rows[d].id,M,E,d,a);}v.p.savedRow.splice(0,1);}else{b.jgrid.info_dialog(b.jgrid.errors.errcap,f[1],b.jgrid.edit.bClose);
b(v).jqGrid("restoreCell",d,a);}}else{b(C).empty();b(v).jqGrid("setCell",v.rows[d].id,a,N,false,false,true);b(C).addClass("dirty-cell");b(v.rows[d]).addClass("edited");if(b.isFunction(v.p.afterSaveCell)){v.p.afterSaveCell.call(v,v.rows[d].id,M,E,d,a);}v.p.savedRow.splice(0,1);}}},error:function(g,f){b("#lui_"+v.p.id).hide();
v.grid.hDiv.loading=false;if(b.isFunction(v.p.errorCell)){v.p.errorCell.call(v,g,f);b(v).jqGrid("restoreCell",d,a);}else{b.jgrid.info_dialog(b.jgrid.errors.errcap,g.status+" : "+g.statusText+"<br/>"+f,b.jgrid.edit.bClose);b(v).jqGrid("restoreCell",d,a);}}},b.jgrid.ajaxOptions,v.p.ajaxCellOptions||{}));
}else{try{b.jgrid.info_dialog(b.jgrid.errors.errcap,b.jgrid.errors.nourl,b.jgrid.edit.bClose);b(v).jqGrid("restoreCell",d,a);}catch(e){}}}if(v.p.cellsubmit=="clientArray"){b(C).empty();b(v).jqGrid("setCell",v.rows[d].id,a,N,false,false,true);b(C).addClass("dirty-cell");b(v.rows[d]).addClass("edited");
if(b.isFunction(v.p.afterSaveCell)){v.p.afterSaveCell.call(v,v.rows[d].id,M,E,d,a);}v.p.savedRow.splice(0,1);}}else{try{window.setTimeout(function(){b.jgrid.info_dialog(b.jgrid.errors.errcap,E+" "+L[1],b.jgrid.edit.bClose);},100);b(v).jqGrid("restoreCell",d,a);}catch(e){}}}else{b(v).jqGrid("restoreCell",d,a);
}}if(b.browser.opera){b("#"+v.p.knv).attr("tabindex","-1").focus();}else{window.setTimeout(function(){b("#"+v.p.knv).attr("tabindex","-1").focus();},0);}});},restoreCell:function(d,a){return this.each(function(){var c=this,j;if(!c.grid||c.p.cellEdit!==true){return;}if(c.p.savedRow.length>=1){j=0;}else{j=null;
}if(j!==null){var e=b("td:eq("+a+")",c.rows[d]);if(b.isFunction(b.fn.datepicker)){try{b("input.hasDatepicker",e).datepicker("hide");}catch(i){}}b(e).empty().attr("tabindex","-1");b(c).jqGrid("setCell",c.rows[d].id,a,c.p.savedRow[j].v,false,false,true);if(b.isFunction(c.p.afterRestoreCell)){c.p.afterRestoreCell.call(c,c.rows[d].id,c.p.savedRow[j].v,d,a);
}c.p.savedRow.splice(0,1);}window.setTimeout(function(){b("#"+c.p.knv).attr("tabindex","-1").focus();},0);});},nextCell:function(d,a){return this.each(function(){var c=this,g=false;if(!c.grid||c.p.cellEdit!==true){return;}for(var h=a+1;h<c.p.colModel.length;h++){if(c.p.colModel[h].editable===true){g=h;
break;}}if(g!==false){b(c).jqGrid("editCell",d,g,true);}else{if(c.p.savedRow.length>0){b(c).jqGrid("saveCell",d,a);}}});},prevCell:function(d,a){return this.each(function(){var c=this,g=false;if(!c.grid||c.p.cellEdit!==true){return;}for(var h=a-1;h>=0;h--){if(c.p.colModel[h].editable===true){g=h;break;
}}if(g!==false){b(c).jqGrid("editCell",d,g,true);}else{if(c.p.savedRow.length>0){b(c).jqGrid("saveCell",d,a);}}});},GridNav:function(){return this.each(function(){var h=this;if(!h.grid||h.p.cellEdit!==true){return;}h.p.knv=h.p.id+"_kn";var i=b("<span style='width:0px;height:0px;background-color:black;' tabindex='0'><span tabindex='-1' style='width:0px;height:0px;background-color:grey' id='"+h.p.knv+"'></span></span>"),k,l;
b(i).insertBefore(h.grid.cDiv);b("#"+h.p.knv).focus().keydown(function(c){l=c.keyCode;if(h.p.direction=="rtl"){if(l==37){l=39;}else{if(l==39){l=37;}}}switch(l){case 38:if(h.p.iRow-1>0){j(h.p.iRow-1,h.p.iCol,"vu");b(h).jqGrid("editCell",h.p.iRow-1,h.p.iCol,false);}break;case 40:if(h.p.iRow+1<=h.rows.length-1){j(h.p.iRow+1,h.p.iCol,"vd");
b(h).jqGrid("editCell",h.p.iRow+1,h.p.iCol,false);}break;case 37:if(h.p.iCol-1>=0){k=a(h.p.iCol-1,"lft");j(h.p.iRow,k,"h");b(h).jqGrid("editCell",h.p.iRow,k,false);}break;case 39:if(h.p.iCol+1<=h.p.colModel.length-1){k=a(h.p.iCol+1,"rgt");j(h.p.iRow,k,"h");b(h).jqGrid("editCell",h.p.iRow,k,false);}break;
case 13:if(parseInt(h.p.iCol,10)>=0&&parseInt(h.p.iRow,10)>=0){b(h).jqGrid("editCell",h.p.iRow,h.p.iCol,true);}break;}return false;});function j(e,g,f){if(f.substr(0,1)=="v"){var x=b(h.grid.bDiv)[0].clientHeight,d=b(h.grid.bDiv)[0].scrollTop,c=h.rows[e].offsetTop+h.rows[e].clientHeight,t=h.rows[e].offsetTop;
if(f=="vd"){if(c>=x){b(h.grid.bDiv)[0].scrollTop=b(h.grid.bDiv)[0].scrollTop+h.rows[e].clientHeight;}}if(f=="vu"){if(t<d){b(h.grid.bDiv)[0].scrollTop=b(h.grid.bDiv)[0].scrollTop-h.rows[e].clientHeight;}}}if(f=="h"){var u=b(h.grid.bDiv)[0].clientWidth,v=b(h.grid.bDiv)[0].scrollLeft,w=h.rows[e].cells[g].offsetLeft+h.rows[e].cells[g].clientWidth,s=h.rows[e].cells[g].offsetLeft;
if(w>=u+parseInt(v,10)){b(h.grid.bDiv)[0].scrollLeft=b(h.grid.bDiv)[0].scrollLeft+h.rows[e].cells[g].clientWidth;}else{if(s<v){b(h.grid.bDiv)[0].scrollLeft=b(h.grid.bDiv)[0].scrollLeft-h.rows[e].cells[g].clientWidth;}}}}function a(c,f){var d,e;if(f=="lft"){d=c+1;for(e=c;e>=0;e--){if(h.p.colModel[e].hidden!==true){d=e;
break;}}}if(f=="rgt"){d=c-1;for(e=c;e<h.p.colModel.length;e++){if(h.p.colModel[e].hidden!==true){d=e;break;}}}return d;}});},getChangedCells:function(d){var a=[];if(!d){d="all";}this.each(function(){var c=this,f;if(!c.grid||c.p.cellEdit!==true){return;}b(c.rows).each(function(h){var e={};if(b(this).hasClass("edited")){b("td",this).each(function(i){f=c.p.colModel[i].name;
if(f!=="cb"&&f!=="subgrid"){if(d=="dirty"){if(b(this).hasClass("dirty-cell")){try{e[f]=b.unformat(this,{rowId:c.rows[h].id,colModel:c.p.colModel[i]},i);}catch(g){e[f]=b.jgrid.htmlDecode(b(this).html());}}}else{try{e[f]=b.unformat(this,{rowId:c.rows[h].id,colModel:c.p.colModel[i]},i);}catch(g){e[f]=b.jgrid.htmlDecode(b(this).html());
}}}});e.id=this.id;a.push(e);}});});return a;}});})(jQuery);