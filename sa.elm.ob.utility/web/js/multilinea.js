var gId="name";var gBoton="Editable";var gFila="Fila";var frmFormulario;var gTargetFrame;var gHiddenFrame="frameOculto";var gColorSeleccionado="#C0C0C0";var gColorNormal="#FFFFFF";var gValorCampo=null;var gFilaActual=null;var gUltimoCampo=null;var fila=null;var parametros=new Array();var gBolEnviandoFila=false;
var gBolBloqueado=false;var gBolEvtActivarLinea=false;var gBolEvtEnviarLinea=false;var gBolEvtCambiarLinea=false;var gBolEvtAntesDeFiltrarRespuesta=false;var gBolEvtAntesDeBorrar=false;var gBolEvtAntesDeActualizar=false;var gBolEvtAntesDeNuevo=false;var gBolEvtErrorEnRespuesta=false;var gBolEvtDespuesDeNuevo=false;
var gBolEvtCambiarCampo=false;var gIsAutoInsertRows=false;var gIsDeleteableRows=true;var gActivateTabJump=false;var gBuscarPorBusqueda=null;var gValorBusqueda=null;var gNodoBusqueda=null;function esCampo(a){if(a==null){return false;}if(a.name==null){return false;}return true;}function seleccionarCampo(a){if(!esCampo(a)){return false;
}a.focus();if(a.type&&(a.type=="text"||a.type=="password")){a.select();}}function esCampoInput(b){var a=false;if(b.type){switch(b.type){case"select-multiple":case"select-one":case"text":case"password":case"checkbox":case"radio":a=true;break;default:a=false;}}return a;}function valorCampo(b){var a=null;
switch(b.type){case"select-multiple":case"select-one":if(b.selectedIndex!=-1){a=b.options[b.selectedIndex].value;}break;case"text":case"password":a=b.value;break;case"checkbox":case"radio":a=(b.checked)?"-1":"0";break;default:return null;}if(a==null){a="";}return a;}function comprobarCambios(b){if(!esCampo(b)){return false;
}var c=buscarPadre(b,gId,gFila);var a=true;gUltimoCampo=b.name;gValorCampo=valorCampo(b);if(gBolBloqueado){c=buscarHijo(gFilaActual,"name",b.name);seleccionarCampo(c);return false;}gBolBloqueado=true;if(c!=null){if(gFilaActual!=null&&c!=gFilaActual){a=deseleccionarFila();if(!a){c=buscarHijo(gFilaActual,"name",b.name);
seleccionarCampo(c);}}if(a&&(gFilaActual==null||c!=gFilaActual)){if(gBolEvtActivarLinea){if(!alActivarLinea(b,c)){gBolBloqueado=false;return false;}}gFilaActual=c;if(document.layers){c.bgColor=gColorSeleccionado;}else{c.style.backgroundColor=gColorSeleccionado;}c=buscarHijo(c,gId,gBoton);if(c!=null){c.style.visibility="visible";
}}}else{a=deseleccionarFila();if(!a){c=buscarHijo(gFilaActual,"name",b.name);seleccionarCampo(c);}}if(a&&(b.type=="text"||b.type=="password")){b.select();}gBolBloqueado=false;return true;}function seleccionarFila(c,a){if(a==null){a=false;}if(!esCampo(c)){return false;}var d=buscarPadre(c,gId,gFila);var b=true;
gUltimoCampo=c.name;gValorCampo=valorCampo(c);if(gBolBloqueado){d=buscarHijo(gFilaActual,"name",c.name);seleccionarCampo(d);return false;}gBolBloqueado=true;if(d!=null){if(gFilaActual!=null&&d!=gFilaActual){b=deseleccionarFila();if(!b){d=buscarHijo(gFilaActual,"name",c.name);seleccionarCampo(d);}}if(b&&(gFilaActual==null||d!=gFilaActual)){if(gBolEvtActivarLinea){if(!alActivarLinea(c,d)){gBolBloqueado=false;
return false;}}gFilaActual=d;if(document.layers){d.bgColor=gColorSeleccionado;}else{d.style.backgroundColor=gColorSeleccionado;}d=buscarHijo(d,gId,gBoton);if(d!=null){d.style.visibility="visible";}}}else{b=deseleccionarFila();if(!b){d=buscarHijo(gFilaActual,"name",c.name);seleccionarCampo(d);}}if(b&&(c.type=="text"||c.type=="password")){c.select();
}gBolBloqueado=false;return true;}function deseleccionarFila(a){if(gFilaActual==null){return false;}if(a==null){a=false;}if(gBolEnviandoFila){return false;}if(!a){enviarFila();}if(document.layers){gFilaActual.bgColor=gColorNormal;}else{gFilaActual.style.backgroundColor=gColorNormal;}var b=buscarHijo(gFilaActual,gId,gBoton);
if(b!=null){b.style.visibility="hidden";}gFilaActual=null;return true;}function borrarOptions(a){child=a.firstChild;while(child!=null){a.removeChild(child);child=a.firstChild;}}function marcarFila(a){if(!esCampo(a)){return false;}var b=buscarPadre(a,gId,gFila);if(b!=null){if(gBolEvtCambiarCampo){if(!alCambiarCampo(a,b)){return false;
}}if(gBolEvtCambiarLinea){if(!alCambiarLinea(a,b)){return false;}}if(gBolEnviandoFila||gBolBloqueado){if(gValorCampo!=null){ponerTexto(a,gValorCampo);}return false;}else{fila=b;}}return true;}function buscarPadre(c,d,b){if(c!=null&&c.getAttribute){var a=c.getAttribute(d);if(a!=null&&a==b){return c;}else{return buscarPadre(c.parentNode,d,b);
}}else{return null;}}function buscarSiguiente(c,d,b){c=c.nextSibling;while(c!=null){if(c.getAttribute){var a=c.getAttribute(d);if(a!=null&&a==b){return c;}}c=c.nextSibling;}return null;}function buscarAnterior(c,d,b){c=c.previousSibling;while(c!=null){if(c.getAttribute){var a=c.getAttribute(d);if(a!=null&&a==b){return c;
}}c=c.previousSibling;}return null;}function buscarHijo(d,f,b){var c=null;if(d!=null&&d.getAttribute){var a=d.getAttribute(f);if(a!=null&&a==b){return d;}var e=d.firstChild;while(e!=null){c=buscarHijo(e,f,b);if(c!=null){return c;}e=e.nextSibling;}}return null;}function esModelo(b){if(b==null){return false;
}var a=buscarHijo(b,"name","Modelo");return(a!=null);}function rellenarValorCombo(d,c){if(d==null||c==null){return false;}var b=d.options.length;for(var a=0;a<b;a++){d.options[a].selected=(d.options[a].value==c);}return true;}function eliminarFila(g,b,f,d){if(f==null){return false;}deseleccionarFila(true);
var c=0;if(f==null){f=fila;}if(f==null){return false;}if((d!=null&&d==1)||esModelo(f)){limpiarNodo(f);var a=null;if(b!=null){var e=b.length;for(c=0;c<e;c++){a=buscarHijo(f,"name",b[c]);if(a!=null){borrarOptions(a);}}}borrarValores(f);if(g!=null){var e=g.length;for(c=0;c<e;c++){a=buscarHijo(f,"name",g[c][0]);
if(a!=null){if(a.type){if(a.type.indexOf("select")!=-1){rellenarValorCombo(a,g[c][1]);}else{if(a.type=="checkbox"||a.type=="radio"){a.checked=(a.value==g[c][1]);}else{ponerTexto(a,g[c][1]);}}}else{if(g[c].length==2){ponerTexto(a,g[c][1]);}else{a.setAttribute(g[c][1],g[c][2]);}}}}}}else{f.parentNode.removeChild(f);
}return true;}function borrarFila(a){var b=buscarPadre(a,gId,gFila);if(b==null){return false;}fila=b;enviarFila("DELETE");}function buscarPrimerElementoFila(a){if(a==null){a=gFilaActual;}if(a!=null){return buscarPrimerElemento(a);}return null;}function buscarPrimerElemento(a){if(esCampoInput(a)){return a;
}else{var b=a.firstChild;a=null;while(b!=null&&a==null){a=buscarPrimerElemento(b);b=b.nextSibling;}}return a;}function buscarUltimoElementoFila(a){if(a==null){a=gFilaActual;}if(a!=null){return buscarUltimoElemento(a);}return null;}function buscarUltimoElemento(b){var a=null;if(esCampoInput(b)){a=b;}var c=b.firstChild;
while(c!=null){b=buscarPrimerElemento(c);if(b!=null){a=b;}c=c.nextSibling;}return a;}function borrarValores(a){if(a.type){if(a.type=="checkbox"||a.type=="radio"){a.checked=false;}else{if(a.type.indexOf("select")!=-1){rellenarValorCombo(a,"");}else{a.value="";}}}var b=a.firstChild;while(b!=null){borrarValores(b);
b=b.nextSibling;}return true;}function cargarArray(a,c){if(a.type){if(a.type.indexOf("checkbox")!=-1||a.type.indexOf("radio")!=-1){parametros[c++]=new Array(a.name,(a.checked)?a.value:"");}else{if(a.value){parametros[c++]=new Array(a.name,a.value);}}}var b=a.firstChild;while(b!=null){c=cargarArray(b,c);
b=b.nextSibling;}return c;}function enviarFila(strAccion){if(fila==null){return false;}if(gBolEnviandoFila){return false;}gBolEnviandoFila=true;if(strAccion==null){strAccion="SAVE_EDIT";}parametros=new Array();cargarArray(fila,0);if(gBolEvtEnviarLinea){if(!alEnviarLinea(fila,parametros,strAccion)){fila=null;
gBolEnviandoFila=false;return false;}}fila=null;var frame=eval(gHiddenFrame);frame.submitArray(parametros,frmFormulario,strAccion,gTargetFrame);return true;}function obtenerTexto(a){if(a==null){return"";}if(a.data){return a.data;}else{return obtenerTexto(a.firstChild);}}function ponerTexto(d,a){var b=0;
if(d==null){return false;}if(d.type){switch(d.type){case"select-multiple":case"select-one":var c=d.options.length;for(b=0;b<c;b++){if(d.options[b].value==a){d.options[b].selected=true;}else{d.options[b].selected=false;}}break;case"text":case"hidden":case"password":d.value=a;break;case"checkbox":case"radio":if(d.length==1){d.checked=(d.value==a);
}else{var c=d.length;for(b=0;b<c;b++){if(d[b].value==a){d.checked=true;}else{d.checked=false;}}}break;}}else{if(d.data){d.data=a;}else{ponerTexto(d.firstChild,a);}}return true;}function buscarTexto(b,a,d){if(b==null){return null;}var c=buscarHijo(b,gId,a);if(c!=null){if(obtenerTexto(c).toUpperCase().indexOf(d.toUpperCase())!=-1){return b;
}}return buscarTexto(buscarSiguiente(b,gId,gFila),a,d);}function buscarFila(b,c,a){var d=buscarHijo(b,"name",c);if(d==null){return null;}if(d.getAttribute("value")==a){return buscarPadre(d,gId,gFila);}d=buscarPadre(d,gId,gFila);return buscarFila(buscarSiguiente(d,gId,gFila),c,a);}function realizarBusqueda(c,b,a,g,e){gBuscarPorBusqueda=b;
gValorBusqueda=g;var d=null;if(e==null||e){d=buscarTexto(c,b,g);}else{d=buscarTexto(buscarSiguiente(c,gId,gFila),b,g);}gNodoBusqueda=d;if(d==null){return false;}d=buscarHijo(d,"name",a);if(d==null){return true;}d.focus();return true;}function inicializarCampo(c){var a=0;if(c==null){return false;}if(c.data){c.data="";
}else{if(c.type){switch(c.type){case"select-multiple":case"select-one":var b=c.options.length;for(a=0;a<b;a++){c.options[a].selected=false;}break;case"text":if(c.value){if(!isNaN(Number(c.value))){c.value="0";}else{c.value="";}}break;case"password":c.value="";break;case"checkbox":case"radio":if(c.length==1){c.checked=false;
}else{var b=c.length;for(a=0;a<b;a++){c.checked=false;}}break;}}}}function limpiarNodo(a){if(a.type){inicializarCampo(a);}var b=a.firstChild;while(b!=null){limpiarNodo(b);b=b.nextSibling;}return true;}function agregarFila(d,e,b){deseleccionarFila();if(gBolEnviandoFila){return null;}var c=d.cloneNode(true);
var a=d.parentNode;if(a==null){return null;}a.appendChild(c);if(!eliminarFila(e,b,c,1)){return null;}return c;}function restaurarValores(b,c){if(c.type!=null){if(c.name){var a=obtenerValor(b,c.name,true);if(a!=null){ponerTexto(c,a);}}}var d=c.firstChild;while(d!=null){restaurarValores(b,d);d=d.nextSibling;
}return true;}function obtenerValor(c,e,d){if(d==null){d=false;}if(c==null||e==null){return(d?null:"");}var b=c.length;for(var a=0;a<b;a++){if(c[a][0]==e){return c[a][1];}}return(d?null:"");}function borrarPruebas(){var a=buscarAnterior(gFilaActual,gId,gFila);if(a==null){a=buscarSiguiente(gFilaActual,gId,gFila);
}if(a!=null){a=buscarPrimerElementoFila(a);eliminarFila(null,null,gFilaActual);seleccionarFila(a);}else{a=buscarPrimerElementoFila(gFilaActual);eliminarFila(null,null,gFilaActual,1);seleccionarFila(a);}}function filtrarRespuesta(respuesta,respuestaNew){gBolEnviandoFila=false;if(respuesta==null){return false;
}var objFila=null;var strCommand=obtenerValor(respuesta,"Command");var strForm=obtenerValor(respuesta,"Formulario");var frmForm="";if(strForm==""){frmForm=document.forms[0];}else{frmForm=eval(strForm);}if(respuesta.length>1){frmForm=buscarHijo(frmForm,gId,gFila);objFila=buscarFila(frmForm,respuesta[1][0],respuesta[1][1]);
if(strCommand!="ERROR"&&objFila==null){return false;}}if(gBolEvtAntesDeFiltrarRespuesta){if(!antesDeFiltrarRespuesta(respuesta,objFila)){return false;}}if(strCommand=="REFRESH"){document.href.src=document.href.src;return false;}else{if(strCommand=="DELETE"){if(gBolEvtAntesDeBorrar){if(!antesDeBorrar(respuesta,objFila)){return false;
}}var ndFila1=buscarAnterior(objFila,gId,gFila);if(ndFila1==null){ndFila1=buscarSiguiente(objFila,gId,gFila);}if(ndFila1!=null){ndFila1=buscarPrimerElementoFila(ndFila1);eliminarFila(null,null,objFila);seleccionarFila(ndFila1);}else{ndFila1=ndFila1=buscarPrimerElementoFila(objFila);eliminarFila(respuestaNew,null,objFila,1);
seleccionarFila(ndFila1);}}else{if(strCommand=="SAVE_EDIT"||strCommand=="SAVE_NEW"){if(respuesta.length>1&&gBolEvtAntesDeActualizar){if(!antesDeActualizar(respuesta,objFila)){return false;}}if(strCommand=="SAVE_NEW"){if(gBolEvtAntesDeNuevo){if(!antesDeNuevo(respuestaNew)){return false;}}objFila=agregarFila(objFila,respuestaNew);
if(objFila!=null){var ndLast=buscarPrimerElementoFila(objFila);if(ndLast!=null){gUltimoCampo=ndLast.name;seleccionarFila(ndLast,true);}}if(gBolEvtDespuesDeNuevo){if(!despuesDeNuevo(respuestaNew)){return false;}}}}else{if(strCommand=="CAMBIO_PANEL"){if(gBolEvtAntesDeActualizar){if(!antesDeActualizar(respuesta,objFila)){return false;
}}}else{if(strCommand=="ERROR"){if(gBolEvtErrorEnRespuesta){if(!errorEnRespuesta(respuesta,objFila)){return false;}}if(objFila!=null){restaurarValores(respuesta,objFila);}var strMensaje=obtenerValor(respuesta,"MENSAJE_ERROR");if(strMensaje!=null){alert(strMensaje);}return false;}}}}}ejecutarRespuesta(respuesta,objFila);
}function restoreFilaSelected(a){var b=null;if(navigator.appName=="Netscape"){document.routeEvent(a);b=a.target;}else{a=event;b=a.srcElement;}if(gFilaActual==null){setFocusFirstControl();}else{if(gUltimoCampo!=null&&gUltimoCampo!=""){var c=buscarHijo(gFilaActual,"name",gUltimoCampo);}else{var c=buscarPrimerElementoFila(gFilaActual);
}if(c!=null&&c.type&&c.type!="hidden"){c.focus();}}return true;}function esTeclaInterna(a,c,d){var b=false;switch(c){case obtainKeyCode("TAB"):b=(!a.shiftKey&&!a.ctrlKey&&!a.altKey);break;case obtainKeyCode("ENTER"):b=(!a.shiftKey&&!a.ctrlKey&&!a.altKey);break;case obtainKeyCode("F7"):b=(gIsDeleteableRows&&!a.shiftKey&&!a.ctrlKey&&!a.altKey);
break;case obtainKeyCode("F8"):b=(gActivateTabJump&&!a.shiftKey&&!a.ctrlKey&&!a.altKey);break;case obtainKeyCode("UPARROW"):b=((d.type.indexOf("select")==-1)&&(!a.shiftKey&&!a.ctrlKey&&!a.altKey));break;case obtainKeyCode("DOWNARROW"):b=((d.type.indexOf("select")==-1)&&(!a.shiftKey&&!a.ctrlKey&&!a.altKey));
break;default:b=false;break;}return b;}function controlarTecla(b){var e=controlTecla(b);var h="";if(e){if(gFilaActual!=null){var d=null;var g=null;if(navigator.appName=="Netscape"){document.routeEvent(b);d=b.which;g=b.target;}else{d=event.keyCode;g=event.srcElement;b=event;}if(!(g.type)){if(arrTeclas!=null&&arrTeclas.length>0){return controlTecla(b);
}else{return true;}}h=g.name;if(!esTeclaInterna(b,d,g)){return true;}var c=buscarPadre(g,gId,gFila);if(c==null){return true;}if(d==obtainKeyCode("UPARROW")){c=buscarAnterior(c,gId,gFila);if(c==null){c=gFilaActual;var f=buscarSiguiente(gFilaActual,gId,gFila);if(f==null){fila=gFilaActual;enviarFila();}else{f=buscarHijo(f,"name",g.name);
if(f!=null){f.focus();}}gFilaActual=c;}}else{if((d==obtainKeyCode("DOWNARROW")||d==obtainKeyCode("ENTER"))&&!b.ctrlKey&&!b.altKey&&!b.shiftKey){c=buscarSiguiente(c,gId,gFila);if(c==null){if(gIsAutoInsertRows){fila=gFilaActual;c=gFilaActual;enviarFila("SAVE_NEW");}else{c=gFilaActual;var f=buscarAnterior(gFilaActual,gId,gFila);
if(f==null){fila=gFilaActual;f=gFilaActual;enviarFila();}else{f=buscarHijo(f,"name",g.name);if(f!=null){f.focus();}}gFilaActual=c;}}}else{if(d==obtainKeyCode("TAB")&&!b.shiftKey){var a=buscarUltimoElementoFila(c);if(a.name==g.name){if(buscarSiguiente(c,gId,gFila)==null){if(gIsAutoInsertRows){fila=gFilaActual;
c=gFilaActual;enviarFila("SAVE_NEW");}else{c=gFilaActual;var f=buscarAnterior(gFilaActual,gId,gFila);if(f==null){fila=gFilaActual;f=gFilaActual;enviarFila();}else{f=buscarHijo(f,"name",g.name);if(f!=null){f.focus();}}gFilaActual=c;return true;}}else{return true;}}else{return true;}}else{if(d==obtainKeyCode("F7")&&(!b.shiftKey&&!b.ctrlKey&&!b.altKey)){fila=gFilaActual;
enviarFila("DELETE");c=gFilaActual;}else{if(d==obtainKeyCode("F8")&&(!b.shiftKey&&!b.ctrlKey&&!b.altKey)){fila=gFilaActual;enviarFila("CAMBIO_PANEL");c=gFilaActual;h=gUltimoCampo;}else{return true;}}}}}c=buscarHijo(c,"name",h);if(c==null){return true;}c.focus();b.returnValue=false;b.cancelBubble=true;
return false;}}return true;}function controlExitLines(a){return true;fila=gFilaActual;enviarFila();}if(!(document.all)){document.captureEvents(Event.KEYDOWN);window.captureEvents(Event.FOCUS);window.captureEvents(Event.BLUR);}document.onkeydown=controlarTecla;window.onfocus=restoreFilaSelected;window.onblur=controlExitLines;
