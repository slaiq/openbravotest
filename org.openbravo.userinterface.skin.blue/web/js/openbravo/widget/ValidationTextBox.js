dojo.provide("openbravo.widget.ValidationTextBox");dojo.require("dijit.form.TextBox");dojo.declare("openbravo.widget.ValidationTextBox",[dijit.form.TextBox],{templateString:"",templatePath:dojo.moduleUrl("openbravo","templates/ValidationTextBox.html"),baseClass:"",receivedClass:"",value:"",invalidSpan:null,missingSpan:null,rangeSpan:null,invalidClass:"invalid",missingClass:"missing",rangeClass:"range",listenOnKeyPress:true,lastCheckedValue:null,htmlfloat:"none",classPrefix:"dojoValidate",required:false,promptMessage:"",invalidMessage:"$_unset_$",missingMessage:"$_unset_$",rangeMessage:"$_unset_$",constraints:{},regExp:".*",regExpGen:function(a){return this.regExp;
},validator:function(a,b){return(new RegExp("^("+this.regExpGen(b)+")"+(this.required?"":"?")+"$")).test(a)&&(!this.required||!this.isEmpty(a))&&(this.isEmpty(a)||this.parse(a,b)!==undefined);},isValid:function(){return this.validator(this.textbox.value,this.constraints);},isInRange:function(){return true;
},isEmpty:function(){return(/^\s*$/.test(this.textbox.value));},isMissing:function(){return(this.required&&this.isEmpty());},update:function(a){this.lastCheckedValue=this.textbox.value;this.missingSpan.style.display="none";this.invalidSpan.style.display="none";this.rangeSpan.style.display="none";var d=this.isEmpty();
var c=this.isValid();var b=this.isMissing();if(b){this.missingSpan.style.display="";this.updateClass("Empty");}else{if(!d&&!c){this.invalidSpan.style.display="";this.updateClass("Invalid");}else{if(!d&&!this.isInRange()){this.rangeSpan.style.display="";this.updateClass("Invalid");}else{this.updateClass("Valid");
}}}},_setStateClass:function(){},updateClass:function(a){var b=this.classPrefix;if(focusedWindowElement==this.textbox){dojo.removeClass(this.textbox,b+"Empty_focus");dojo.removeClass(this.textbox,b+"Valid_focus");dojo.removeClass(this.textbox,b+"Invalid_focus");dojo.addClass(this.textbox,b+a+"_focus");
}else{dojo.removeClass(this.textbox,b+"Empty");dojo.removeClass(this.textbox,b+"Valid");dojo.removeClass(this.textbox,b+"Invalid");dojo.addClass(this.textbox,b+a);}},highlight:function(){if(this.isEmpty()){this.updateClass("Empty");}else{if(this.isValid()&&this.isInRange()){this.updateClass("Valid");
}else{if(this.textbox.value!=this.promptMessage){this.updateClass("Invalid");}else{this.updateClass("Empty");}}}},_onKeyUp:function(a){if(this.listenOnKeyPress){this.update();}else{if(this.textbox.value!=this.lastCheckedValue){this.updateClass("Empty");}}},_onFocus:function(a){if(!this.listenOnKeyPress){this.updateClass("Empty");
}},_onBlur:function(a){this.inherited(arguments);this.filter();this.update();},getMessage:function(b,a){if(a==null){if(typeof defaultLang!="undefined"){a=defaultLang;}else{if(typeof LNG_POR_DEFECTO!="undefined"){a=LNG_POR_DEFECTO;}}}if(typeof arrMessages!="undefined"){var d=arrMessages.length;for(var c=0;
c<d;c++){if(arrMessages[c].language==a){if(arrMessages[c].message==b){if(b=="Invalid"&&this.invalidMessage=="$_unset_$"){return arrMessages[c].text;}if(b=="Missing"&&this.missingMessage=="$_unset_$"){return arrMessages[c].text;}if(b=="Range"&&this.rangeMessage=="$_unset_$"){return arrMessages[c].text;
}}}}}else{this.messages=dojo.i18n.getLocalization("dijit.form","validate",this.lang);if(b=="Invalid"&&this.invalidMessage=="$_unset_$"){return this.messages.invalidMessage;}if(b=="Missing"&&this.missingMessage=="$_unset_$"){return this.messages.missingMessage;}if(b=="Range"&&this.rangeMessage=="$_unset_$"){return this.messages.rangeMessage;
}}return null;},setMessages:function(){this.invalidMessage=this.getMessage("Invalid");this.missingMessage=this.getMessage("Missing");this.rangeMessage=this.getMessage("Range");},constructor:function(){this.constraints={};},postMixInProperties:function(){this.setMessages();this.inherited(arguments);var a=this.regExpGen(this.constraints);
this.regExp=a;},postCreate:function(){if(this.required){dojo.addClass(this.textbox,"required");}if(this.readonly){dojo.addClass(this.textbox,"readonly");}if(this.disabled){dojo.addClass(this.textbox,"disabled");}if(this.disabled){this.textbox.setAttribute("disabled","true");}if(this.readonly){this.textbox.setAttribute("readonly","true");
}this.invalidSpan.style.display="none";this.missingSpan.style.display="none";this.rangeSpan.style.display="none";this.highlight();this.inherited(arguments);}});dojo.declare("openbravo.widget.ValidationTextBox.Date",[openbravo.widget.ValidationTextBox],{displayFormat:"",saveFormat:"",listenOnKeyPress:false,greaterThan:"",lowerThan:"",isWrong:false,postMixInProperties:function(){this.inherited(arguments);
},postCreate:function(){this.inherited(arguments);this.textbox.setAttribute("displayFormat",this.displayFormat);this.displayFormat=this.displayFormat.replace("mm","MM").replace("dd","DD").replace("yyyy","YYYY");this.displayFormat=this.displayFormat.replace("MM","%m").replace("DD","%d").replace("YYYY","%Y");
this.saveFormat=this.displayFormat;},isValid:function(){if(this.getDate(this.textbox.value,this.displayFormat)){return true;}else{return false;}},isInRange:function(){if((this.greaterThan==""||this.greaterThan==null)&&(this.lowerThan==""||this.lowerThan==null)){return true;}if(this.greaterThan!=""){if(dojo.byId(this.greaterThan).value==null||dojo.byId(this.greaterThan).value==""){if(this.isWrong==true){this.isWrong=false;
dijit.byId(this.greaterThan).update();}return true;}else{if(this.textbox.value==""||this.textbox.value==null){if(this.isWrong==true){this.isWrong=false;dijit.byId(this.greaterThan).update();}return true;}else{if(this.getDate(this.textbox.value,this.displayFormat)<this.getDate(dojo.byId(this.greaterThan).value,this.displayFormat)){if(this.isWrong==false){this.isWrong=true;
dijit.byId(this.greaterThan).update();}return false;}else{if(this.isWrong==true){this.isWrong=false;dijit.byId(this.greaterThan).update();}return true;}}}}if(this.lowerThan!=""){if(dojo.byId(this.lowerThan).value==null||dojo.byId(this.lowerThan).value==""){if(this.isWrong==true){this.isWrong=false;dijit.byId(this.lowerThan).update();
}return true;}else{if(this.textbox.value==""||this.textbox.value==null){if(this.isWrong==true){this.isWrong=false;dijit.byId(this.lowerThan).update();}return true;}else{if(this.getDate(this.textbox.value,this.displayFormat)>this.getDate(dojo.byId(this.lowerThan).value,this.displayFormat)){if(this.isWrong==false){this.isWrong=true;
dijit.byId(this.lowerThan).update();}return false;}else{if(this.isWrong==true){this.isWrong=false;dijit.byId(this.lowerThan).update();}return true;}}}}},getDate:function(e,d){var b=new Date(0,0,0);if(e.length==0){return b;}var c=new RegExp("^(\\d+)[\\-|\\/|/|:|.|\\.](\\d+)[\\-|\\/|/|:|.|\\.](\\d+)$");
if(!c.test(e)){return false;}var a=c.exec(e);if(!d){d=defaultDateFormat;}switch(d){case"%m-%d-%Y":case"%m/%d/%Y":case"%m.%d.%Y":case"%m:%d:%Y":if(a[2]<1||a[2]>31){return false;}if(a[1]<1||a[1]>12){return false;}if(a[3]<1||a[3]>9999){return false;}b=new Date(parseFloat(a[3]),parseFloat(a[1])-1,parseFloat(a[2]));
return b;break;case"%Y-%m-%d":case"%Y/%m/%d":case"%Y.%m.%d":case"%Y:%m:%d":if(a[3]<1||a[3]>31){return false;}if(a[2]<1||a[2]>12){return false;}if(a[1]<1||a[1]>9999){return false;}b=new Date(parseFloat(a[1]),parseFloat(a[2])-1,parseFloat(a[3]));return b;break;case"%d-%m-%Y":case"%d/%m/%Y":case"%d.%m.%Y":case"%d:%m:%Y":if(a[1]<1||a[1]>31){return false;
}if(a[2]<1||a[2]>12){return false;}if(a[3]<1||a[3]>9999){return false;}b=new Date(parseFloat(a[3]),parseFloat(a[2])-1,parseFloat(a[1]));return b;break;}return false;},_onKeyUp:function(a){this.inherited(arguments);this.autoCompleteDate(this.textbox,this.displayFormat);},autoCompleteDate:function(m,d){if(!isTabPressed){try{if(this.getCaretPosition(m).start!=m.value.length){return;
}}catch(e){}if(d==null||d==""){alert("openbravo.widget.DateTextBox ERROR: No displayFormat specified");return;}var n=m.value;var l=d.match(/%./g);var g=0,f=-1;var o="";var a=0;var k=d.indexOf(l[0])+l[0].length;var h=d.substring(k,k+1);var c="";k=d.indexOf("%H");if(k!=-1){c=d.substring(k+2,k+3);}while(n.charAt(g)){if(n.charAt(g)==h||n.charAt(g)==c){g++;
continue;}if(a<=0){f++;if(f>0){if(l[f]=="%H"){o+=" ";}else{if(l[f]=="%M"||l[f]=="%S"){o+=c;}else{o+=h;}}}switch(l[f]){case"%d":case"%e":o+=n.charAt(g);a=2;break;case"%m":o+=n.charAt(g);a=2;break;case"%Y":o+=n.charAt(g);a=4;break;case"%y":o+=n.charAt(g);a=2;break;case"%H":case"%I":case"%k":case"%l":o+=n.charAt(g);
a=2;break;case"%M":o+=n.charAt(g);a=2;break;case"%S":o+=n.charAt(g);a=2;break;}}else{o+=n.charAt(g);}a--;g++;}m.value=o;if(g>7&&(typeof(m.onchange)!="undefined")){m.onchange();}}},caretPosition:function(){var b=null;var a=null;},getCaretPosition:function(b){var c=new this.caretPosition();if(document.selection){b.focus();
var a=document.selection.createRange();var d=a.text.length;a.moveStart("character",-b.value.length);c.start=a.text.length-d;c.end=a.text.length;}else{if(b.selectionStart||b.selectionStart=="0"){c.start=b.selectionStart;c.end=b.selectionEnd;}}return(c);}});dojo.require("dojo.number");dojo.declare("openbravo.widget.ValidationTextBox.Number",[openbravo.widget.ValidationTextBox],{listenOnKeyPress:true,greaterThan:"",lowerThan:"",group:"",decimal:"",pattern:"#,##0.###",isWrong:false,regExpGen:function(){return this.generateRegExp().regexp;
},generateRegExp:function(c){c=c||{};var g=this.pattern;var h=this.group;var b=this.decimal;var d=1;var f=/[#0,]*[#0](?:\.0*#*)?/;var a=g.split(";");if(a.length==1){a.push("-"+a[0]);}var e=dojo.regexp.buildGroupRE(a,function(i){i="(?:"+dojo.regexp.escapeString(i,".")+")";return i.replace(f,function(n){var k={signed:false,separator:c.strict?h:[h,""],fractional:c.fractional,decimal:b,exponent:false};
var m=n.split(".");var l=c.places;if(m.length==1||l===0){k.fractional=false;}else{if(l===undefined){l=c.pattern?m[1].lastIndexOf("0")+1:Infinity;}if(l&&c.fractional==undefined){k.fractional=true;}if(!c.places&&(l<m[1].length)){l+=","+m[1].length;}k.places=l;}var j=m[0].split(",");if(j.length>1){k.groupSize=j.pop().length;
if(j.length>1){k.groupSize2=j.pop().length;}}return"("+dojo.number._realNumberRegexp(k)+")";});},true);return{regexp:e.replace(/[\xa0 ]/g,"[\\s\\xa0]"),group:h,decimal:b,factor:d};},isInRange:function(){if((this.greaterThan==""||this.greaterThan==null)&&(this.lowerThan==""||this.lowerThan==null)){return true;
}if(this.greaterThan!=""){if(dojo.byId(this.greaterThan).value==null||dojo.byId(this.greaterThan).value==""){if(this.isWrong==true){this.isWrong=false;dijit.byId(this.greaterThan).update();}return true;}else{if(this.textbox.value==""||this.textbox.value==null){if(this.isWrong==true){this.isWrong=false;
dijit.byId(this.greaterThan).update();}return true;}else{if(parseFloat(this.textbox.value)<parseFloat(dojo.byId(this.greaterThan).value)){if(this.isWrong==false){this.isWrong=true;dijit.byId(this.greaterThan).update();}return false;}else{if(this.isWrong==true){this.isWrong=false;dijit.byId(this.greaterThan).update();
}return true;}}}}if(this.lowerThan!=""){if(dojo.byId(this.lowerThan).value==null||dojo.byId(this.lowerThan).value==""){if(this.isWrong==true){this.isWrong=false;dijit.byId(this.lowerThan).update();}return true;}else{if(parseFloat(this.textbox.value)>parseFloat(dojo.byId(this.lowerThan).value)){if(this.isWrong==false){this.isWrong=true;
dijit.byId(this.lowerThan).update();}return false;}else{if(this.isWrong==true){this.isWrong=false;dijit.byId(this.lowerThan).update();}return true;}}}}});dojo.declare("openbravo.widget.ValidationTextBox.RealNumber",[openbravo.widget.ValidationTextBox.Number],{group:",",decimal:"."});dojo.declare("openbravo.widget.ValidationTextBox.IntegerNumber",[openbravo.widget.ValidationTextBox.Number],{group:",",decimal:""});
