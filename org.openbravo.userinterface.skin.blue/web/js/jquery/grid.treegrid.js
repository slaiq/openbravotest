(function(b){b.jgrid.extend({setTreeNode:function(a,d){return this.each(function(){var v=this;if(!v.grid||!v.p.treeGrid){return;}var r=v.p.expColInd,t=v.p.treeReader.expanded_field,x=v.p.treeReader.leaf_field,y=v.p.treeReader.level_field,u=v.p.treeReader.loaded;d.level=a[y];if(v.p.treeGridModel=="nested"){var c=a[v.p.treeReader.left_field],p=a[v.p.treeReader.right_field];
if(!a[x]){a[x]=(parseInt(p,10)===parseInt(c,10)+1)?"true":"false";}}else{}var s=parseInt(a[y],10),w,q;if(v.p.tree_root_level===0){w=s+1;q=s;}else{w=s;q=s-1;}var z="<div class='tree-wrap tree-wrap-"+v.p.direction+"' style='width:"+(w*18)+"px;'>";z+="<div style='"+(v.p.direction=="rtl"?"right:":"left:")+(q*18)+"px;' class='ui-icon ";
if(a[u]!=undefined){if(a[u]=="true"||a[u]===true){a[u]=true;}else{a[u]=false;}}if(a[x]=="true"||a[x]===true){z+=v.p.treeIcons.leaf+" tree-leaf'";a[x]=true;a[t]=false;}else{if(a[t]=="true"||a[t]===true){z+=v.p.treeIcons.minus+" tree-minus treeclick'";a[t]=true;}else{z+=v.p.treeIcons.plus+" tree-plus treeclick'";
a[t]=false;}a[x]=false;}z+="</div></div>";if(!v.p.loadonce){a[v.p.localReader.id]=d.id;v.p.data.push(a);v.p._index[d.id]=v.p.data.length-1;}if(parseInt(a[y],10)!==parseInt(v.p.tree_root_level,10)){if(!b(v).jqGrid("isVisibleNode",a)){b(d).css("display","none");}}b("td:eq("+r+")",d).wrapInner("<span></span>").prepend(z);
b(".treeclick",d).bind("click",function(g){var h=g.target||g.srcElement,e=b(h,v.rows).closest("tr.jqgrow")[0].id,f=v.p._index[e],i=v.p.treeReader.leaf_field,j=v.p.treeReader.expanded_field;if(!v.p.data[f][i]){if(v.p.data[f][j]){b(v).jqGrid("collapseRow",v.p.data[f]);b(v).jqGrid("collapseNode",v.p.data[f]);
}else{b(v).jqGrid("expandRow",v.p.data[f]);b(v).jqGrid("expandNode",v.p.data[f]);}}return false;});if(v.p.ExpandColClick===true){b("span",d).css("cursor","pointer").bind("click",function(g){var h=g.target||g.srcElement,e=b(h,v.rows).closest("tr.jqgrow")[0].id,f=v.p._index[e],i=v.p.treeReader.leaf_field,j=v.p.treeReader.expanded_field;
if(!v.p.data[f][i]){if(v.p.data[f][j]){b(v).jqGrid("collapseRow",v.p.data[f]);b(v).jqGrid("collapseNode",v.p.data[f]);}else{b(v).jqGrid("expandRow",v.p.data[f]);b(v).jqGrid("expandNode",v.p.data[f]);}}b(v).jqGrid("setSelection",e);return false;});}});},setTreeGrid:function(){return this.each(function(){var f=this,g=0,a;
if(!f.p.treeGrid){return;}if(!f.p.treedatatype){b.extend(f.p,{treedatatype:f.p.datatype});}f.p.subGrid=false;f.p.altRows=false;f.p.pgbuttons=false;f.p.pginput=false;f.p.multiselect=false;f.p.rowList=[];a="ui-icon-triangle-1-"+(f.p.direction=="rtl"?"w":"e");f.p.treeIcons=b.extend({plus:a,minus:"ui-icon-triangle-1-s",leaf:"ui-icon-radio-off"},f.p.treeIcons||{});
if(f.p.treeGridModel=="nested"){f.p.treeReader=b.extend({level_field:"level",left_field:"lft",right_field:"rgt",leaf_field:"isLeaf",expanded_field:"expanded",loaded:"loaded"},f.p.treeReader);}else{if(f.p.treeGridModel=="adjacency"){f.p.treeReader=b.extend({level_field:"level",parent_id_field:"parent",leaf_field:"isLeaf",expanded_field:"expanded",loaded:"loaded"},f.p.treeReader);
}}for(var h in f.p.colModel){if(f.p.colModel.hasOwnProperty(h)){if(f.p.colModel[h].name==f.p.ExpandColumn){f.p.expColInd=g;break;}g++;}}if(!f.p.expColInd){f.p.expColInd=0;}b.each(f.p.treeReader,function(d,c){if(c){f.p.colNames.push(c);f.p.colModel.push({name:c,width:1,hidden:true,sortable:false,resizable:false,hidedlg:true,editable:true,search:false});
}});});},expandRow:function(a){this.each(function(){var f=this;if(!f.grid||!f.p.treeGrid){return;}var g=b(f).jqGrid("getNodeChildren",a),h=f.p.treeReader.expanded_field;b(g).each(function(d){var c=b.jgrid.getAccessor(this,f.p.localReader.id);b("#"+c,f.grid.bDiv).css("display","");if(this[h]){b(f).jqGrid("expandRow",this);
}});});},collapseRow:function(a){this.each(function(){var f=this;if(!f.grid||!f.p.treeGrid){return;}var g=b(f).jqGrid("getNodeChildren",a),h=f.p.treeReader.expanded_field;b(g).each(function(d){var c=b.jgrid.getAccessor(this,f.p.localReader.id);b("#"+c,f.grid.bDiv).css("display","none");if(this[h]){b(f).jqGrid("collapseRow",this);
}});});},getRootNodes:function(){var a=[];this.each(function(){var f=this;if(!f.grid||!f.p.treeGrid){return;}switch(f.p.treeGridModel){case"nested":var g=f.p.treeReader.level_field;b(f.p.data).each(function(c){if(parseInt(this[g],10)===parseInt(f.p.tree_root_level,10)){a.push(this);}});break;case"adjacency":var h=f.p.treeReader.parent_id_field;
b(f.p.data).each(function(c){if(this[h]===null||String(this[h]).toLowerCase()=="null"){a.push(this);}});break;}});return a;},getNodeDepth:function(d){var a=null;this.each(function(){if(!this.grid||!this.p.treeGrid){return;}var c=this;switch(c.p.treeGridModel){case"nested":var f=c.p.treeReader.level_field;
a=parseInt(d[f],10)-parseInt(c.p.tree_root_level,10);break;case"adjacency":a=b(c).jqGrid("getNodeAncestors",d).length;break;}});return a;},getNodeParent:function(d){var a=null;this.each(function(){var q=this;if(!q.grid||!q.p.treeGrid){return;}switch(q.p.treeGridModel){case"nested":var r=q.p.treeReader.left_field,c=q.p.treeReader.right_field,p=q.p.treeReader.level_field,m=parseInt(d[r],10),n=parseInt(d[c],10),t=parseInt(d[p],10);
b(this.p.data).each(function(){if(parseInt(this[p],10)===t-1&&parseInt(this[r],10)<m&&parseInt(this[c],10)>n){a=this;return false;}});break;case"adjacency":var o=q.p.treeReader.parent_id_field,s=q.p.localReader.id;b(this.p.data).each(function(e,f){if(this[s]==d[o]){a=this;return false;}});break;}});return a;
},getNodeChildren:function(d){var a=[];this.each(function(){var q=this;if(!q.grid||!q.p.treeGrid){return;}switch(q.p.treeGridModel){case"nested":var r=q.p.treeReader.left_field,c=q.p.treeReader.right_field,p=q.p.treeReader.level_field,m=parseInt(d[r],10),n=parseInt(d[c],10),t=parseInt(d[p],10);b(this.p.data).each(function(e){if(parseInt(this[p],10)===t+1&&parseInt(this[r],10)>m&&parseInt(this[c],10)<n){a.push(this);
}});break;case"adjacency":var o=q.p.treeReader.parent_id_field,s=q.p.localReader.id;b(this.p.data).each(function(e,f){if(this[o]==d[s]){a.push(this);}});break;}});return a;},getFullTreeNode:function(d){var a=[];this.each(function(){var s=this,r;if(!s.grid||!s.p.treeGrid){return;}switch(s.p.treeGridModel){case"nested":var t=s.p.treeReader.left_field,c=s.p.treeReader.right_field,q=s.p.treeReader.level_field,n=parseInt(d[t],10),o=parseInt(d[c],10),v=parseInt(d[q],10);
b(this.p.data).each(function(e){if(parseInt(this[q],10)>=v&&parseInt(this[t],10)>=n&&parseInt(this[t],10)<=o){a.push(this);}});break;case"adjacency":a.push(d);var p=s.p.treeReader.parent_id_field,u=s.p.localReader.id;b(this.p.data).each(function(e){r=a.length;for(e=0;e<r;e++){if(a[e][u]==this[p]){a.push(this);
break;}}});break;}});return a;},getNodeAncestors:function(d){var a=[];this.each(function(){if(!this.grid||!this.p.treeGrid){return;}var c=b(this).jqGrid("getNodeParent",d);while(c){a.push(c);c=b(this).jqGrid("getNodeParent",c);}});return a;},isVisibleNode:function(d){var a=true;this.each(function(){var c=this;
if(!c.grid||!c.p.treeGrid){return;}var g=b(c).jqGrid("getNodeAncestors",d),h=c.p.treeReader.expanded_field;b(g).each(function(){a=a&&this[h];if(!a){return false;}});});return a;},isNodeLoaded:function(d){var a;this.each(function(){var c=this;if(!c.grid||!c.p.treeGrid){return;}var f=c.p.treeReader.leaf_field;
if(d.loaded!==undefined){a=d.loaded;}else{if(d[f]||b(c).jqGrid("getNodeChildren",d).length>0){a=true;}else{a=false;}}});return a;},expandNode:function(a){return this.each(function(){if(!this.grid||!this.p.treeGrid){return;}var h=this.p.treeReader.expanded_field;if(!a[h]){var g=b.jgrid.getAccessor(a,this.p.localReader.id);
var i=b("#"+g,this.grid.bDiv)[0];var j=this.p._index[g];if(b(this).jqGrid("isNodeLoaded",this.p.data[j])){a[h]=true;b("div.treeclick",i).removeClass(this.p.treeIcons.plus+" tree-plus").addClass(this.p.treeIcons.minus+" tree-minus");}else{a[h]=true;b("div.treeclick",i).removeClass(this.p.treeIcons.plus+" tree-plus").addClass(this.p.treeIcons.minus+" tree-minus");
this.p.treeANode=i.rowIndex;this.p.datatype=this.p.treedatatype;if(this.p.treeGridModel=="nested"){b(this).jqGrid("setGridParam",{postData:{nodeid:g,n_left:a.lft,n_right:a.rgt,n_level:a.level}});}else{b(this).jqGrid("setGridParam",{postData:{nodeid:g,parentid:a.parent_id,n_level:a.level}});}b(this).trigger("reloadGrid");
if(this.p.treeGridModel=="nested"){b(this).jqGrid("setGridParam",{postData:{nodeid:"",n_left:"",n_right:"",n_level:""}});}else{b(this).jqGrid("setGridParam",{postData:{nodeid:"",parentid:"",n_level:""}});}}}});},collapseNode:function(a){return this.each(function(){if(!this.grid||!this.p.treeGrid){return;
}if(a.expanded){a.expanded=false;var e=b.jgrid.getAccessor(a,this.p.localReader.id);var f=b("#"+e,this.grid.bDiv)[0];b("div.treeclick",f).removeClass(this.p.treeIcons.minus+" tree-minus").addClass(this.p.treeIcons.plus+" tree-plus");}});},SortTree:function(f,h,a,g){return this.each(function(){if(!this.grid||!this.p.treeGrid){return;
}var e,q,c,i=[],r=this,d,o,p=b(this).jqGrid("getRootNodes");d=b.jgrid.from(p);d.orderBy(f,h,a,g);o=d.select();for(e=0,q=o.length;e<q;e++){c=o[e];i.push(c);b(this).jqGrid("collectChildrenSortTree",i,c,f,h,a,g);}b.each(i,function(j,l){var k=b.jgrid.getAccessor(this,r.p.localReader.id);b("#"+r.p.id+" tbody tr:eq("+j+")").after(b("tr#"+k,r.grid.bDiv));
});d=null;o=null;i=null;});},collectChildrenSortTree:function(a,i,h,k,l,j){return this.each(function(){if(!this.grid||!this.p.treeGrid){return;}var e,g,o,d,c,f;d=b(this).jqGrid("getNodeChildren",i);c=b.jgrid.from(d);c.orderBy(h,k,l,j);f=c.select();for(e=0,g=f.length;e<g;e++){o=f[e];a.push(o);b(this).jqGrid("collectChildrenSortTree",a,o,h,k,l,j);
}});},setTreeRow:function(a,f){var e=false;this.each(function(){var c=this;if(!c.grid||!c.p.treeGrid){return;}e=b(c).jqGrid("setRowData",a,f);});return e;},delTreeNode:function(a){return this.each(function(){var g=this;if(!g.grid||!g.p.treeGrid){return;}var i=b(g).jqGrid("getInd",a,true);if(i){var h=b(g).jqGrid("getNodeChildren",i);
if(h.length>0){for(var j=0;j<h.length;j++){b(g).jqGrid("delRowData",h[j].id);}}b(g).jqGrid("delRowData",i.id);}});}});})(jQuery);