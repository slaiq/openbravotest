(function(b){b.extend(b.jgrid,{showModal:function(a){a.w.show();},closeModal:function(a){a.w.hide().attr("aria-hidden","true");if(a.o){a.o.remove();}},hideModal:function(a,e){e=b.extend({jqm:true,gb:""},e||{});if(e.onClose){var h=e.onClose(a);if(typeof h=="boolean"&&!h){return;}}if(b.fn.jqm&&e.jqm===true){b(a).attr("aria-hidden","true").jqmHide();
}else{if(e.gb!==""){try{b(".jqgrid-overlay:first",e.gb).hide();}catch(g){}}b(a).hide().attr("aria-hidden","true");}},findPos:function(f){var e=0,a=0;if(f.offsetParent){do{e+=f.offsetLeft;a+=f.offsetTop;}while(f=f.offsetParent);}return[e,a];},createModal:function(u,A,E,a,G,H){var v=document.createElement("div"),F,e=this;
F=b(E.gbox).attr("dir")=="rtl"?true:false;v.className="ui-widget ui-widget-content ui-corner-all ui-jqdialog";v.id=u.themodal;var C=document.createElement("div");C.className="ui-jqdialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix";C.id=u.modalhead;b(C).append("<span class='ui-jqdialog-title'>"+E.caption+"</span>");
var p=b("<a href='javascript:void(0)' class='ui-jqdialog-titlebar-close ui-corner-all'></a>").hover(function(){p.addClass("ui-state-hover");},function(){p.removeClass("ui-state-hover");}).append("<span class='ui-icon ui-icon-closethick'></span>");b(C).append(p);if(F){v.dir="rtl";b(".ui-jqdialog-title",C).css("float","right");
b(".ui-jqdialog-titlebar-close",C).css("left",0.3+"em");}else{v.dir="ltr";b(".ui-jqdialog-title",C).css("float","left");b(".ui-jqdialog-titlebar-close",C).css("right",0.3+"em");}var y=document.createElement("div");b(y).addClass("ui-jqdialog-content ui-widget-content").attr("id",u.modalcontent);b(y).append(A);
v.appendChild(y);b(v).prepend(C);if(H===true){b("body").append(v);}else{b(v).insertBefore(a);}if(typeof E.jqModal==="undefined"){E.jqModal=true;}var D={};if(b.fn.jqm&&E.jqModal===true){if(E.left===0&&E.top===0){var z=[];z=this.findPos(G);E.left=z[0]+4;E.top=z[1]+4;}D.top=E.top+"px";D.left=E.left;}else{if(E.left!==0||E.top!==0){D.left=E.left;
D.top=E.top+"px";}}b("a.ui-jqdialog-titlebar-close",C).click(function(d){var f=b("#"+u.themodal).data("onClose")||E.onClose;var c=b("#"+u.themodal).data("gbox")||E.gbox;e.hideModal("#"+u.themodal,{gb:c,jqm:E.jqModal,onClose:f});return false;});if(E.width===0||!E.width){E.width=300;}if(E.height===0||!E.height){E.height=200;
}if(!E.zIndex){var w=b(a).parents("*[role=dialog]").first().css("z-index");if(w){E.zIndex=parseInt(w)+1;}else{E.zIndex=950;}}var x=0;if(F&&D.left&&!H){x=b(E.gbox).width()-(!isNaN(E.width)?parseInt(E.width,10):0)-8;D.left=parseInt(D.left,10)+parseInt(x,10);}if(D.left){D.left+="px";}b(v).css(b.extend({width:isNaN(E.width)?"auto":E.width+"px",height:isNaN(E.height)?"auto":E.height+"px",zIndex:E.zIndex,overflow:"hidden"},D)).attr({tabIndex:"-1","role":"dialog","aria-labelledby":u.modalhead,"aria-hidden":"true"});
if(typeof E.drag=="undefined"){E.drag=true;}if(typeof E.resize=="undefined"){E.resize=true;}if(E.drag){b(C).css("cursor","move");if(b.fn.jqDrag){b(v).jqDrag(C);}else{try{b(v).draggable({handle:b("#"+C.id)});}catch(B){}}}if(E.resize){if(b.fn.jqResize){b(v).append("<div class='jqResize ui-resizable-handle ui-resizable-se ui-icon ui-icon-gripsmall-diagonal-se ui-icon-grip-diagonal-se'></div>");
b("#"+u.themodal).jqResize(".jqResize",u.scrollelm?"#"+u.scrollelm:false);}else{try{b(v).resizable({handles:"se, sw",alsoResize:u.scrollelm?"#"+u.scrollelm:false});}catch(B){}}}if(E.closeOnEscape===true){b(v).keydown(function(c){if(c.which==27){var d=b("#"+u.themodal).data("onClose")||E.onClose;e.hideModal(this,{gb:E.gbox,jqm:E.jqModal,onClose:d});
}});}},viewModal:function(a,e){e=b.extend({toTop:true,overlay:10,modal:false,onShow:this.showModal,onHide:this.closeModal,gbox:"",jqm:true,jqM:true},e||{});if(b.fn.jqm&&e.jqm===true){if(e.jqM){b(a).attr("aria-hidden","false").jqm(e).jqmShow();}else{b(a).attr("aria-hidden","false").jqmShow();}}else{if(e.gbox!==""){b(".jqgrid-overlay:first",e.gbox).show();
b(a).data("gbox",e.gbox);}b(a).show().attr("aria-hidden","false");try{b(":input:visible",a)[0].focus();}catch(f){}}},info_dialog:function(e,t,y,i){var r={width:290,height:"auto",dataheight:"auto",drag:true,resize:false,caption:"<b>"+e+"</b>",left:250,top:170,zIndex:1000,jqModal:true,modal:false,closeOnEscape:true,align:"center",buttonalign:"center",buttons:[]};
b.extend(r,i||{});var x=r.jqModal,a=this;if(b.fn.jqm&&!x){x=false;}var v="";if(r.buttons.length>0){for(var w=0;w<r.buttons.length;w++){if(typeof r.buttons[w].id=="undefined"){r.buttons[w].id="info_button_"+w;}v+="<a href='javascript:void(0)' id='"+r.buttons[w].id+"' class='fm-button ui-state-default ui-corner-all'>"+r.buttons[w].text+"</a>";
}}var s=isNaN(r.dataheight)?r.dataheight:r.dataheight+"px",q="text-align:"+r.align+";";var z="<div id='info_id'>";z+="<div id='infocnt' style='margin:0px;padding-bottom:1em;width:100%;overflow:auto;position:relative;height:"+s+";"+q+"'>"+t+"</div>";z+=y?"<div class='ui-widget-content ui-helper-clearfix' style='text-align:"+r.buttonalign+";padding-bottom:0.8em;padding-top:0.5em;background-image: none;border-width: 1px 0 0 0;'><a href='javascript:void(0)' id='closedialog' class='fm-button ui-state-default ui-corner-all'>"+y+"</a>"+v+"</div>":v!==""?"<div class='ui-widget-content ui-helper-clearfix' style='text-align:"+r.buttonalign+";padding-bottom:0.8em;padding-top:0.5em;background-image: none;border-width: 1px 0 0 0;'>"+v+"</div>":"";
z+="</div>";try{if(b("#info_dialog").attr("aria-hidden")=="false"){this.hideModal("#info_dialog",{jqm:x});}b("#info_dialog").remove();}catch(u){}this.createModal({themodal:"info_dialog",modalhead:"info_head",modalcontent:"info_content",scrollelm:"infocnt"},z,r,"","",true);if(v){b.each(r.buttons,function(c){b("#"+this.id,"#info_id").bind("click",function(){r.buttons[c].onClick.call(b("#info_dialog"));
return false;});});}b("#closedialog","#info_id").click(function(c){a.hideModal("#info_dialog",{jqm:x});return false;});b(".fm-button","#info_dialog").hover(function(){b(this).addClass("ui-state-hover");},function(){b(this).removeClass("ui-state-hover");});if(b.isFunction(r.beforeOpen)){r.beforeOpen();
}this.viewModal("#info_dialog",{onHide:function(c){c.w.hide().remove();if(c.o){c.o.remove();}},modal:r.modal,jqm:x});if(b.isFunction(r.afterOpen)){r.afterOpen();}try{b("#info_dialog").focus();}catch(u){}},createEl:function(K,J,x,G,z){var y="";if(J.defaultValue){delete J.defaultValue;}function F(c,d){if(b.isFunction(d.dataInit)){c.id=d.id;
d.dataInit(c);delete d.id;delete d.dataInit;}if(d.dataEvents){b.each(d.dataEvents,function(){if(this.data!==undefined){b(c).bind(this.type,this.data,this.fn);}else{b(c).bind(this.type,this.fn);}});delete d.dataEvents;}return d;}switch(K){case"textarea":y=document.createElement("textarea");if(G){if(!J.cols){b(y).css({width:"98%"});
}}else{if(!J.cols){J.cols=20;}}if(!J.rows){J.rows=2;}if(x=="&nbsp;"||x=="&#160;"||(x.length==1&&x.charCodeAt(0)==160)){x="";}y.value=x;J=F(y,J);b(y).attr(J).attr({"role":"textbox","multiline":"true"});break;case"checkbox":y=document.createElement("input");y.type="checkbox";if(!J.value){var a=x.toLowerCase();
if(a.search(/(false|0|no|off|undefined)/i)<0&&a!==""){y.checked=true;y.defaultChecked=true;y.value=x;}else{y.value="on";}b(y).attr("offval","off");}else{var D=J.value.split(":");if(x===D[0]){y.checked=true;y.defaultChecked=true;}y.value=D[0];b(y).attr("offval",D[1]);try{delete J.value;}catch(A){}}J=F(y,J);
b(y).attr(J).attr("role","checkbox");break;case"select":y=document.createElement("select");y.setAttribute("role","select");var M,I=[];if(J.multiple===true){M=true;y.multiple="multiple";b(y).attr("aria-multiselectable","true");}else{M=false;}if(typeof(J.dataUrl)!="undefined"){b.ajax(b.extend({url:J.dataUrl,type:"GET",dataType:"html",success:function(g,h){try{delete J.dataUrl;
delete J.value;}catch(d){}var c;if(typeof(J.buildSelect)!="undefined"){var f=J.buildSelect(g);c=b(f).html();delete J.buildSelect;}else{c=b(g).html();}if(c){b(y).append(c);J=F(y,J);if(typeof J.size==="undefined"){J.size=M?3:1;}if(M){I=x.split(",");I=b.map(I,function(j){return b.trim(j);});}else{I[0]=b.trim(x);
}b(y).attr(J);setTimeout(function(){b("option",y).each(function(j){if(j===0){this.selected="";}b(this).attr("role","option");if(b.inArray(b.trim(b(this).text()),I)>-1||b.inArray(b.trim(b(this).val()),I)>-1){this.selected="selected";if(!M){return false;}}});},0);}}},z||{}));}else{if(J.value){var C;if(M){I=x.split(",");
I=b.map(I,function(c){return b.trim(c);});if(typeof J.size==="undefined"){J.size=3;}}else{J.size=1;}if(typeof J.value==="function"){J.value=J.value();}var B,E,H;if(typeof J.value==="string"){B=J.value.split(";");for(C=0;C<B.length;C++){E=B[C].split(":");if(E.length>2){E[1]=b.map(E,function(c,d){if(d>0){return c;
}}).join(":");}H=document.createElement("option");H.setAttribute("role","option");H.value=E[0];H.innerHTML=E[1];if(!M&&(b.trim(E[0])==b.trim(x)||b.trim(E[1])==b.trim(x))){H.selected="selected";}if(M&&(b.inArray(b.trim(E[1]),I)>-1||b.inArray(b.trim(E[0]),I)>-1)){H.selected="selected";}y.appendChild(H);
}}else{if(typeof J.value==="object"){var L=J.value;for(var e in L){if(L.hasOwnProperty(e)){H=document.createElement("option");H.setAttribute("role","option");H.value=e;H.innerHTML=L[e];if(!M&&(b.trim(e)==b.trim(x)||b.trim(L[e])==b.trim(x))){H.selected="selected";}if(M&&(b.inArray(b.trim(L[e]),I)>-1||b.inArray(b.trim(e),I)>-1)){H.selected="selected";
}y.appendChild(H);}}}}J=F(y,J);try{delete J.value;}catch(A){}b(y).attr(J);}}break;case"text":case"password":case"button":var i;if(K=="button"){i="button";}else{i="textbox";}y=document.createElement("input");y.type=K;y.value=x;J=F(y,J);if(K!="button"){if(G){if(!J.size){b(y).css({width:"98%"});}}else{if(!J.size){J.size=20;
}}}b(y).attr(J).attr("role",i);break;case"image":case"file":y=document.createElement("input");y.type=K;J=F(y,J);b(y).attr(J);break;case"custom":y=document.createElement("span");try{if(b.isFunction(J.custom_element)){var N=J.custom_element.call(this,x,J);if(N){N=b(N).addClass("customelement").attr({id:J.id,name:J.name});
b(y).empty().append(N);}else{throw"e2";}}else{throw"e1";}}catch(A){if(A=="e1"){this.info_dialog(b.jgrid.errors.errcap,"function 'custom_element' "+b.jgrid.edit.msg.nodefined,b.jgrid.edit.bClose);}if(A=="e2"){this.info_dialog(b.jgrid.errors.errcap,"function 'custom_element' "+b.jgrid.edit.msg.novalue,b.jgrid.edit.bClose);
}else{this.info_dialog(b.jgrid.errors.errcap,typeof(A)==="string"?A:A.message,b.jgrid.edit.bClose);}}break;}return y;},checkDate:function(j,z){var s=function(c){return(((c%4===0)&&(c%100!==0||(c%400===0)))?29:28);},t=function(d){for(var c=1;c<=d;c++){this[c]=31;if(c==4||c==6||c==9||c==11){this[c]=30;
}if(c==2){this[c]=29;}}return this;};var x={},a;j=j.toLowerCase();if(j.indexOf("/")!=-1){a="/";}else{if(j.indexOf("-")!=-1){a="-";}else{if(j.indexOf(".")!=-1){a=".";}else{a="/";}}}j=j.split(a);z=z.split(a);if(z.length!=3){return false;}var v=-1,i,w=-1,y=-1;for(var u=0;u<j.length;u++){var A=isNaN(z[u])?0:parseInt(z[u],10);
x[j[u]]=A;i=j[u];if(i.indexOf("y")!=-1){v=u;}if(i.indexOf("m")!=-1){y=u;}if(i.indexOf("d")!=-1){w=u;}}if(j[v]=="y"||j[v]=="yyyy"){i=4;}else{if(j[v]=="yy"){i=2;}else{i=-1;}}var B=t(12),r;if(v===-1){return false;}else{r=x[j[v]].toString();if(i==2&&r.length==1){i=1;}if(r.length!=i||(x[j[v]]===0&&z[v]!="00")){return false;
}}if(y===-1){return false;}else{r=x[j[y]].toString();if(r.length<1||x[j[y]]<1||x[j[y]]>12){return false;}}if(w===-1){return false;}else{r=x[j[w]].toString();if(r.length<1||x[j[w]]<1||x[j[w]]>31||(x[j[y]]==2&&x[j[w]]>s(x[j[v]]))||x[j[w]]>B[x[j[y]]]){return false;}}return true;},isEmpty:function(a){if(a.match(/^\s+$/)||a===""){return true;
}else{return false;}},checkTime:function(e){var f=/^(\d{1,2}):(\d{2})([ap]m)?$/,a;if(!this.isEmpty(e)){a=e.match(f);if(a){if(a[3]){if(a[1]<1||a[1]>12){return false;}}else{if(a[1]>23){return false;}}if(a[2]>59){return false;}}else{return false;}}return true;},checkValues:function(w,e,r){var t,s,a,v,q;
if(typeof(e)=="string"){for(s=0,q=r.p.colModel.length;s<q;s++){if(r.p.colModel[s].name==e){t=r.p.colModel[s].editrules;e=s;try{a=r.p.colModel[s].formoptions.label;}catch(g){}break;}}}else{if(e>=0){t=r.p.colModel[e].editrules;}}if(t){if(!a){a=r.p.colNames[e];}if(t.required===true){if(this.isEmpty(w)){return[false,a+": "+b.jgrid.edit.msg.required,""];
}}var u=t.required===false?false:true;if(t.number===true){if(!(u===false&&this.isEmpty(w))){if(isNaN(w)){return[false,a+": "+b.jgrid.edit.msg.number,""];}}}if(typeof t.minValue!="undefined"&&!isNaN(t.minValue)){if(parseFloat(w)<parseFloat(t.minValue)){return[false,a+": "+b.jgrid.edit.msg.minValue+" "+t.minValue,""];
}}if(typeof t.maxValue!="undefined"&&!isNaN(t.maxValue)){if(parseFloat(w)>parseFloat(t.maxValue)){return[false,a+": "+b.jgrid.edit.msg.maxValue+" "+t.maxValue,""];}}var x;if(t.email===true){if(!(u===false&&this.isEmpty(w))){x=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i;
if(!x.test(w)){return[false,a+": "+b.jgrid.edit.msg.email,""];}}}if(t.integer===true){if(!(u===false&&this.isEmpty(w))){if(isNaN(w)){return[false,a+": "+b.jgrid.edit.msg.integer,""];}if((w%1!==0)||(w.indexOf(".")!=-1)){return[false,a+": "+b.jgrid.edit.msg.integer,""];}}}if(t.date===true){if(!(u===false&&this.isEmpty(w))){if(r.p.colModel[e].formatoptions&&r.p.colModel[e].formatoptions.newformat){v=r.p.colModel[e].formatoptions.newformat;
}else{v=r.p.colModel[e].datefmt||"Y-m-d";}if(!this.checkDate(v,w)){return[false,a+": "+b.jgrid.edit.msg.date+" - "+v,""];}}}if(t.time===true){if(!(u===false&&this.isEmpty(w))){if(!this.checkTime(w)){return[false,a+": "+b.jgrid.edit.msg.date+" - hh:mm (am/pm)",""];}}}if(t.url===true){if(!(u===false&&this.isEmpty(w))){x=/^(((https?)|(ftp)):\/\/([\-\w]+\.)+\w{2,3}(\/[%\-\w]+(\.\w{2,})?)*(([\w\-\.\?\\\/+@&#;`~=%!]*)(\.\w{2,})?)*\/?)/i;
if(!x.test(w)){return[false,a+": "+b.jgrid.edit.msg.url,""];}}}if(t.custom===true){if(!(u===false&&this.isEmpty(w))){if(b.isFunction(t.custom_func)){var i=t.custom_func.call(r,w,a);if(b.isArray(i)){return i;}else{return[false,b.jgrid.edit.msg.customarray,""];}}else{return[false,b.jgrid.edit.msg.customfcheck,""];
}}}}return[true,"",""];}});})(jQuery);